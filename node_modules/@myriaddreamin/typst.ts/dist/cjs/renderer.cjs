"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TypstRendererDriver = exports.rendererBuildInfo = exports.createTypstSvgRenderer = exports.createTypstRenderer = exports.TypstWorker = exports.RenderSession = void 0;
const internal_types_mjs_1 = require("./internal.types.cjs");
const view_mjs_1 = require("./render/canvas/view.cjs");
const wasm_mjs_1 = require("./wasm.cjs");
const init_mjs_1 = require("./init.cjs");
const dom_mjs_1 = require("./dom.cjs");
/**
 * The session of a Typst document.
 * @property {string} backgroundColor - The background color of the Typst
 * document.
 * @property {number} pixelPerPt - The pixel per point scale up the image.
 *
 */
class RenderSession {
    plugin;
    /**
     * @internal
     */
    [internal_types_mjs_1.kObject];
    /**
     * @internal
     */
    constructor(
    /**
     * @internal
     */
    plugin, o) {
        this.plugin = plugin;
        this[internal_types_mjs_1.kObject] = o;
    }
    /**
     * @deprecated set in {@link RenderToCanvasOptions} instead
     *
     * Set the background color of the Typst document.
     * @param {string} t - The background color in format of `^#?[0-9a-f]{6}$`
     *
     * Note: Default to `#ffffff`.
     *
     * Note: Only available in canvas rendering mode.
     */
    set backgroundColor(t) {
        if (t !== undefined) {
            this[internal_types_mjs_1.kObject].background_color = t;
        }
    }
    /**
     * Get the background color of the Typst document.
     *
     * Note: Default to `#ffffff`.
     *
     * Note: Only available in canvas rendering mode.
     */
    get backgroundColor() {
        return this[internal_types_mjs_1.kObject].background_color;
    }
    /**
     * Set the pixel per point scale up the canvas panel.
     *
     * Note: Default to `3`.
     *
     * Note: Only available in canvas rendering mode.
     */
    set pixelPerPt(t) {
        if (t !== undefined) {
            this[internal_types_mjs_1.kObject].pixel_per_pt = t;
        }
    }
    /**
     * @deprecated set in {@link RenderToCanvasOptions} instead
     *
     * Get the pixel per point scale up the canvas panel.
     *
     * Note: Default to `3`.
     *
     * Note: Only available in canvas rendering mode.
     */
    get pixelPerPt() {
        return this[internal_types_mjs_1.kObject].pixel_per_pt;
    }
    /**
     * Reset state
     */
    reset() {
        this.plugin.resetSession(this);
    }
    /**
     * @deprecated
     * use {@link docWidth} instead
     */
    get doc_width() {
        return this[internal_types_mjs_1.kObject].doc_width;
    }
    get docWidth() {
        return this[internal_types_mjs_1.kObject].doc_width;
    }
    /**
     * @deprecated
     * use {@link docHeight} instead
     */
    get doc_height() {
        return this[internal_types_mjs_1.kObject].doc_height;
    }
    get docHeight() {
        return this[internal_types_mjs_1.kObject].doc_height;
    }
    retrievePagesInfo() {
        const pages_info = this[internal_types_mjs_1.kObject].pages_info;
        const pageInfos = [];
        const pageCount = pages_info.page_count;
        for (let i = 0; i < pageCount; i++) {
            const pageAst = pages_info.page(i);
            pageInfos.push({
                pageOffset: pageAst.page_off,
                width: pageAst.width_pt,
                height: pageAst.height_pt,
            });
        }
        return pageInfos;
    }
    getSourceLoc(path) {
        return this[internal_types_mjs_1.kObject].source_span(path);
    }
    /**
     * See {@link TypstRenderer#renderSvg} for more details.
     */
    renderSvg(options) {
        return this.plugin.renderSvg({
            renderSession: this,
            ...options,
        });
    }
    /**
     * See {@link TypstRenderer#renderToSvg} for more details.
     */
    renderToSvg(options) {
        return this.plugin.renderToSvg({
            renderSession: this,
            ...options,
        });
    }
    /**
     * See {@link TypstRenderer#renderCanvas} for more details.
     */
    renderCanvas(options) {
        return this.plugin.renderCanvas({
            renderSession: this,
            ...options,
        });
    }
    /**
     * See {@link TypstRenderer#manipulateData} for more details.
     */
    manipulateData(opts) {
        this.plugin.manipulateData({
            renderSession: this,
            ...opts,
        });
    }
    /**
     * See {@link TypstRenderer#renderSvgDiff} for more details.
     */
    renderSvgDiff(opts) {
        return this.plugin.renderSvgDiff({
            renderSession: this,
            ...opts,
        });
    }
    /**
     * @deprecated
     * use {@link getSourceLoc} instead
     */
    get_source_loc(path) {
        return this[internal_types_mjs_1.kObject].source_span(path);
    }
    /**
     * @deprecated
     * use {@link renderSvgDiff} instead
     */
    render_in_window(rect_lo_x, rect_lo_y, rect_hi_x, rect_hi_y) {
        return this[internal_types_mjs_1.kObject].render_in_window(rect_lo_x, rect_lo_y, rect_hi_x, rect_hi_y);
    }
    /**
     * @deprecated
     * use {@link manipulateData} instead
     */
    merge_delta(data) {
        this.plugin.manipulateData({
            renderSession: this,
            action: 'merge',
            data,
        });
    }
}
exports.RenderSession = RenderSession;
/**
 * @internal
 */
var ManageStatus;
(function (ManageStatus) {
    ManageStatus[ManageStatus["Delete"] = 0] = "Delete";
    ManageStatus[ManageStatus["New"] = 1] = "New";
    ManageStatus[ManageStatus["Update"] = 2] = "Update";
})(ManageStatus || (ManageStatus = {}));
class TypstWorker {
    plugin;
    /**
     * @internal
     */
    [internal_types_mjs_1.kObject];
    /**
     * @internal
     */
    constructor(
    /**
     * @internal
     */
    plugin, o) {
        this.plugin = plugin;
        this[internal_types_mjs_1.kObject] = o;
    }
    /**
     * See {@link TypstRenderer#manipulateData} for more details.
     */
    manipulateData(action, data) {
        return this[internal_types_mjs_1.kObject].manipulate_data(action, data);
    }
    /**
     * @internal
     */
    managedCanvasElemList = new Map();
    /**
     * @internal
     */
    canvasCounter = Math.random();
    /**
     * You must submit all canvas in pages to ensure synchronization with the background worker
     *
     * See {@link TypstRenderer#renderCanvas} for more details.
     */
    renderCanvas(canvasElemList) {
        const m = this.managedCanvasElemList;
        for (const [_, elem] of m) {
            elem[0] = ManageStatus.Delete;
        }
        for (const elem of canvasElemList) {
            const canvas = elem.canvas;
            let elemId = canvas.dataset.manageId;
            let action = ManageStatus.Update;
            if (!elemId) {
                elemId = this.canvasCounter.toFixed(5);
                this.canvasCounter += 1;
                canvas.dataset.manageId = elemId;
                action = ManageStatus.New;
            }
            let prev = m.get(elemId);
            if (prev && prev[0] !== ManageStatus.Delete) {
                throw new Error('cannot update a canvas for two times in batch');
            }
            m.set(elemId, [action, { ...elem }]);
        }
        const entries = Array.from(m.entries());
        const actions = new Uint8Array(entries.length);
        const elements = new Array(entries.length);
        const options = entries.map(([key, [action, elem]], index) => {
            if (!action) {
                m.delete(key);
            }
            actions[index] = action;
            elements[index] = elem.canvas;
            return this.plugin.canvasOptionsToRust(elem);
        });
        return this[internal_types_mjs_1.kObject].render_canvas(actions, elements, options);
    }
    async retrievePagesInfo() {
        const pages_info = await this[internal_types_mjs_1.kObject].get_pages_info();
        console.log(pages_info);
        const pageInfos = [];
        const pageCount = pages_info.page_count;
        for (let i = 0; i < pageCount; i++) {
            const pageAst = pages_info.page(i);
            pageInfos.push({
                pageOffset: pageAst.page_off,
                width: pageAst.width_pt,
                height: pageAst.height_pt,
            });
        }
        return pageInfos;
    }
}
exports.TypstWorker = TypstWorker;
const gRendererModule = (module) => new wasm_mjs_1.LazyWasmModule(async (bin) => {
    return await module.default(bin);
});
/**
 * create a Typst renderer.
 * @returns {TypstRenderer} - The Typst renderer.
 * @example
 * ```typescript
 * import { createTypstRenderer } from 'typst';
 * const renderer = createTypstRenderer();
 * await renderer.init();
 * await renderer.render({
 *   container: document.getElementById('container'),
 *   artifactContent: '{ ... }',
 * });
 * ```
 */
function createTypstRenderer() {
    return new TypstRendererDriver();
}
exports.createTypstRenderer = createTypstRenderer;
/**
 * @deprecated
 * use {@link createTypstRenderer} instead
 */
function createTypstSvgRenderer() {
    return new TypstRendererDriver();
}
exports.createTypstSvgRenderer = createTypstSvgRenderer;
async function rendererBuildInfo() {
    const renderModule = await import('@myriaddreamin/typst-ts-renderer/pkg/wasm-pack-shim.mjs');
    return renderModule.renderer_build_info();
}
exports.rendererBuildInfo = rendererBuildInfo;
let warnOnceCanvasSet = true;
/** @internal */
class TypstRendererDriver {
    renderer;
    rendererJs;
    constructor() { }
    async init(options) {
        this.rendererJs = await (options?.getWrapper?.() ||
            import('@myriaddreamin/typst-ts-renderer/pkg/wasm-pack-shim.mjs'));
        const TypstRendererBuilder = this.rendererJs.TypstRendererBuilder;
        this.renderer = await (0, init_mjs_1.buildComponent)(options, gRendererModule(this.rendererJs), TypstRendererBuilder, {});
    }
    loadGlyphPack(_pack) {
        // this.renderer.load_glyph_pack(pack);
        return Promise.resolve();
    }
    createOptionsToRust(options) {
        const rustOptions = new this.rendererJs.CreateSessionOptions();
        if (options.format !== undefined) {
            rustOptions.format = options.format;
        }
        if (options.artifactContent !== undefined) {
            rustOptions.artifact_content = options.artifactContent;
        }
        return rustOptions;
    }
    canvasOptionsToRust(options) {
        const rustOptions = new this.rendererJs.RenderPageImageOptions();
        if (options.pageOffset === undefined) {
            throw new Error('pageOffset is required in reflexo v0.5.0');
        }
        else {
            rustOptions.page_off = options.pageOffset;
        }
        if (options.cacheKey !== undefined) {
            rustOptions.cache_key = options.cacheKey;
        }
        if (options.backgroundColor !== undefined) {
            rustOptions.background_color = options.backgroundColor;
        }
        if (options.pixelPerPt !== undefined) {
            rustOptions.pixel_per_pt = options.pixelPerPt;
        }
        if (options.dataSelection !== undefined) {
            let encoded = 0;
            if (options.dataSelection.body) {
                encoded |= 1 << 0;
            }
            else if (options.canvas && warnOnceCanvasSet) {
                warnOnceCanvasSet = false;
                console.warn('dataSelection.body is not set but providing canvas for body');
            }
            if (options.dataSelection.text || options.dataSelection.annotation) {
                console.error('dataSelection.text and dataSelection.annotation are deprecated');
            }
            if (options.dataSelection.semantics) {
                encoded |= 1 << 3;
            }
            rustOptions.data_selection = encoded;
        }
        return rustOptions;
    }
    retrievePagesInfoFromSession(session) {
        return session.retrievePagesInfo();
    }
    /**
     * Render a Typst document to canvas.
     */
    renderCanvas(options) {
        return this.withinOptionSession(options, async (sessionRef) => {
            return this.renderer.render_page_to_canvas(sessionRef[internal_types_mjs_1.kObject], options.canvas || undefined, this.canvasOptionsToRust(options));
        });
    }
    // async renderPdf(artifactContent: string): Promise<Uint8Array> {
    // return this.renderer.render_to_pdf(artifactContent);
    // }
    async inAnimationFrame(fn) {
        return new Promise((resolve, reject) => {
            requestAnimationFrame(() => {
                try {
                    resolve(fn());
                }
                catch (e) {
                    reject(e);
                }
            });
        });
    }
    async renderDisplayLayer(session, canvasList, options) {
        const pages_info = session[internal_types_mjs_1.kObject].pages_info;
        const page_count = pages_info.page_count;
        const doRender = async (i, page_off) => {
            const canvas = canvasList[i];
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                throw new Error('canvas context is null');
            }
            return await this.renderCanvas({
                ...options,
                canvas: ctx,
                renderSession: session,
                pageOffset: page_off,
            });
        };
        const t = performance.now();
        const textContentList = await (async () => {
            const results = [];
            for (let i = 0; i < page_count; i++) {
                results.push(await this.inAnimationFrame(() => doRender(i, i)));
            }
            return results;
        })();
        const t2 = performance.now();
        console.log(`display layer used: render = ${(t2 - t).toFixed(1)}ms`);
        return textContentList;
    }
    renderTextLayer(layerList, textSourceList) {
        const t2 = performance.now();
        layerList.forEach((layer, i) => {
            layer.innerHTML = textSourceList[i].htmlSemantics[0];
        });
        const t3 = performance.now();
        console.log(`text layer used: render = ${(t3 - t2).toFixed(1)}ms`);
    }
    async render(options) {
        if ('format' in options) {
            if (options.format !== 'vector') {
                const artifactFormats = ['serde_json', 'js', 'ir'];
                if (artifactFormats.includes(options.format)) {
                    // deprecated
                    throw new Error(`deprecated format ${options.format}, please use vector format`);
                }
            }
        }
        return this.renderToCanvas(options);
    }
    async renderDom(options) {
        if ('format' in options) {
            if (options.format !== 'vector') {
                const artifactFormats = ['serde_json', 'js', 'ir'];
                if (artifactFormats.includes(options.format)) {
                    // deprecated
                    throw new Error(`deprecated format ${options.format}, please use vector format`);
                }
            }
        }
        return this.withinOptionSession(options, async (sessionRef) => {
            const t = new dom_mjs_1.TypstDomDocument({
                ...options,
                renderMode: 'dom',
                hookedElem: options.container,
                kModule: sessionRef,
                renderer: this,
            });
            t;
            await t.impl.mountDom(options.pixelPerPt);
            return t;
        });
    }
    async renderToCanvas(options) {
        let session;
        let renderPageResults;
        const mountContainer = options.container;
        mountContainer.style.visibility = 'hidden';
        const doRenderDisplayLayer = async (canvasList, resetLayout) => {
            try {
                renderPageResults = await this.renderDisplayLayer(session, canvasList, options);
                resetLayout();
            }
            finally {
                mountContainer.style.visibility = 'visible';
            }
        };
        return this.withinOptionSession(options, async (sessionRef) => {
            session = sessionRef;
            if (session[internal_types_mjs_1.kObject].pages_info.page_count === 0) {
                throw new Error(`No page found in session`);
            }
            if (options.pixelPerPt !== undefined && options.pixelPerPt <= 0) {
                throw new Error('Invalid typst.RenderOptions.pixelPerPt, should be a positive number ' +
                    options.pixelPerPt);
            }
            let backgroundColor = options.backgroundColor;
            if (backgroundColor !== undefined) {
                if (!/^#[0-9a-f]{6}$/.test(backgroundColor)) {
                    throw new Error('Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ ' + backgroundColor);
                }
            }
            session.pixelPerPt = options.pixelPerPt ?? internal_types_mjs_1.TypstDefaultParams.PIXEL_PER_PT;
            session.backgroundColor = backgroundColor ?? '#ffffff';
            const t = performance.now();
            const pageView = new view_mjs_1.RenderView(this.retrievePagesInfoFromSession(session), mountContainer, options);
            const t2 = performance.now();
            console.log(`layer used: retieve = ${(t2 - t).toFixed(1)}ms`);
            await doRenderDisplayLayer(pageView.canvasList, () => pageView.resetLayout());
            this.renderTextLayer(pageView.textLayerList, renderPageResults);
            return;
        });
    }
    createModule(b) {
        return Promise.resolve(new RenderSession(this, this.renderer.create_session(b &&
            this.createOptionsToRust({
                format: 'vector',
                artifactContent: b,
            }))));
    }
    async createWorkerV0(worker) {
        return new TypstWorker(this, await this.renderer.create_worker(worker));
    }
    workerBridge() {
        return this.renderer.create_worker_bridge();
    }
    renderSvg(options, container) {
        if (options instanceof RenderSession || container) {
            throw new Error('removed api, please use renderToSvg({ renderSession, container }) instead');
        }
        return this.withinOptionSession(options, async (sessionRef) => {
            let parts = undefined;
            if (options.data_selection) {
                parts = 0;
                if (options.data_selection.body) {
                    parts |= 1 << 0;
                }
                if (options.data_selection.defs) {
                    parts |= 1 << 1;
                }
                if (options.data_selection.css) {
                    parts |= 1 << 2;
                }
                if (options.data_selection.js) {
                    parts |= 1 << 3;
                }
            }
            return Promise.resolve(this.renderer.svg_data(sessionRef[internal_types_mjs_1.kObject], parts));
        });
    }
    renderSvgDiff(options) {
        if (!options.window) {
            return this.renderer.render_svg_diff(options.renderSession[internal_types_mjs_1.kObject], 0, 0, 1e33, 1e33);
        }
        return this.renderer.render_svg_diff(options.renderSession[internal_types_mjs_1.kObject], options.window.lo.x, options.window.lo.y, options.window.hi.x, options.window.hi.y);
    }
    renderToSvg(options) {
        return this.withinOptionSession(options, async (sessionRef) => {
            return Promise.resolve(this.renderer.render_svg(sessionRef[internal_types_mjs_1.kObject], options.container));
        });
    }
    getCustomV1(options) {
        return Promise.resolve(this.renderer.get_customs(options.renderSession[internal_types_mjs_1.kObject]));
    }
    resetSession(session) {
        return this.renderer.reset(session[internal_types_mjs_1.kObject]);
    }
    manipulateData(opts) {
        return this.renderer.manipulate_data(opts.renderSession[internal_types_mjs_1.kObject], opts.action ?? 'reset', opts.data);
    }
    withinOptionSession(options, fn) {
        function isRenderByContentOption(options) {
            return 'artifactContent' in options;
        }
        if ('renderSession' in options) {
            return fn(options.renderSession);
        }
        if (isRenderByContentOption(options)) {
            // todo: remove any
            return this.runWithSession(options, fn);
        }
        throw new Error('Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions');
    }
    async runWithSession(arg1, arg2) {
        let options = arg1;
        let fn = arg2;
        if (!arg2) {
            options = undefined;
            fn = arg1;
        }
        const session = this.renderer.create_session(
        /* moved */ options && this.createOptionsToRust(options));
        try {
            const res = await fn(new RenderSession(this, session));
            session.free();
            return res;
        }
        catch (e) {
            session.free();
            throw e;
        }
    }
}
exports.TypstRendererDriver = TypstRendererDriver;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyZXIubWpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3JlbmRlcmVyLm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFJQSw2REFBaUc7QUFhakcsdURBQXNEO0FBQ3RELHlDQUE0QztBQUM1Qyx5Q0FBNEM7QUFDNUMsdUNBQTZDO0FBZTdDOzs7Ozs7R0FNRztBQUNILE1BQWEsYUFBYTtJQWFkO0lBWlY7O09BRUc7SUFDSSxDQUFDLDRCQUFPLENBQUMsQ0FBc0I7SUFFdEM7O09BRUc7SUFDSDtJQUNFOztPQUVHO0lBQ0ssTUFBcUIsRUFDN0IsQ0FBc0I7UUFEZCxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBRzdCLElBQUksQ0FBQyw0QkFBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7SUFFRDs7Ozs7Ozs7O09BU0c7SUFDSCxJQUFJLGVBQWUsQ0FBQyxDQUFxQjtRQUN2QyxJQUFJLENBQUMsS0FBSyxTQUFTLEVBQUU7WUFDbkIsSUFBSSxDQUFDLDRCQUFPLENBQUMsQ0FBQyxnQkFBZ0IsR0FBRyxDQUFDLENBQUM7U0FDcEM7SUFDSCxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0gsSUFBSSxlQUFlO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLDRCQUFPLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQztJQUN4QyxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0gsSUFBSSxVQUFVLENBQUMsQ0FBcUI7UUFDbEMsSUFBSSxDQUFDLEtBQUssU0FBUyxFQUFFO1lBQ25CLElBQUksQ0FBQyw0QkFBTyxDQUFDLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztTQUNoQztJQUNILENBQUM7SUFFRDs7Ozs7Ozs7T0FRRztJQUNILElBQUksVUFBVTtRQUNaLE9BQU8sSUFBSSxDQUFDLDRCQUFPLENBQUMsQ0FBQyxZQUFZLENBQUM7SUFDcEMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSztRQUNILElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFD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LEdBQUcsSUFBSSxDQUFDO1NBQ1g7UUFFRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWM7UUFDMUMsV0FBVyxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLENBQ3pELENBQUM7UUFDRixJQUFJO1lBQ0YsTUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFFLENBQUMsSUFBSSxhQUFhLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDdkQsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2YsT0FBTyxHQUFHLENBQUM7U0FDWjtRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2YsTUFBTSxDQUFDLENBQUM7U0FDVDtJQUNILENBQUM7Q0FDRjtBQXhZRCxrREF3WUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtaWdub3JlXHJcbmltcG9ydCB0eXBlICogYXMgdHlwc3QgZnJvbSAnQG15cmlhZGRyZWFtaW4vdHlwc3QtdHMtcmVuZGVyZXIvcGtnL3dhc20tcGFjay1zaGltLm1qcyc7XHJcblxyXG5pbXBvcnQgdHlwZSB7IEluaXRPcHRpb25zIH0gZnJvbSAnLi9vcHRpb25zLmluaXQubWpzJztcclxuaW1wb3J0IHsgUGFnZUluZm8sIFJlbmRlckNhbnZhc1Jlc3VsdCwgVHlwc3REZWZhdWx0UGFyYW1zLCBrT2JqZWN0IH0gZnJvbSAnLi9pbnRlcm5hbC50eXBlcy5tanMnO1xyXG5pbXBvcnQge1xyXG4gIENyZWF0ZVNlc3Npb25PcHRpb25zLFxyXG4gIFJlbmRlclRvQ2FudmFzT3B0aW9ucyxcclxuICBSZW5kZXJPcHRpb25zLFxyXG4gIFJlbmRlckNhbnZhc09wdGlvbnMsXHJcbiAgUmVuZGVyVG9TdmdPcHRpb25zLFxyXG4gIE1hbmlwdWxhdGVEYXRhT3B0aW9ucyxcclxuICBSZW5kZXJTdmdPcHRpb25zLFxyXG4gIFJlbmRlckluU2Vzc2lvbk9wdGlvbnMsXHJcbiAgTW91bnREb21PcHRpb25zLFxyXG4gIE9mZnNjcmVlblJlbmRlckNhbnZhc09wdGlvbnMsXHJcbn0gZnJvbSAnLi9vcHRpb25zLnJlbmRlci5tanMnO1xyXG5pbXBvcnQgeyBSZW5kZXJWaWV3IH0gZnJvbSAnLi9yZW5kZXIvY2FudmFzL3ZpZXcubWpzJztcclxuaW1wb3J0IHsgTGF6eVdhc21Nb2R1bGUgfSBmcm9tICcuL3dhc20ubWpzJztcclxuaW1wb3J0IHsgYnVpbGRDb21wb25lbnQgfSBmcm9tICcuL2luaXQubWpzJztcclxuaW1wb3J0IHsgVHlwc3REb21Eb2N1bWVudCB9IGZyb20gJy4vZG9tLm1qcyc7XHJcblxyXG4vKipcclxuICogVGhlIHJlc3VsdCBvZiByZW5kZXJpbmcgYSBUeXBzdCBkb2N1bWVudC5cclxuICogQHR5cGVkZWYge09iamVjdH0gUmVuZGVyUmVzdWx0XHJcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgcmVuZGVyZWQgVHlwc3QgZG9jdW1lbnQgKHNpbmdsZSBwYWdlKS5cclxuICogQHByb3BlcnR5IHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgb2YgdGhlIHJlbmRlcmVkIFR5cHN0IGRvY3VtZW50IChzaW5nbGUgcGFnZSkuXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFJlbmRlclJlc3VsdCB7XHJcbiAgd2lkdGg6IG51bWJlcjtcclxuICBoZWlnaHQ6IG51bWJlcjtcclxufVxyXG5cclxudHlwZSBDb250ZXh0ZWRSZW5kZXJPcHRpb25zPFQ+ID0gVCB8IFJlbmRlck9wdGlvbnM8VD47XHJcblxyXG4vKipcclxuICogVGhlIHNlc3Npb24gb2YgYSBUeXBzdCBkb2N1bWVudC5cclxuICogQHByb3BlcnR5IHtzdHJpbmd9IGJhY2tncm91bmRDb2xvciAtIFRoZSBiYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBUeXBzdFxyXG4gKiBkb2N1bWVudC5cclxuICogQHByb3BlcnR5IHtudW1iZXJ9IHBpeGVsUGVyUHQgLSBUaGUgcGl4ZWwgcGVyIHBvaW50IHNjYWxlIHVwIHRoZSBpbWFnZS5cclxuICpcclxuICovXHJcbmV4cG9ydCBjbGFzcyBSZW5kZXJTZXNzaW9uIHtcclxuICAvKipcclxuICAgKiBAaW50ZXJuYWxcclxuICAgKi9cclxuICBwdWJsaWMgW2tPYmplY3RdOiB0eXBzdC5SZW5kZXJTZXNzaW9uO1xyXG5cclxuICAvKipcclxuICAgKiBAaW50ZXJuYWxcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIC8qKlxyXG4gICAgICogQGludGVybmFsXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgcGx1Z2luOiBUeXBzdFJlbmRlcmVyLFxyXG4gICAgbzogdHlwc3QuUmVuZGVyU2Vzc2lvbixcclxuICApIHtcclxuICAgIHRoaXNba09iamVjdF0gPSBvO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWQgc2V0IGluIHtAbGluayBSZW5kZXJUb0NhbnZhc09wdGlvbnN9IGluc3RlYWRcclxuICAgKlxyXG4gICAqIFNldCB0aGUgYmFja2dyb3VuZCBjb2xvciBvZiB0aGUgVHlwc3QgZG9jdW1lbnQuXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHQgLSBUaGUgYmFja2dyb3VuZCBjb2xvciBpbiBmb3JtYXQgb2YgYF4jP1swLTlhLWZdezZ9JGBcclxuICAgKlxyXG4gICAqIE5vdGU6IERlZmF1bHQgdG8gYCNmZmZmZmZgLlxyXG4gICAqXHJcbiAgICogTm90ZTogT25seSBhdmFpbGFibGUgaW4gY2FudmFzIHJlbmRlcmluZyBtb2RlLlxyXG4gICAqL1xyXG4gIHNldCBiYWNrZ3JvdW5kQ29sb3IodDogc3RyaW5nIHwgdW5kZWZpbmVkKSB7XHJcbiAgICBpZiAodCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHRoaXNba09iamVjdF0uYmFja2dyb3VuZF9jb2xvciA9IHQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIGJhY2tncm91bmQgY29sb3Igb2YgdGhlIFR5cHN0IGRvY3VtZW50LlxyXG4gICAqXHJcbiAgICogTm90ZTogRGVmYXVsdCB0byBgI2ZmZmZmZmAuXHJcbiAgICpcclxuICAgKiBOb3RlOiBPbmx5IGF2YWlsYWJsZSBpbiBjYW52YXMgcmVuZGVyaW5nIG1vZGUuXHJcbiAgICovXHJcbiAgZ2V0IGJhY2tncm91bmRDb2xvcigpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uYmFja2dyb3VuZF9jb2xvcjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCB0aGUgcGl4ZWwgcGVyIHBvaW50IHNjYWxlIHVwIHRoZSBjYW52YXMgcGFuZWwuXHJcbiAgICpcclxuICAgKiBOb3RlOiBEZWZhdWx0IHRvIGAzYC5cclxuICAgKlxyXG4gICAqIE5vdGU6IE9ubHkgYXZhaWxhYmxlIGluIGNhbnZhcyByZW5kZXJpbmcgbW9kZS5cclxuICAgKi9cclxuICBzZXQgcGl4ZWxQZXJQdCh0OiBudW1iZXIgfCB1bmRlZmluZWQpIHtcclxuICAgIGlmICh0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhpc1trT2JqZWN0XS5waXhlbF9wZXJfcHQgPSB0O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWQgc2V0IGluIHtAbGluayBSZW5kZXJUb0NhbnZhc09wdGlvbnN9IGluc3RlYWRcclxuICAgKlxyXG4gICAqIEdldCB0aGUgcGl4ZWwgcGVyIHBvaW50IHNjYWxlIHVwIHRoZSBjYW52YXMgcGFuZWwuXHJcbiAgICpcclxuICAgKiBOb3RlOiBEZWZhdWx0IHRvIGAzYC5cclxuICAgKlxyXG4gICAqIE5vdGU6IE9ubHkgYXZhaWxhYmxlIGluIGNhbnZhcyByZW5kZXJpbmcgbW9kZS5cclxuICAgKi9cclxuICBnZXQgcGl4ZWxQZXJQdCgpOiBudW1iZXIgfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0ucGl4ZWxfcGVyX3B0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXQgc3RhdGVcclxuICAgKi9cclxuICByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMucGx1Z2luLnJlc2V0U2Vzc2lvbih0aGlzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICogdXNlIHtAbGluayBkb2NXaWR0aH0gaW5zdGVhZFxyXG4gICAqL1xyXG4gIGdldCBkb2Nfd2lkdGgoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLmRvY193aWR0aDtcclxuICB9XHJcblxyXG4gIGdldCBkb2NXaWR0aCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uZG9jX3dpZHRoO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKiB1c2Uge0BsaW5rIGRvY0hlaWdodH0gaW5zdGVhZFxyXG4gICAqL1xyXG4gIGdldCBkb2NfaGVpZ2h0KCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5kb2NfaGVpZ2h0O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGRvY0hlaWdodCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uZG9jX2hlaWdodDtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlUGFnZXNJbmZvKCk6IFBhZ2VJbmZvW10ge1xyXG4gICAgY29uc3QgcGFnZXNfaW5mbyA9IHRoaXNba09iamVjdF0ucGFnZXNfaW5mbztcclxuICAgIGNvbnN0IHBhZ2VJbmZvczogUGFnZUluZm9bXSA9IFtdO1xyXG4gICAgY29uc3QgcGFnZUNvdW50ID0gcGFnZXNfaW5mby5wYWdlX2NvdW50O1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWdlQ291bnQ7IGkrKykge1xyXG4gICAgICBjb25zdCBwYWdlQXN0ID0gcGFnZXNfaW5mby5wYWdlKGkpO1xyXG4gICAgICBwYWdlSW5mb3MucHVzaCh7XHJcbiAgICAgICAgcGFnZU9mZnNldDogcGFnZUFzdC5wYWdlX29mZixcclxuICAgICAgICB3aWR0aDogcGFnZUFzdC53aWR0aF9wdCxcclxuICAgICAgICBoZWlnaHQ6IHBhZ2VBc3QuaGVpZ2h0X3B0LFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcGFnZUluZm9zO1xyXG4gIH1cclxuXHJcbiAgZ2V0U291cmNlTG9jKHBhdGg6IFVpbnQzMkFycmF5KTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiAodGhpc1trT2JqZWN0XSBhcyB0eXBzdC5SZW5kZXJTZXNzaW9uKS5zb3VyY2Vfc3BhbihwYXRoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RSZW5kZXJlciNyZW5kZXJTdmd9IGZvciBtb3JlIGRldGFpbHMuXHJcbiAgICovXHJcbiAgcmVuZGVyU3ZnKG9wdGlvbnM6IENvbnRleHRlZFJlbmRlck9wdGlvbnM8UmVuZGVyU3ZnT3B0aW9ucz4pOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLnJlbmRlclN2Zyh7XHJcbiAgICAgIHJlbmRlclNlc3Npb246IHRoaXMsXHJcbiAgICAgIC4uLm9wdGlvbnMsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RSZW5kZXJlciNyZW5kZXJUb1N2Z30gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICByZW5kZXJUb1N2ZyhvcHRpb25zOiBDb250ZXh0ZWRSZW5kZXJPcHRpb25zPFJlbmRlclRvU3ZnT3B0aW9ucz4pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHJldHVybiB0aGlzLnBsdWdpbi5yZW5kZXJUb1N2Zyh7XHJcbiAgICAgIHJlbmRlclNlc3Npb246IHRoaXMsXHJcbiAgICAgIC4uLm9wdGlvbnMsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RSZW5kZXJlciNyZW5kZXJDYW52YXN9IGZvciBtb3JlIGRldGFpbHMuXHJcbiAgICovXHJcbiAgcmVuZGVyQ2FudmFzKG9wdGlvbnM6IENvbnRleHRlZFJlbmRlck9wdGlvbnM8UmVuZGVyQ2FudmFzT3B0aW9ucz4pOiBQcm9taXNlPFJlbmRlckNhbnZhc1Jlc3VsdD4ge1xyXG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLnJlbmRlckNhbnZhcyh7XHJcbiAgICAgIHJlbmRlclNlc3Npb246IHRoaXMsXHJcbiAgICAgIC4uLm9wdGlvbnMsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RSZW5kZXJlciNtYW5pcHVsYXRlRGF0YX0gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICBtYW5pcHVsYXRlRGF0YShvcHRzOiBNYW5pcHVsYXRlRGF0YU9wdGlvbnMpIHtcclxuICAgIHRoaXMucGx1Z2luLm1hbmlwdWxhdGVEYXRhKHtcclxuICAgICAgcmVuZGVyU2Vzc2lvbjogdGhpcyxcclxuICAgICAgLi4ub3B0cyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI3JlbmRlclN2Z0RpZmZ9IGZvciBtb3JlIGRldGFpbHMuXHJcbiAgICovXHJcbiAgcmVuZGVyU3ZnRGlmZihvcHRzOiBSZW5kZXJTdmdPcHRpb25zKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLnBsdWdpbi5yZW5kZXJTdmdEaWZmKHtcclxuICAgICAgcmVuZGVyU2Vzc2lvbjogdGhpcyxcclxuICAgICAgLi4ub3B0cyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKiB1c2Uge0BsaW5rIGdldFNvdXJjZUxvY30gaW5zdGVhZFxyXG4gICAqL1xyXG4gIGdldF9zb3VyY2VfbG9jKHBhdGg6IFVpbnQzMkFycmF5KTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiAodGhpc1trT2JqZWN0XSBhcyB0eXBzdC5SZW5kZXJTZXNzaW9uKS5zb3VyY2Vfc3BhbihwYXRoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICogdXNlIHtAbGluayByZW5kZXJTdmdEaWZmfSBpbnN0ZWFkXHJcbiAgICovXHJcbiAgcmVuZGVyX2luX3dpbmRvdyhyZWN0X2xvX3g6IG51bWJlciwgcmVjdF9sb195OiBudW1iZXIsIHJlY3RfaGlfeDogbnVtYmVyLCByZWN0X2hpX3k6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0ucmVuZGVyX2luX3dpbmRvdyhyZWN0X2xvX3gsIHJlY3RfbG9feSwgcmVjdF9oaV94LCByZWN0X2hpX3kpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKiB1c2Uge0BsaW5rIG1hbmlwdWxhdGVEYXRhfSBpbnN0ZWFkXHJcbiAgICovXHJcbiAgbWVyZ2VfZGVsdGEoZGF0YTogVWludDhBcnJheSkge1xyXG4gICAgdGhpcy5wbHVnaW4ubWFuaXB1bGF0ZURhdGEoe1xyXG4gICAgICByZW5kZXJTZXNzaW9uOiB0aGlzLFxyXG4gICAgICBhY3Rpb246ICdtZXJnZScsXHJcbiAgICAgIGRhdGEsXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmNvbnN0IGVudW0gTWFuYWdlU3RhdHVzIHtcclxuICBEZWxldGUsXHJcbiAgTmV3LFxyXG4gIFVwZGF0ZSxcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFR5cHN0V29ya2VyIHtcclxuICAvKipcclxuICAgKiBAaW50ZXJuYWxcclxuICAgKi9cclxuICBwdWJsaWMgW2tPYmplY3RdOiB0eXBzdC5UeXBzdFdvcmtlcjtcclxuXHJcbiAgLyoqXHJcbiAgICogQGludGVybmFsXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICAvKipcclxuICAgICAqIEBpbnRlcm5hbFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHBsdWdpbjogVHlwc3RSZW5kZXJlckRyaXZlcixcclxuICAgIG86IHR5cHN0LlR5cHN0V29ya2VyLFxyXG4gICkge1xyXG4gICAgdGhpc1trT2JqZWN0XSA9IG87XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZWUge0BsaW5rIFR5cHN0UmVuZGVyZXIjbWFuaXB1bGF0ZURhdGF9IGZvciBtb3JlIGRldGFpbHMuXHJcbiAgICovXHJcbiAgbWFuaXB1bGF0ZURhdGEoYWN0aW9uOiBzdHJpbmcsIGRhdGE6IFVpbnQ4QXJyYXkpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLm1hbmlwdWxhdGVfZGF0YShhY3Rpb24sIGRhdGEpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGludGVybmFsXHJcbiAgICovXHJcbiAgbWFuYWdlZENhbnZhc0VsZW1MaXN0ID0gbmV3IE1hcDxzdHJpbmcsIFtNYW5hZ2VTdGF0dXMsIE9mZnNjcmVlblJlbmRlckNhbnZhc09wdGlvbnNdPigpO1xyXG4gIC8qKlxyXG4gICAqIEBpbnRlcm5hbFxyXG4gICAqL1xyXG4gIGNhbnZhc0NvdW50ZXIgPSBNYXRoLnJhbmRvbSgpO1xyXG4gIC8qKlxyXG4gICAqIFlvdSBtdXN0IHN1Ym1pdCBhbGwgY2FudmFzIGluIHBhZ2VzIHRvIGVuc3VyZSBzeW5jaHJvbml6YXRpb24gd2l0aCB0aGUgYmFja2dyb3VuZCB3b3JrZXJcclxuICAgKlxyXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RSZW5kZXJlciNyZW5kZXJDYW52YXN9IGZvciBtb3JlIGRldGFpbHMuXHJcbiAgICovXHJcbiAgcmVuZGVyQ2FudmFzKGNhbnZhc0VsZW1MaXN0OiBPZmZzY3JlZW5SZW5kZXJDYW52YXNPcHRpb25zW10pOiBQcm9taXNlPFJlbmRlckNhbnZhc1Jlc3VsdFtdPiB7XHJcbiAgICBjb25zdCBtID0gdGhpcy5tYW5hZ2VkQ2FudmFzRWxlbUxpc3Q7XHJcbiAgICBmb3IgKGNvbnN0IFtfLCBlbGVtXSBvZiBtKSB7XHJcbiAgICAgIGVsZW1bMF0gPSBNYW5hZ2VTdGF0dXMuRGVsZXRlO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAoY29uc3QgZWxlbSBvZiBjYW52YXNFbGVtTGlzdCkge1xyXG4gICAgICBjb25zdCBjYW52YXMgPSBlbGVtLmNhbnZhcztcclxuICAgICAgbGV0IGVsZW1JZCA9IGNhbnZhcy5kYXRhc2V0Lm1hbmFnZUlkO1xyXG4gICAgICBsZXQgYWN0aW9uID0gTWFuYWdlU3RhdHVzLlVwZGF0ZTtcclxuICAgICAgaWYgKCFlbGVtSWQpIHtcclxuICAgICAgICBlbGVtSWQgPSB0aGlzLmNhbnZhc0NvdW50ZXIudG9GaXhlZCg1KTtcclxuICAgICAgICB0aGlzLmNhbnZhc0NvdW50ZXIgKz0gMTtcclxuICAgICAgICBjYW52YXMuZGF0YXNldC5tYW5hZ2VJZCA9IGVsZW1JZDtcclxuICAgICAgICBhY3Rpb24gPSBNYW5hZ2VTdGF0dXMuTmV3O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgcHJldiA9IG0uZ2V0KGVsZW1JZCk7XHJcbiAgICAgIGlmIChwcmV2ICYmIHByZXZbMF0gIT09IE1hbmFnZVN0YXR1cy5EZWxldGUpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Nhbm5vdCB1cGRhdGUgYSBjYW52YXMgZm9yIHR3byB0aW1lcyBpbiBiYXRjaCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBtLnNldChlbGVtSWQsIFthY3Rpb24sIHsgLi4uZWxlbSB9XSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZW50cmllcyA9IEFycmF5LmZyb20obS5lbnRyaWVzKCkpO1xyXG4gICAgY29uc3QgYWN0aW9ucyA9IG5ldyBVaW50OEFycmF5KGVudHJpZXMubGVuZ3RoKTtcclxuICAgIGNvbnN0IGVsZW1lbnRzID0gbmV3IEFycmF5KGVudHJpZXMubGVuZ3RoKTtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSBlbnRyaWVzLm1hcCgoW2tleSwgW2FjdGlvbiwgZWxlbV1dLCBpbmRleCkgPT4ge1xyXG4gICAgICBpZiAoIWFjdGlvbikge1xyXG4gICAgICAgIG0uZGVsZXRlKGtleSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGFjdGlvbnNbaW5kZXhdID0gYWN0aW9uO1xyXG4gICAgICBlbGVtZW50c1tpbmRleF0gPSBlbGVtLmNhbnZhcztcclxuICAgICAgcmV0dXJuIHRoaXMucGx1Z2luLmNhbnZhc09wdGlvbnNUb1J1c3QoZWxlbSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5yZW5kZXJfY2FudmFzKGFjdGlvbnMsIGVsZW1lbnRzLCBvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHJldHJpZXZlUGFnZXNJbmZvKCk6IFByb21pc2U8UGFnZUluZm9bXT4ge1xyXG4gICAgY29uc3QgcGFnZXNfaW5mbyA9IGF3YWl0IHRoaXNba09iamVjdF0uZ2V0X3BhZ2VzX2luZm8oKTtcclxuICAgIGNvbnNvbGUubG9nKHBhZ2VzX2luZm8pO1xyXG4gICAgY29uc3QgcGFnZUluZm9zOiBQYWdlSW5mb1tdID0gW107XHJcbiAgICBjb25zdCBwYWdlQ291bnQgPSBwYWdlc19pbmZvLnBhZ2VfY291bnQ7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhZ2VDb3VudDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHBhZ2VBc3QgPSBwYWdlc19pbmZvLnBhZ2UoaSk7XHJcbiAgICAgIHBhZ2VJbmZvcy5wdXNoKHtcclxuICAgICAgICBwYWdlT2Zmc2V0OiBwYWdlQXN0LnBhZ2Vfb2ZmLFxyXG4gICAgICAgIHdpZHRoOiBwYWdlQXN0LndpZHRoX3B0LFxyXG4gICAgICAgIGhlaWdodDogcGFnZUFzdC5oZWlnaHRfcHQsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBwYWdlSW5mb3M7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogVGhlIGludGVyZmFjZSBvZiBUeXBzdCByZW5kZXJlci5cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHlwc3RSZW5kZXJlciBleHRlbmRzIFR5cHN0U3ZnUmVuZGVyZXIge1xyXG4gIC8qKlxyXG4gICAqIEluaXRpYWxpemUgdGhlIHR5cHN0IHJlbmRlcmVyLlxyXG4gICAqIEBwYXJhbSB7UGFydGlhbDxJbml0T3B0aW9ucz59IG9wdGlvbnMgLSBUaGUgb3B0aW9ucyBmb3IgaW5pdGlhbGl6aW5nIHRoZVxyXG4gICAqIHR5cHN0IHJlbmRlcmVyLlxyXG4gICAqL1xyXG4gIGluaXQob3B0aW9ucz86IFBhcnRpYWw8SW5pdE9wdGlvbnM+KTogUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgLyoqXHJcbiAgICogTG9hZCBhIGdseXBoIHBhY2sgZm9yIGFsbCBvZiB0aGUgVHlwc3QgZG9jdW1lbnRzIHRvIHJlbmRlci5cclxuICAgKiBOb3RlOiB0aGlzIGZ1bmN0aW9uIGlzIHN0aWxsIHVuZGVyIGRldmVsb3BtZW50LlxyXG4gICAqIEBwYXJhbSBwYWNrXHJcbiAgICovXHJcbiAgbG9hZEdseXBoUGFjayhwYWNrOiB1bmtub3duKTogUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXQgc3RhdGVcclxuICAgKi9cclxuICByZXNldFNlc3Npb24oc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbik6IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHJlaXZlIHBhZ2UgaW5mb3JtYXRpb24gb2YgY3VycmVudCBzZWxlY3RlZCBkb2N1bWVudFxyXG4gICAqL1xyXG4gIHJldHJpZXZlUGFnZXNJbmZvRnJvbVNlc3Npb24oc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbik6IFBhZ2VJbmZvW107XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbmRlciBhIFR5cHN0IGRvY3VtZW50IHRvIGNhbnZhcy5cclxuICAgKi9cclxuICByZW5kZXJDYW52YXMob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJDYW52YXNPcHRpb25zPik6IFByb21pc2U8UmVuZGVyQ2FudmFzUmVzdWx0PjtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVyIGEgVHlwc3QgZG9jdW1lbnQgdG8gY2FudmFzLlxyXG4gICAqIEBwYXJhbSB7UmVuZGVyT3B0aW9uczxSZW5kZXJUb0NhbnZhc09wdGlvbnM+fSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yXHJcbiAgICogcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQgdG8gc3BlY2lmaWVkIGNvbnRhaW5lci5cclxuICAgKiBAcmV0dXJucyB7dm9pZH0gLSBUaGUgcmVzdWx0IG9mIHJlbmRlcmluZyBhIFR5cHN0IGRvY3VtZW50LlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGxldCBmZXRjaERvYyA9IChwYXRoKSA9PiBmZXRjaChwYXRoKS50aGVuKFxyXG4gICAqICAgcmVzcG9uc2UgPT4gbmV3IFVpbnQ4QXJyYXkocmVzcG9uc2UuYXJyYXlCdWZmZXIoKSkpXHJcbiAgICogcmVuZGVyZXIucmVuZGVyVG9DYW52YXMoe1xyXG4gICAqICAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFpbmVyJyksXHJcbiAgICogICBwaXhlbFBlclB0OiAzLFxyXG4gICAqICAgYmFja2dyb3VuZENvbG9yOiAnI2ZmZmZmZicsXHJcbiAgICogICBhcnRpZmFjdENvbnRlbnQ6IGF3YWl0IGZldGNoRG9jKCd0eXBzdC1tYWluLnNpci5pbicpLFxyXG4gICAqIH0pO1xyXG4gICAqIGBgYFxyXG4gICAqL1xyXG4gIHJlbmRlclRvQ2FudmFzKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyVG9DYW52YXNPcHRpb25zPik6IFByb21pc2U8dm9pZD47XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbmRlciBhIFR5cHN0IGRvY3VtZW50IHRvIChub24taW5jcmVtZW50YWwpIHN2ZyBzdHJpbmcuXHJcbiAgICogQHBhcmFtIHtSZW5kZXJPcHRpb25zPFJlbmRlclN2Z09wdGlvbnM+fSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yXHJcbiAgICogcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQgdG8gc3BlY2lmaWVkIGNvbnRhaW5lci5cclxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSAtIFRoZSByZW5kZXJlZCBjb250ZW50LlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGxldCBmZXRjaERvYyA9IChwYXRoKSA9PiBmZXRjaChwYXRoKS50aGVuKFxyXG4gICAqICAgcmVzcG9uc2UgPT4gbmV3IFVpbnQ4QXJyYXkocmVzcG9uc2UuYXJyYXlCdWZmZXIoKSkpXHJcbiAgICogY29uc3Qgc3ZnID0gcmVuZGVyZXIucmVuZGVyU3ZnKHtcclxuICAgKiAgIGFydGlmYWN0Q29udGVudDogYXdhaXQgZmV0Y2hEb2MoJ3R5cHN0LW1haW4uc2lyLmluJyksXHJcbiAgICogfSk7XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgcmVuZGVyU3ZnKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyU3ZnT3B0aW9ucz4pOiBQcm9taXNlPHN0cmluZz47XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbmRlciBhIFR5cHN0IGRvY3VtZW50IHRvIHN2Zy5cclxuICAgKiBAcGFyYW0ge1JlbmRlck9wdGlvbnM8UmVuZGVyVG9TdmdPcHRpb25zPn0gb3B0aW9ucyAtIFRoZSBvcHRpb25zIGZvclxyXG4gICAqIHJlbmRlcmluZyBhIFR5cHN0IGRvY3VtZW50IHRvIHNwZWNpZmllZCBjb250YWluZXIuXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogbGV0IGZldGNoRG9jID0gKHBhdGgpID0+IGZldGNoKHBhdGgpLnRoZW4oXHJcbiAgICogICByZXNwb25zZSA9PiBuZXcgVWludDhBcnJheShyZXNwb25zZS5hcnJheUJ1ZmZlcigpKSlcclxuICAgKiByZW5kZXJlci5yZW5kZXJUb1N2Zyh7XHJcbiAgICogICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKSxcclxuICAgKiAgIGFydGlmYWN0Q29udGVudDogYXdhaXQgZmV0Y2hEb2MoJ3R5cHN0LW1haW4uc2lyLmluJyksXHJcbiAgICogfSk7XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgcmVuZGVyVG9Tdmcob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJUb1N2Z09wdGlvbnM+KTogUHJvbWlzZTxib29sZWFuPjtcclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJuIHNlbGVjdGVkIGN1cnJlbnQgc3ZnXHJcbiAgICovXHJcbiAgZ2V0Q3VzdG9tVjEob3B0aW9uczogUmVuZGVySW5TZXNzaW9uT3B0aW9uczx7fT4pOiBQcm9taXNlPGFueT47XHJcblxyXG4gIC8qKlxyXG4gICAqIGV4cGVyaW1lbnRhbFxyXG4gICAqL1xyXG4gIHJlbmRlclN2Z0RpZmYob3B0aW9uczogUmVuZGVySW5TZXNzaW9uT3B0aW9uczxSZW5kZXJTdmdPcHRpb25zPik6IHN0cmluZztcclxuXHJcbiAgLyoqXHJcbiAgICogTWFuaXB1bGF0ZSB0aGUgVHlwc3QgZG9jdW1lbnQgaW4gdGhlIHNlc3Npb24uXHJcbiAgICogU2VlIHtAbGluayBNYW5pcHVsYXRlRGF0YU9wdGlvbnN9IGZvciBtb3JlIGRldGFpbHMuXHJcbiAgICogQHBhcmFtIHtSZW5kZXJTZXNzaW9ufSBzZXNzaW9uIC0gVGhlIFR5cHN0IGRvY3VtZW50IHNlc3Npb24gdGhhdCBoYXMgYmVlblxyXG4gICAqIGNyZWF0ZWQgYnkgVHlwc3RSZW5kZXJlci5cclxuICAgKiBAcGFyYW0ge01hbmlwdWxhdGVEYXRhT3B0aW9uc30gb3B0cyAtIFRoZSBvcHRpb25zIGZvciBtYW5pcHVsYXRpbmcgdGhlXHJcbiAgICogVHlwc3QgZG9jdW1lbnQgaW4gdGhlIHNlc3Npb24uXHJcbiAgICpcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIHJlc2V0IHRoZSBkYXRhIHRvIHRoZSBpbml0aWFsIHN0YXRlLlxyXG4gICAqIGBgYHR5cGVzY3JpcHRcclxuICAgKiBjb25zdCBzZXNzaW9uID0gYXdhaXQgcmVuZGVyZXIuY3JlYXRlU2Vzc2lvbiguLi4pO1xyXG4gICAqIGF3YWl0IHJlbmRlcmVyLm1hbmlwdWxhdGVEYXRhKHNlc3Npb24sIHtcclxuICAgKiAgIGFjdGlvbjogJ3Jlc2V0JyxcclxuICAgKiAgIGRhdGE6IG5ldyBVaW50OEFycmF5KC4uLiksXHJcbiAgICogfSk7XHJcbiAgICogYGBgXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBtZXJnZSB0aGUgZGF0YSB0byB0aGUgY3VycmVudCBzdGF0ZS5cclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHJlbmRlcmVyLmNyZWF0ZVNlc3Npb24oLi4uKTtcclxuICAgKiAvLy8gcmVzZXQgdGhlIGRhdGEgdG8gdGhlIGluaXRpYWwgc3RhdGVcclxuICAgKiBhd2FpdCByZW5kZXJlci5tYW5pcHVsYXRlRGF0YShzZXNzaW9uLCBkYXRhKCdyZXNldCcpKTtcclxuICAgKiAvLy8gbWVyZ2UgdGhlIGRhdGEgdG8gdGhlIGN1cnJlbnQgc3RhdGVcclxuICAgKiBhd2FpdCByZW5kZXJlci5tYW5pcHVsYXRlRGF0YShzZXNzaW9uLCBkYXRhKCdtZXJnZScpKTtcclxuICAgKiAvLy8gaW5jcmVtZW50YWxseSBtZXJnZSB0aGUgZGF0YSBhZ2FpblxyXG4gICAqIGF3YWl0IHJlbmRlcmVyLm1hbmlwdWxhdGVEYXRhKHNlc3Npb24sIGRhdGEoJ21lcmdlJykpO1xyXG4gICAqIGBgYFxyXG4gICAqL1xyXG4gIG1hbmlwdWxhdGVEYXRhKG9wdHM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8TWFuaXB1bGF0ZURhdGFPcHRpb25zPik6IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIFJ1biBhIGZ1bmN0aW9uIHdpdGggYSBzZXNzaW9uLCBhbmQgdGhlIHNlc3NzaW9uIGlzIG9ubHkgYXZhaWxhYmxlIGR1cmluZ1xyXG4gICAqIHRoZSBmdW5jdGlvbiBjYWxsLlxyXG4gICAqXHJcbiAgICogdGhlIGxpZmV0aW1lIG9mIHNlc3Npb24gaXMgcXVpdGUgYnVnLXByb25lLCBzbyB3ZSBjdXJyZW50IGRvZXMgbm90IG1ha2UgaXRcclxuICAgKiBsb25nZXIgbGl2ZSB0aGFuIHRoZSBmdW5jdGlvbiBjYWxsLlxyXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGZuIC0gVGhlIGZ1bmN0aW9uIHRvIHJ1biB3aXRoIGEgc2Vzc2lvbi5cclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxUPn0gLSBUaGUgcmVzdWx0IG9mIHRoZSBmdW5jdGlvbi5cclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIHJ1biBhIGZ1bmN0aW9uIHdpdGggYW4gc2Vzc2lvbiB3aXRoIGVtcHR5IHN0YXRlLlxyXG4gICAqXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGNvbnN0IHJlcyA9IGF3YWl0IHJlbmRlcmVyLnJ1bldpdGhTZXNzaW9uKGFzeW5jIHNlc3Npb24gPT4ge1xyXG4gICAqICAgYXdhaXQgcmVuZGVyZXIubWFuaXB1bGF0ZURhdGEoc2Vzc2lvbiwgZGF0YSgncmVzZXQnKSk7XHJcbiAgICogICByZXR1cm4gYXdhaXQgcmVuZGVyZXIucmVuZGVyVG9DYW52YXMoe1xyXG4gICAqICAgICByZW5kZXJTZXNzaW9uOiBzZXNzaW9uLFxyXG4gICAqICAgICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKSxcclxuICAgKiAgICAgYmFja2dyb3VuZENvbG9yOiAnI2ZmZmZmZicsXHJcbiAgICogICB9KTtcclxuICAgKiB9KTtcclxuICAgKiBgYGBcclxuICAgKlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogcnVuIGEgZnVuY3Rpb24gd2l0aCBhbiBzZXNzaW9uIHdpdGggaW5pdGlhbCBzdGF0ZS5cclxuICAgKlxyXG4gICAqIGBgYHR5cGVzY3JpcHRcclxuICAgKiBjb25zdCByZXMgPSBhd2FpdCByZW5kZXJlci5ydW5XaXRoU2Vzc2lvbih7XHJcbiAgICogICBmb3JtYXQ6ICd2ZWN0b3InLFxyXG4gICAqICAgYXJ0aWZhY3RDb250ZW50OiBuZXcgVWludDhBcnJheSguLi4pLFxyXG4gICAqIH0sIHdvcmtXaXRoU2Vzc2lvbihzZXNzaW9uKSk7XHJcbiAgICogYGBgXHJcbiAgICpcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIGxlYWsgdGhlIGxpZmUgc3BhbiBvZiBzZXNzaW9uIChuZWVkIHR5cGVzY3JpcHQgPj0gdjUuMilcclxuICAgKlxyXG4gICAqIGBgYHR5cGVzY3JpcHRcclxuICAgKiBjbGFzcyBTdGFja2VkU2Vzc2lvbiB7XHJcbiAgICogICBzZXNzaW9uOiBSZW5kZXJTZXNzaW9uO1xyXG4gICAqICAgcHJpdmF0ZSByZXNvbHZlOiAoc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gdm9pZDtcclxuICAgKiAgIFtTeW1ib2wuZGlzcG9zZV0oKSB7XHJcbiAgICogICAgIHRoaXMucmVzb2x2ZSgpO1xyXG4gICAqICAgfVxyXG4gICAqICAgc3RhdGljIGFzeW5jIGNyZWF0ZSgpIHtcclxuICAgKiAgICAgcmV0dXJuIG5ldyBQcm9taXNlPFN0YWNrZWRTZXNzaW9uPihyZXNvbHZlID0+IHtcclxuICAgKiAgICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgcmVuZGVyZXIucnVuV2l0aFNlc3Npb24oc2Vzc2lvbiA9PiB7XHJcbiAgICogICAgICAgY29uc3Qgc3RhY2tlZFNlc3Npb24gPSBuZXcgU3RhY2tlZFNlc3Npb24oKTtcclxuICAgKiAgICAgICBzdGFja2VkU2Vzc2lvbi5zZXNzaW9uID0gc2Vzc2lvbjtcclxuICAgKiAgICAgICBzdGFja2VkU2Vzc2lvbi5yZXNvbHZlID0gcmVzb2x2ZTtcclxuICAgKiAgICAgICByZXR1cm4gc3RhY2tlZFNlc3Npb247XHJcbiAgICogICAgIH0pO1xyXG4gICAqICAgfVxyXG4gICAqIH1cclxuICAgKlxyXG4gICAqIHtcclxuICAgKiAgIGF3YWl0IHVzaW5nIHNlc3Npb24gPSBTdGFja2VkU2Vzc2lvbi5jcmVhdGUoKTtcclxuICAgKiAgIC8vLyBkbyBzb21ldGhpbmcgd2l0aCBzZXNzaW9uXHJcbiAgICogfVxyXG4gICAqIGBgYFxyXG4gICAqL1xyXG4gIHJ1bldpdGhTZXNzaW9uPFQ+KGZuOiAoc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD47XHJcbiAgcnVuV2l0aFNlc3Npb248VD4oXHJcbiAgICBvcHRpb25zOiBDcmVhdGVTZXNzaW9uT3B0aW9ucyxcclxuICAgIGZuOiAoc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gUHJvbWlzZTxUPixcclxuICApOiBQcm9taXNlPFQ+O1xyXG5cclxuICBjcmVhdGVXb3JrZXJWMCh3b3JrZXI6IFdvcmtlcik6IFByb21pc2U8VHlwc3RXb3JrZXI+O1xyXG5cclxuICByZW5kZXJEb20ob3B0aW9uczogUmVuZGVySW5TZXNzaW9uT3B0aW9uczxNb3VudERvbU9wdGlvbnM+KTogUHJvbWlzZTxUeXBzdERvbURvY3VtZW50PjtcclxuXHJcbiAgLyoqXHJcbiAgICogYWxpYXMgdG8ge0BsaW5rIFR5cHN0UmVuZGVyZXIjcmVuZGVyVG9DYW52YXN9LCB3aWxsIHJlbW92ZSBpbiB2MC41LjBcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqIHVzZSB7QGxpbmsgcmVuZGVyVG9DYW52YXN9IGluc3RlYWRcclxuICAgKi9cclxuICByZW5kZXIob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJUb0NhbnZhc09wdGlvbnM+KTogUHJvbWlzZTx2b2lkPjtcclxufVxyXG5cclxuY29uc3QgZ1JlbmRlcmVyTW9kdWxlID0gKG1vZHVsZTogdHlwZW9mIHR5cHN0KSA9PlxyXG4gIG5ldyBMYXp5V2FzbU1vZHVsZShhc3luYyAoYmluPzogYW55KSA9PiB7XHJcbiAgICByZXR1cm4gYXdhaXQgbW9kdWxlLmRlZmF1bHQoYmluKTtcclxuICB9KTtcclxuXHJcbi8qKlxyXG4gKiBjcmVhdGUgYSBUeXBzdCByZW5kZXJlci5cclxuICogQHJldHVybnMge1R5cHN0UmVuZGVyZXJ9IC0gVGhlIFR5cHN0IHJlbmRlcmVyLlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGB0eXBlc2NyaXB0XHJcbiAqIGltcG9ydCB7IGNyZWF0ZVR5cHN0UmVuZGVyZXIgfSBmcm9tICd0eXBzdCc7XHJcbiAqIGNvbnN0IHJlbmRlcmVyID0gY3JlYXRlVHlwc3RSZW5kZXJlcigpO1xyXG4gKiBhd2FpdCByZW5kZXJlci5pbml0KCk7XHJcbiAqIGF3YWl0IHJlbmRlcmVyLnJlbmRlcih7XHJcbiAqICAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFpbmVyJyksXHJcbiAqICAgYXJ0aWZhY3RDb250ZW50OiAneyAuLi4gfScsXHJcbiAqIH0pO1xyXG4gKiBgYGBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUeXBzdFJlbmRlcmVyKCk6IFR5cHN0UmVuZGVyZXIge1xyXG4gIHJldHVybiBuZXcgVHlwc3RSZW5kZXJlckRyaXZlcigpO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFR5cHN0U3ZnUmVuZGVyZXIge1xyXG4gIGluaXQob3B0aW9ucz86IFBhcnRpYWw8SW5pdE9wdGlvbnM+KTogUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIGEgc3ZnIHNlc3Npb24uXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKiB1c2Uge0BsaW5rIFR5cHN0UmVuZGVyZXJbJ3J1bldpdGhTZXNzaW9uJ119IGluc3RlYWRcclxuICAgKi9cclxuICBjcmVhdGVNb2R1bGUoYjogVWludDhBcnJheSk6IFByb21pc2U8UmVuZGVyU2Vzc2lvbj47XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbmRlciBhIFR5cHN0IGRvY3VtZW50IHRvIHN2Zy5cclxuICAgKiBAcGFyYW0ge1JlbmRlck9wdGlvbnM8UmVuZGVyVG9TdmdPcHRpb25zPn0gb3B0aW9ucyAtIFRoZSBvcHRpb25zIGZvclxyXG4gICAqIHJlbmRlcmluZyBhIFR5cHN0IGRvY3VtZW50IHRvIHNwZWNpZmllZCBjb250YWluZXIuXHJcbiAgICogQHJldHVybnMge3ZvaWR9IC0gVGhlIHJlc3VsdCBvZiByZW5kZXJpbmcgYSBUeXBzdCBkb2N1bWVudC5cclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIGBgYHR5cGVzY3JpcHRcclxuICAgKiBsZXQgZmV0Y2hEb2MgPSAocGF0aCkgPT4gZmV0Y2gocGF0aCkudGhlbihcclxuICAgKiAgIHJlc3BvbnNlID0+IG5ldyBVaW50OEFycmF5KHJlc3BvbnNlLmFycmF5QnVmZmVyKCkpKVxyXG4gICAqIHJlbmRlcmVyLnJlbmRlclRvU3ZnKHtcclxuICAgKiAgIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhaW5lcicpLFxyXG4gICAqICAgYXJ0aWZhY3RDb250ZW50OiBhd2FpdCBmZXRjaERvYygndHlwc3QtbWFpbi5zaXIuaW4nKSxcclxuICAgKiB9KTtcclxuICAgKiBgYGBcclxuICAgKi9cclxuICByZW5kZXJUb1N2ZyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclRvU3ZnT3B0aW9ucz4pOiBQcm9taXNlPGJvb2xlYW4+O1xyXG59XHJcblxyXG4vKipcclxuICogQGRlcHJlY2F0ZWRcclxuICogdXNlIHtAbGluayBjcmVhdGVUeXBzdFJlbmRlcmVyfSBpbnN0ZWFkXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVHlwc3RTdmdSZW5kZXJlcigpOiBUeXBzdFN2Z1JlbmRlcmVyIHtcclxuICByZXR1cm4gbmV3IFR5cHN0UmVuZGVyZXJEcml2ZXIoKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlbmRlcmVyQnVpbGRJbmZvKCk6IFByb21pc2U8YW55PiB7XHJcbiAgY29uc3QgcmVuZGVyTW9kdWxlID0gYXdhaXQgaW1wb3J0KCdAbXlyaWFkZHJlYW1pbi90eXBzdC10cy1yZW5kZXJlci9wa2cvd2FzbS1wYWNrLXNoaW0ubWpzJyk7XHJcbiAgcmV0dXJuIHJlbmRlck1vZHVsZS5yZW5kZXJlcl9idWlsZF9pbmZvKCk7XHJcbn1cclxuXHJcbmxldCB3YXJuT25jZUNhbnZhc1NldCA9IHRydWU7XHJcblxyXG4vKiogQGludGVybmFsICovXHJcbmV4cG9ydCBjbGFzcyBUeXBzdFJlbmRlcmVyRHJpdmVyIHtcclxuICByZW5kZXJlcjogdHlwc3QuVHlwc3RSZW5kZXJlcjtcclxuICByZW5kZXJlckpzOiB0eXBlb2YgdHlwc3Q7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge31cclxuXHJcbiAgYXN5bmMgaW5pdChvcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRoaXMucmVuZGVyZXJKcyA9IGF3YWl0IChvcHRpb25zPy5nZXRXcmFwcGVyPy4oKSB8fFxyXG4gICAgICBpbXBvcnQoJ0BteXJpYWRkcmVhbWluL3R5cHN0LXRzLXJlbmRlcmVyL3BrZy93YXNtLXBhY2stc2hpbS5tanMnKSk7XHJcbiAgICBjb25zdCBUeXBzdFJlbmRlcmVyQnVpbGRlciA9IHRoaXMucmVuZGVyZXJKcy5UeXBzdFJlbmRlcmVyQnVpbGRlcjtcclxuICAgIHRoaXMucmVuZGVyZXIgPSBhd2FpdCBidWlsZENvbXBvbmVudChcclxuICAgICAgb3B0aW9ucyxcclxuICAgICAgZ1JlbmRlcmVyTW9kdWxlKHRoaXMucmVuZGVyZXJKcyksXHJcbiAgICAgIFR5cHN0UmVuZGVyZXJCdWlsZGVyLFxyXG4gICAgICB7fSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBsb2FkR2x5cGhQYWNrKF9wYWNrOiB1bmtub3duKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAvLyB0aGlzLnJlbmRlcmVyLmxvYWRfZ2x5cGhfcGFjayhwYWNrKTtcclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlT3B0aW9uc1RvUnVzdChvcHRpb25zOiBQYXJ0aWFsPENyZWF0ZVNlc3Npb25PcHRpb25zPik6IHR5cHN0LkNyZWF0ZVNlc3Npb25PcHRpb25zIHtcclxuICAgIGNvbnN0IHJ1c3RPcHRpb25zID0gbmV3IHRoaXMucmVuZGVyZXJKcy5DcmVhdGVTZXNzaW9uT3B0aW9ucygpO1xyXG5cclxuICAgIGlmIChvcHRpb25zLmZvcm1hdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHJ1c3RPcHRpb25zLmZvcm1hdCA9IG9wdGlvbnMuZm9ybWF0O1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChvcHRpb25zLmFydGlmYWN0Q29udGVudCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHJ1c3RPcHRpb25zLmFydGlmYWN0X2NvbnRlbnQgPSBvcHRpb25zLmFydGlmYWN0Q29udGVudDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcnVzdE9wdGlvbnM7XHJcbiAgfVxyXG5cclxuICBjYW52YXNPcHRpb25zVG9SdXN0KG9wdGlvbnM6IFJlbmRlckNhbnZhc09wdGlvbnMpOiB0eXBzdC5SZW5kZXJQYWdlSW1hZ2VPcHRpb25zIHtcclxuICAgIGNvbnN0IHJ1c3RPcHRpb25zID0gbmV3IHRoaXMucmVuZGVyZXJKcy5SZW5kZXJQYWdlSW1hZ2VPcHRpb25zKCk7XHJcbiAgICBpZiAob3B0aW9ucy5wYWdlT2Zmc2V0ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdwYWdlT2Zmc2V0IGlzIHJlcXVpcmVkIGluIHJlZmxleG8gdjAuNS4wJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBydXN0T3B0aW9ucy5wYWdlX29mZiA9IG9wdGlvbnMucGFnZU9mZnNldDtcclxuICAgIH1cclxuICAgIGlmIChvcHRpb25zLmNhY2hlS2V5ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgcnVzdE9wdGlvbnMuY2FjaGVfa2V5ID0gb3B0aW9ucy5jYWNoZUtleTtcclxuICAgIH1cclxuICAgIGlmIChvcHRpb25zLmJhY2tncm91bmRDb2xvciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHJ1c3RPcHRpb25zLmJhY2tncm91bmRfY29sb3IgPSBvcHRpb25zLmJhY2tncm91bmRDb2xvcjtcclxuICAgIH1cclxuICAgIGlmIChvcHRpb25zLnBpeGVsUGVyUHQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBydXN0T3B0aW9ucy5waXhlbF9wZXJfcHQgPSBvcHRpb25zLnBpeGVsUGVyUHQ7XHJcbiAgICB9XHJcbiAgICBpZiAob3B0aW9ucy5kYXRhU2VsZWN0aW9uICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgbGV0IGVuY29kZWQgPSAwO1xyXG4gICAgICBpZiAob3B0aW9ucy5kYXRhU2VsZWN0aW9uLmJvZHkpIHtcclxuICAgICAgICBlbmNvZGVkIHw9IDEgPDwgMDtcclxuICAgICAgfSBlbHNlIGlmIChvcHRpb25zLmNhbnZhcyAmJiB3YXJuT25jZUNhbnZhc1NldCkge1xyXG4gICAgICAgIHdhcm5PbmNlQ2FudmFzU2V0ID0gZmFsc2U7XHJcbiAgICAgICAgY29uc29sZS53YXJuKCdkYXRhU2VsZWN0aW9uLmJvZHkgaXMgbm90IHNldCBidXQgcHJvdmlkaW5nIGNhbnZhcyBmb3IgYm9keScpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvcHRpb25zLmRhdGFTZWxlY3Rpb24udGV4dCB8fCBvcHRpb25zLmRhdGFTZWxlY3Rpb24uYW5ub3RhdGlvbikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ2RhdGFTZWxlY3Rpb24udGV4dCBhbmQgZGF0YVNlbGVjdGlvbi5hbm5vdGF0aW9uIGFyZSBkZXByZWNhdGVkJyk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9wdGlvbnMuZGF0YVNlbGVjdGlvbi5zZW1hbnRpY3MpIHtcclxuICAgICAgICBlbmNvZGVkIHw9IDEgPDwgMztcclxuICAgICAgfVxyXG4gICAgICBydXN0T3B0aW9ucy5kYXRhX3NlbGVjdGlvbiA9IGVuY29kZWQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcnVzdE9wdGlvbnM7XHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZVBhZ2VzSW5mb0Zyb21TZXNzaW9uKHNlc3Npb246IFJlbmRlclNlc3Npb24pOiBQYWdlSW5mb1tdIHtcclxuICAgIHJldHVybiBzZXNzaW9uLnJldHJpZXZlUGFnZXNJbmZvKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW5kZXIgYSBUeXBzdCBkb2N1bWVudCB0byBjYW52YXMuXHJcbiAgICovXHJcbiAgcmVuZGVyQ2FudmFzKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyQ2FudmFzT3B0aW9ucz4pOiBQcm9taXNlPFJlbmRlckNhbnZhc1Jlc3VsdD4ge1xyXG4gICAgcmV0dXJuIHRoaXMud2l0aGluT3B0aW9uU2Vzc2lvbihvcHRpb25zLCBhc3luYyBzZXNzaW9uUmVmID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyZXIucmVuZGVyX3BhZ2VfdG9fY2FudmFzKFxyXG4gICAgICAgIHNlc3Npb25SZWZba09iamVjdF0sXHJcbiAgICAgICAgb3B0aW9ucy5jYW52YXMgfHwgdW5kZWZpbmVkLFxyXG4gICAgICAgIHRoaXMuY2FudmFzT3B0aW9uc1RvUnVzdChvcHRpb25zKSxcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gYXN5bmMgcmVuZGVyUGRmKGFydGlmYWN0Q29udGVudDogc3RyaW5nKTogUHJvbWlzZTxVaW50OEFycmF5PiB7XHJcbiAgLy8gcmV0dXJuIHRoaXMucmVuZGVyZXIucmVuZGVyX3RvX3BkZihhcnRpZmFjdENvbnRlbnQpO1xyXG4gIC8vIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBpbkFuaW1hdGlvbkZyYW1lPFQ+KGZuOiAoKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICByZXNvbHZlKGZuKCkpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIHJlbmRlckRpc3BsYXlMYXllcihcclxuICAgIHNlc3Npb246IFJlbmRlclNlc3Npb24sXHJcbiAgICBjYW52YXNMaXN0OiBIVE1MQ2FudmFzRWxlbWVudFtdLFxyXG4gICAgb3B0aW9uczogUmVuZGVyVG9DYW52YXNPcHRpb25zLFxyXG4gICk6IFByb21pc2U8UmVuZGVyQ2FudmFzUmVzdWx0W10+IHtcclxuICAgIGNvbnN0IHBhZ2VzX2luZm8gPSBzZXNzaW9uW2tPYmplY3RdLnBhZ2VzX2luZm87XHJcbiAgICBjb25zdCBwYWdlX2NvdW50ID0gcGFnZXNfaW5mby5wYWdlX2NvdW50O1xyXG5cclxuICAgIGNvbnN0IGRvUmVuZGVyID0gYXN5bmMgKGk6IG51bWJlciwgcGFnZV9vZmY6IG51bWJlcikgPT4ge1xyXG4gICAgICBjb25zdCBjYW52YXMgPSBjYW52YXNMaXN0W2ldO1xyXG4gICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuICAgICAgaWYgKCFjdHgpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NhbnZhcyBjb250ZXh0IGlzIG51bGwnKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5yZW5kZXJDYW52YXMoe1xyXG4gICAgICAgIC4uLm9wdGlvbnMsXHJcbiAgICAgICAgY2FudmFzOiBjdHgsXHJcbiAgICAgICAgcmVuZGVyU2Vzc2lvbjogc2Vzc2lvbixcclxuICAgICAgICBwYWdlT2Zmc2V0OiBwYWdlX29mZixcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHQgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgIGNvbnN0IHRleHRDb250ZW50TGlzdCA9IGF3YWl0IChhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdHM6IFJlbmRlckNhbnZhc1Jlc3VsdFtdID0gW107XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFnZV9jb3VudDsgaSsrKSB7XHJcbiAgICAgICAgcmVzdWx0cy5wdXNoKGF3YWl0IHRoaXMuaW5BbmltYXRpb25GcmFtZSgoKSA9PiBkb1JlbmRlcihpLCBpKSkpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gcmVzdWx0cztcclxuICAgIH0pKCk7XHJcbiAgICBjb25zdCB0MiA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGBkaXNwbGF5IGxheWVyIHVzZWQ6IHJlbmRlciA9ICR7KHQyIC0gdCkudG9GaXhlZCgxKX1tc2ApO1xyXG5cclxuICAgIHJldHVybiB0ZXh0Q29udGVudExpc3Q7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlbmRlclRleHRMYXllcihsYXllckxpc3Q6IEhUTUxEaXZFbGVtZW50W10sIHRleHRTb3VyY2VMaXN0OiBSZW5kZXJDYW52YXNSZXN1bHRbXSkge1xyXG4gICAgY29uc3QgdDIgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgIGxheWVyTGlzdC5mb3JFYWNoKChsYXllciwgaSkgPT4ge1xyXG4gICAgICBsYXllci5pbm5lckhUTUwgPSB0ZXh0U291cmNlTGlzdFtpXS5odG1sU2VtYW50aWNzWzBdO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCB0MyA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gICAgY29uc29sZS5sb2coYHRleHQgbGF5ZXIgdXNlZDogcmVuZGVyID0gJHsodDMgLSB0MikudG9GaXhlZCgxKX1tc2ApO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcmVuZGVyKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyVG9DYW52YXNPcHRpb25zPik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgaWYgKCdmb3JtYXQnIGluIG9wdGlvbnMpIHtcclxuICAgICAgaWYgKG9wdGlvbnMuZm9ybWF0ICE9PSAndmVjdG9yJykge1xyXG4gICAgICAgIGNvbnN0IGFydGlmYWN0Rm9ybWF0cyA9IFsnc2VyZGVfanNvbicsICdqcycsICdpciddIGFzIGNvbnN0O1xyXG4gICAgICAgIGlmIChhcnRpZmFjdEZvcm1hdHMuaW5jbHVkZXMob3B0aW9ucy5mb3JtYXQgYXMgYW55KSkge1xyXG4gICAgICAgICAgLy8gZGVwcmVjYXRlZFxyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBkZXByZWNhdGVkIGZvcm1hdCAke29wdGlvbnMuZm9ybWF0fSwgcGxlYXNlIHVzZSB2ZWN0b3IgZm9ybWF0YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMucmVuZGVyVG9DYW52YXMob3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICBhc3luYyByZW5kZXJEb20ob3B0aW9uczogUmVuZGVySW5TZXNzaW9uT3B0aW9uczxNb3VudERvbU9wdGlvbnM+KTogUHJvbWlzZTxUeXBzdERvbURvY3VtZW50PiB7XHJcbiAgICBpZiAoJ2Zvcm1hdCcgaW4gb3B0aW9ucykge1xyXG4gICAgICBpZiAob3B0aW9ucy5mb3JtYXQgIT09ICd2ZWN0b3InKSB7XHJcbiAgICAgICAgY29uc3QgYXJ0aWZhY3RGb3JtYXRzID0gWydzZXJkZV9qc29uJywgJ2pzJywgJ2lyJ10gYXMgY29uc3Q7XHJcbiAgICAgICAgaWYgKGFydGlmYWN0Rm9ybWF0cy5pbmNsdWRlcyhvcHRpb25zLmZvcm1hdCBhcyBhbnkpKSB7XHJcbiAgICAgICAgICAvLyBkZXByZWNhdGVkXHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGRlcHJlY2F0ZWQgZm9ybWF0ICR7b3B0aW9ucy5mb3JtYXR9LCBwbGVhc2UgdXNlIHZlY3RvciBmb3JtYXRgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy53aXRoaW5PcHRpb25TZXNzaW9uKG9wdGlvbnMsIGFzeW5jIHNlc3Npb25SZWYgPT4ge1xyXG4gICAgICBjb25zdCB0ID0gbmV3IFR5cHN0RG9tRG9jdW1lbnQoe1xyXG4gICAgICAgIC4uLm9wdGlvbnMsXHJcbiAgICAgICAgcmVuZGVyTW9kZTogJ2RvbScsXHJcbiAgICAgICAgaG9va2VkRWxlbTogb3B0aW9ucy5jb250YWluZXIsXHJcbiAgICAgICAga01vZHVsZTogc2Vzc2lvblJlZixcclxuICAgICAgICByZW5kZXJlcjogdGhpcyxcclxuICAgICAgfSk7XHJcbiAgICAgIHQ7XHJcbiAgICAgIGF3YWl0IHQuaW1wbC5tb3VudERvbShvcHRpb25zLnBpeGVsUGVyUHQpO1xyXG4gICAgICByZXR1cm4gdDtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcmVuZGVyVG9DYW52YXMob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJUb0NhbnZhc09wdGlvbnM+KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBsZXQgc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbjtcclxuICAgIGxldCByZW5kZXJQYWdlUmVzdWx0czogUmVuZGVyQ2FudmFzUmVzdWx0W107XHJcbiAgICBjb25zdCBtb3VudENvbnRhaW5lciA9IG9wdGlvbnMuY29udGFpbmVyO1xyXG4gICAgbW91bnRDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xyXG5cclxuICAgIGNvbnN0IGRvUmVuZGVyRGlzcGxheUxheWVyID0gYXN5bmMgKFxyXG4gICAgICBjYW52YXNMaXN0OiBIVE1MQ2FudmFzRWxlbWVudFtdLFxyXG4gICAgICByZXNldExheW91dDogKCkgPT4gdm9pZCxcclxuICAgICkgPT4ge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHJlbmRlclBhZ2VSZXN1bHRzID0gYXdhaXQgdGhpcy5yZW5kZXJEaXNwbGF5TGF5ZXIoc2Vzc2lvbiwgY2FudmFzTGlzdCwgb3B0aW9ucyk7XHJcbiAgICAgICAgcmVzZXRMYXlvdXQoKTtcclxuICAgICAgfSBmaW5hbGx5IHtcclxuICAgICAgICBtb3VudENvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB0aGlzLndpdGhpbk9wdGlvblNlc3Npb24ob3B0aW9ucywgYXN5bmMgc2Vzc2lvblJlZiA9PiB7XHJcbiAgICAgIHNlc3Npb24gPSBzZXNzaW9uUmVmO1xyXG4gICAgICBpZiAoc2Vzc2lvbltrT2JqZWN0XS5wYWdlc19pbmZvLnBhZ2VfY291bnQgPT09IDApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIHBhZ2UgZm91bmQgaW4gc2Vzc2lvbmApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAob3B0aW9ucy5waXhlbFBlclB0ICE9PSB1bmRlZmluZWQgJiYgb3B0aW9ucy5waXhlbFBlclB0IDw9IDApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICAgICAnSW52YWxpZCB0eXBzdC5SZW5kZXJPcHRpb25zLnBpeGVsUGVyUHQsIHNob3VsZCBiZSBhIHBvc2l0aXZlIG51bWJlciAnICtcclxuICAgICAgICAgICAgb3B0aW9ucy5waXhlbFBlclB0LFxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCBiYWNrZ3JvdW5kQ29sb3IgPSBvcHRpb25zLmJhY2tncm91bmRDb2xvcjtcclxuICAgICAgaWYgKGJhY2tncm91bmRDb2xvciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgaWYgKCEvXiNbMC05YS1mXXs2fSQvLnRlc3QoYmFja2dyb3VuZENvbG9yKSkge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAgICAgICAnSW52YWxpZCB0eXBzdC5iYWNrZ3JvdW5kQ29sb3IgY29sb3IgZm9yIG1hdGNoaW5nIF4jP1swLTlhLWZdezZ9JCAnICsgYmFja2dyb3VuZENvbG9yLFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHNlc3Npb24ucGl4ZWxQZXJQdCA9IG9wdGlvbnMucGl4ZWxQZXJQdCA/PyBUeXBzdERlZmF1bHRQYXJhbXMuUElYRUxfUEVSX1BUO1xyXG4gICAgICBzZXNzaW9uLmJhY2tncm91bmRDb2xvciA9IGJhY2tncm91bmRDb2xvciA/PyAnI2ZmZmZmZic7XHJcblxyXG4gICAgICBjb25zdCB0ID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcblxyXG4gICAgICBjb25zdCBwYWdlVmlldyA9IG5ldyBSZW5kZXJWaWV3KFxyXG4gICAgICAgIHRoaXMucmV0cmlldmVQYWdlc0luZm9Gcm9tU2Vzc2lvbihzZXNzaW9uKSxcclxuICAgICAgICBtb3VudENvbnRhaW5lcixcclxuICAgICAgICBvcHRpb25zLFxyXG4gICAgICApO1xyXG4gICAgICBjb25zdCB0MiA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG5cclxuICAgICAgY29uc29sZS5sb2coYGxheWVyIHVzZWQ6IHJldGlldmUgPSAkeyh0MiAtIHQpLnRvRml4ZWQoMSl9bXNgKTtcclxuXHJcbiAgICAgIGF3YWl0IGRvUmVuZGVyRGlzcGxheUxheWVyKHBhZ2VWaWV3LmNhbnZhc0xpc3QsICgpID0+IHBhZ2VWaWV3LnJlc2V0TGF5b3V0KCkpO1xyXG4gICAgICB0aGlzLnJlbmRlclRleHRMYXllcihwYWdlVmlldy50ZXh0TGF5ZXJMaXN0LCByZW5kZXJQYWdlUmVzdWx0cyk7XHJcblxyXG4gICAgICByZXR1cm47XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNyZWF0ZU1vZHVsZShiPzogVWludDhBcnJheSk6IFByb21pc2U8UmVuZGVyU2Vzc2lvbj4ge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShcclxuICAgICAgbmV3IFJlbmRlclNlc3Npb24oXHJcbiAgICAgICAgdGhpcyxcclxuICAgICAgICB0aGlzLnJlbmRlcmVyLmNyZWF0ZV9zZXNzaW9uKFxyXG4gICAgICAgICAgYiAmJlxyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZU9wdGlvbnNUb1J1c3Qoe1xyXG4gICAgICAgICAgICAgIGZvcm1hdDogJ3ZlY3RvcicsXHJcbiAgICAgICAgICAgICAgYXJ0aWZhY3RDb250ZW50OiBiLFxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICApLFxyXG4gICAgICApLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGNyZWF0ZVdvcmtlclYwKHdvcmtlcjogV29ya2VyKSB7XHJcbiAgICByZXR1cm4gbmV3IFR5cHN0V29ya2VyKHRoaXMsIGF3YWl0IHRoaXMucmVuZGVyZXIuY3JlYXRlX3dvcmtlcih3b3JrZXIpKTtcclxuICB9XHJcblxyXG4gIHdvcmtlckJyaWRnZSgpIHtcclxuICAgIHJldHVybiB0aGlzLnJlbmRlcmVyLmNyZWF0ZV93b3JrZXJfYnJpZGdlKCk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJTdmcob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJTdmdPcHRpb25zPiwgY29udGFpbmVyPzogYW55KTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIGlmIChvcHRpb25zIGluc3RhbmNlb2YgUmVuZGVyU2Vzc2lvbiB8fCBjb250YWluZXIpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdyZW1vdmVkIGFwaSwgcGxlYXNlIHVzZSByZW5kZXJUb1N2Zyh7IHJlbmRlclNlc3Npb24sIGNvbnRhaW5lciB9KSBpbnN0ZWFkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMud2l0aGluT3B0aW9uU2Vzc2lvbihvcHRpb25zLCBhc3luYyBzZXNzaW9uUmVmID0+IHtcclxuICAgICAgbGV0IHBhcnRzOiBudW1iZXIgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgIGlmIChvcHRpb25zLmRhdGFfc2VsZWN0aW9uKSB7XHJcbiAgICAgICAgcGFydHMgPSAwO1xyXG4gICAgICAgIGlmIChvcHRpb25zLmRhdGFfc2VsZWN0aW9uLmJvZHkpIHtcclxuICAgICAgICAgIHBhcnRzIHw9IDEgPDwgMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG9wdGlvbnMuZGF0YV9zZWxlY3Rpb24uZGVmcykge1xyXG4gICAgICAgICAgcGFydHMgfD0gMSA8PCAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob3B0aW9ucy5kYXRhX3NlbGVjdGlvbi5jc3MpIHtcclxuICAgICAgICAgIHBhcnRzIHw9IDEgPDwgMjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG9wdGlvbnMuZGF0YV9zZWxlY3Rpb24uanMpIHtcclxuICAgICAgICAgIHBhcnRzIHw9IDEgPDwgMztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5yZW5kZXJlci5zdmdfZGF0YShzZXNzaW9uUmVmW2tPYmplY3RdLCBwYXJ0cykpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJTdmdEaWZmKG9wdGlvbnM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8UmVuZGVyU3ZnT3B0aW9ucz4pOiBzdHJpbmcge1xyXG4gICAgaWYgKCFvcHRpb25zLndpbmRvdykge1xyXG4gICAgICByZXR1cm4gdGhpcy5yZW5kZXJlci5yZW5kZXJfc3ZnX2RpZmYoXHJcbiAgICAgICAgKG9wdGlvbnMucmVuZGVyU2Vzc2lvbiBhcyBhbnkpW2tPYmplY3RdLFxyXG4gICAgICAgIDAsXHJcbiAgICAgICAgMCxcclxuICAgICAgICAxZTMzLFxyXG4gICAgICAgIDFlMzMsXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMucmVuZGVyZXIucmVuZGVyX3N2Z19kaWZmKFxyXG4gICAgICAob3B0aW9ucy5yZW5kZXJTZXNzaW9uIGFzIGFueSlba09iamVjdF0sXHJcbiAgICAgIG9wdGlvbnMud2luZG93LmxvLngsXHJcbiAgICAgIG9wdGlvbnMud2luZG93LmxvLnksXHJcbiAgICAgIG9wdGlvbnMud2luZG93LmhpLngsXHJcbiAgICAgIG9wdGlvbnMud2luZG93LmhpLnksXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyVG9Tdmcob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJUb1N2Z09wdGlvbnM+KTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICByZXR1cm4gdGhpcy53aXRoaW5PcHRpb25TZXNzaW9uKG9wdGlvbnMsIGFzeW5jIHNlc3Npb25SZWYgPT4ge1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMucmVuZGVyZXIucmVuZGVyX3N2ZyhzZXNzaW9uUmVmW2tPYmplY3RdLCBvcHRpb25zLmNvbnRhaW5lcikpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRDdXN0b21WMShvcHRpb25zOiBSZW5kZXJJblNlc3Npb25PcHRpb25zPHt9Pik6IFByb21pc2U8YW55PiB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMucmVuZGVyZXIuZ2V0X2N1c3RvbXMob3B0aW9ucy5yZW5kZXJTZXNzaW9uW2tPYmplY3RdKSk7XHJcbiAgfVxyXG5cclxuICByZXNldFNlc3Npb24oc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbik6IHZvaWQge1xyXG4gICAgcmV0dXJuIHRoaXMucmVuZGVyZXIucmVzZXQoc2Vzc2lvbltrT2JqZWN0XSk7XHJcbiAgfVxyXG5cclxuICBtYW5pcHVsYXRlRGF0YShvcHRzOiBSZW5kZXJJblNlc3Npb25PcHRpb25zPE1hbmlwdWxhdGVEYXRhT3B0aW9ucz4pOiB2b2lkIHtcclxuICAgIHJldHVybiB0aGlzLnJlbmRlcmVyLm1hbmlwdWxhdGVfZGF0YShcclxuICAgICAgKG9wdHMucmVuZGVyU2Vzc2lvbiBhcyBhbnkpW2tPYmplY3RdIGFzIHR5cHN0LlJlbmRlclNlc3Npb24sXHJcbiAgICAgIG9wdHMuYWN0aW9uID8/ICdyZXNldCcsXHJcbiAgICAgIG9wdHMuZGF0YSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHdpdGhpbk9wdGlvblNlc3Npb248VD4oXHJcbiAgICBvcHRpb25zOiBSZW5kZXJPcHRpb25zPGFueT4sXHJcbiAgICBmbjogKHNlc3Npb246IFJlbmRlclNlc3Npb24pID0+IFByb21pc2U8VD4sXHJcbiAgKTogUHJvbWlzZTxUPiB7XHJcbiAgICBmdW5jdGlvbiBpc1JlbmRlckJ5Q29udGVudE9wdGlvbihvcHRpb25zOiBSZW5kZXJPcHRpb25zPGFueT4pOiBvcHRpb25zIGlzIENyZWF0ZVNlc3Npb25PcHRpb25zIHtcclxuICAgICAgcmV0dXJuICdhcnRpZmFjdENvbnRlbnQnIGluIG9wdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCdyZW5kZXJTZXNzaW9uJyBpbiBvcHRpb25zKSB7XHJcbiAgICAgIHJldHVybiBmbihvcHRpb25zLnJlbmRlclNlc3Npb24gYXMgUmVuZGVyU2Vzc2lvbik7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGlzUmVuZGVyQnlDb250ZW50T3B0aW9uKG9wdGlvbnMpKSB7XHJcbiAgICAgIC8vIHRvZG86IHJlbW92ZSBhbnlcclxuICAgICAgcmV0dXJuIHRoaXMucnVuV2l0aFNlc3Npb24ob3B0aW9ucyBhcyBhbnksIGZuIGFzIGFueSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAnSW52YWxpZCByZW5kZXIgb3B0aW9ucywgc2hvdWxkIGJlIG9uZSBvZiBSZW5kZXJCeUNvbnRlbnRPcHRpb25zfFJlbmRlckJ5U2Vzc2lvbk9wdGlvbnMnLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHJ1bldpdGhTZXNzaW9uPFQ+KGZuOiAoc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD47XHJcbiAgcnVuV2l0aFNlc3Npb248VD4oXHJcbiAgICBvcHRpb25zOiBDcmVhdGVTZXNzaW9uT3B0aW9ucyxcclxuICAgIGZuOiAoc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gUHJvbWlzZTxUPixcclxuICApOiBQcm9taXNlPFQ+O1xyXG4gIGFzeW5jIHJ1bldpdGhTZXNzaW9uPFQ+KGFyZzE6IGFueSwgYXJnMj86IGFueSk6IFByb21pc2U8VD4ge1xyXG4gICAgbGV0IG9wdGlvbnM6IFBhcnRpYWw8Q3JlYXRlU2Vzc2lvbk9wdGlvbnM+IHwgdW5kZWZpbmVkID0gYXJnMTtcclxuICAgIGxldCBmbjogKHNlc3Npb246IFJlbmRlclNlc3Npb24pID0+IFByb21pc2U8VD4gPSBhcmcyO1xyXG5cclxuICAgIGlmICghYXJnMikge1xyXG4gICAgICBvcHRpb25zID0gdW5kZWZpbmVkO1xyXG4gICAgICBmbiA9IGFyZzE7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMucmVuZGVyZXIuY3JlYXRlX3Nlc3Npb24oXHJcbiAgICAgIC8qIG1vdmVkICovIG9wdGlvbnMgJiYgdGhpcy5jcmVhdGVPcHRpb25zVG9SdXN0KG9wdGlvbnMpLFxyXG4gICAgKTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZuKG5ldyBSZW5kZXJTZXNzaW9uKHRoaXMsIHNlc3Npb24pKTtcclxuICAgICAgc2Vzc2lvbi5mcmVlKCk7XHJcbiAgICAgIHJldHVybiByZXM7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIHNlc3Npb24uZnJlZSgpO1xyXG4gICAgICB0aHJvdyBlO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=