/*
THIS IS A GENERATED/BUNDLED FILE BY VITE
if you want to view the source, please visit the github repository https://github.com/Myriad-Dreamin/typst.ts/blob/main/packages/typst.ts
*/
"use strict";var cr=Object.defineProperty;var _r=(n,e,t)=>e in n?cr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var l=(n,e,t)=>_r(n,typeof e!="symbol"?e+"":e,t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var te=typeof document<"u"?document.currentScript:null;const ur=["LinLibertine_R.ttf","LinLibertine_RB.ttf","LinLibertine_RBI.ttf","LinLibertine_RI.ttf","NewCMMath-Book.otf","NewCMMath-Regular.otf","NewCM10-Regular.otf","NewCM10-Bold.otf","NewCM10-Italic.otf","NewCM10-BoldItalic.otf","DejaVuSansMono.ttf","DejaVuSansMono-Bold.ttf","DejaVuSansMono-Oblique.ttf","DejaVuSansMono-BoldOblique.ttf"],dr=["InriaSerif-Bold.ttf","InriaSerif-BoldItalic.ttf","InriaSerif-Italic.ttf","InriaSerif-Regular.ttf","Roboto-Regular.ttf","NotoSerifCJKsc-Regular.otf"],lr=["TwitterColorEmoji.ttf","NotoColorEmoji.ttf"];function me(n,e){var i,s;const t=[...n];if(e&&(e==null?void 0:e.assets)!==!1&&((i=e==null?void 0:e.assets)!=null&&i.length)&&((s=e==null?void 0:e.assets)==null?void 0:s.length)>0){let o=e.assetUrlPrefix??"https://raw.githubusercontent.com/Myriad-Dreamin/typst/assets-fonts";o[o.length-1]!=="/"&&(o+="/");const a=u=>u.map(d=>o+d);for(const u of e.assets)switch(u){case"text":t.push(...a(ur));break;case"cjk":t.push(...a(dr));break;case"emoji":t.push(...a(lr));break}}const r=async(o,{ref:a,builder:u})=>{e!=null&&e.fetcher&&a.setFetcher(e.fetcher),await a.loadFonts(u,t)};return r._preloadRemoteFontOptions=e,r}function We({byFamily:n}){return async(e,{builder:t})=>{const r=performance.now();if("queryLocalFonts"in window){const s=await window.queryLocalFonts();n=n??[];for(const o of s){if(!n.includes(o.family))continue;const a=await(await o.blob()).arrayBuffer();await t.add_raw_font(new Uint8Array(a))}}const i=performance.now();console.log("preload system font time used:",i-r)}}function we(n){return async(e,{builder:t})=>new Promise(r=>{t.set_package_registry(n,function(i){return n.resolve(i,this)}),r()})}function ze(n){return async(e,t)=>{var r;if(t.alreadySetAccessModel)throw new Error(`already set some assess model before: ${(r=t.alreadySetAccessModel.constructor)==null?void 0:r.name}(${t.alreadySetAccessModel})`);return t.alreadySetAccessModel=n,new Promise(i=>{t.builder.set_access_model(n,s=>{const o=n.getMTime(s);return o?o.getTime():0},s=>n.isFile(s)||!1,s=>n.getRealPath(s)||s,s=>n.readAll(s)),i()})}}class Mt{constructor(e,t){l(this,"fullyCached");l(this,"mTimes",new Map);l(this,"mRealPaths",new Map);l(this,"mData",new Map);this.root=e,e.endsWith("/")&&(this.root=this.root.slice(0,this.root.length-1)),t!=null&&t.polyfillHeadRequest,this.fullyCached=!!(t!=null&&t.fullyCached)}reset(){this.mTimes.clear(),this.mRealPaths.clear(),this.mData.clear()}resolvePath(e){return this.root+e}insertFile(e,t,r){this.mTimes.set(e,r),this.mData.set(e,t)}removeFile(e){this.mTimes.delete(e),this.mData.delete(e)}async getPreloadScript(){const e=[];e.push("((async () => {"),e.push("const snapshot = {  root: '', mTimes: new Map(),  mRealPaths: new Map(),  mData: [],};"),e.push("const runFetch = async (path) => {"),e.push("  const res = await fetch(snapshot.root + path);"),e.push("  const buffer = await res.arrayBuffer();"),e.push("  return [path, new Uint8Array(buffer)];"),e.push("};"),e.push(`snapshot.root = ${JSON.stringify(this.root)};`),e.push(`snapshot.mTimes = new Map([${[...this.mTimes.entries()].map(([r,i])=>`[${JSON.stringify(r)}, ${(i==null?void 0:i.getTime())||"undefined"}]`).join(", ")}]);`),e.push(`snapshot.mRealPaths = new Map([${[...this.mRealPaths.entries()].map(([r,i])=>`[${JSON.stringify(r)}, ${JSON.stringify(i)}]`).join(", ")}]);`);const t=await Promise.all([...this.mData.entries()].map(async([r,i])=>(r=JSON.stringify(r),i?`runFetch(${r})`:`Promise.resolve([${r}, undefined])`)));return e.push(`snapshot.mData = await Promise.all([${t.join(", ")}]);`),e.push("return snapshot;"),e.push("})())"),e.join(`
`)}getLastModified(e){const t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(null),t.status===200?t.getResponseHeader("Last-Modified"):null}getMTimeInternal(e){const t=this.getLastModified(this.resolvePath(e));if(t)return new Date(t)}getMTime(e){if(e.startsWith("/@memory/"))return this.mTimes.has(e)?this.mTimes.get(e):void 0;if(!this.fullyCached)return this.getMTimeInternal(e);if(this.mTimes.has(e))return this.mTimes.get(e);const t=this.getMTimeInternal(e);return this.mTimes.set(e,t),t}isFile(){return!0}getRealPath(e){return e}readAllInternal(e){const t=new XMLHttpRequest;if(t.overrideMimeType("text/plain; charset=x-user-defined"),t.open("GET",this.resolvePath(e),!1),t.send(null),t.status===200&&(t.response instanceof String||typeof t.response=="string"))return Uint8Array.from(t.response,r=>r.charCodeAt(0))}readAll(e){if(e.startsWith("/@memory/"))return this.mData.has(e)?this.mData.get(e):void 0;if(!this.fullyCached)return this.readAllInternal(e);if(this.mData.has(e))return this.mData.get(e);const t=this.readAllInternal(e);return this.mData.set(e,t),t}}class qe{constructor(){l(this,"mTimes",new Map);l(this,"mData",new Map)}reset(){this.mTimes.clear(),this.mData.clear()}insertFile(e,t,r){this.mTimes.set(e,r),this.mData.set(e,t)}removeFile(e){this.mTimes.delete(e),this.mData.delete(e)}getMTime(e){if(e.startsWith("/@memory/")&&this.mTimes.has(e))return this.mTimes.get(e)}isFile(){return!0}getRealPath(e){return e}readAll(e){if(e.startsWith("/@memory/")&&this.mData.has(e))return this.mData.get(e)}}class ye{constructor(e){l(this,"cache",new Map);this.am=e}resolvePath(e){return`https://packages.typst.org/preview/${e.name}-${e.version}.tar.gz`}pullPackageData(e){const t=new XMLHttpRequest;if(t.overrideMimeType("text/plain; charset=x-user-defined"),t.open("GET",this.resolvePath(e),!1),t.send(null),t.status===200&&(t.response instanceof String||typeof t.response=="string"))return Uint8Array.from(t.response,r=>r.charCodeAt(0))}resolve(e,t){if(e.namespace!=="preview")return;const r=this.resolvePath(e);if(this.cache.has(r))return this.cache.get(r)();const i=this.pullPackageData(e);if(!i)return;const s=`/@memory/fetch/packages/preview/${e.namespace}/${e.name}/${e.version}`,o=[];t.untar(i,(u,d,f)=>{o.push([s+"/"+u,d,new Date(f)])});const a=()=>{for(const[u,d,f]of o)this.am.insertFile(u,d,f);return s};return this.cache.set(r,a),a()}}function gr(n){return Math.random().toString(36).replace("0.","")}const fr=typeof process<"u"&&process.versions!=null&&process.versions.node!=null;class U{constructor(e){l(this,"mainFilePath");l(this,"cc");l(this,"ex");l(this,"providers");l(this,"ccOptions");l(this,"exOptions");this.cc=e==null?void 0:e.compiler,this.ex=e==null?void 0:e.renderer,this.mainFilePath="/main.typ",this.providers=[]}setCompiler(e){this.cc=e}async getCompiler(){return typeof this.cc=="function"?this.cc=await this.cc():this.cc}setRenderer(e){this.ex=e}async getRenderer(){return typeof this.ex=="function"?this.ex=await this.ex():this.ex}use(...e){if(!this.providers)throw new Error("already prepare uses for instances");this.providers.push(...e)}static withAccessModel(e){return{key:"access-model",forRoles:["compiler"],provides:[ze(e)]}}static withPackageRegistry(e){return{key:"package-registry",forRoles:["compiler"],provides:[we(e)]}}static fetchPackageRegistry(e){const t=e||new qe,r=[...e?[]:[ze(t)],we(new ye(t))];return{key:"package-registry$fetch",forRoles:["compiler"],provides:r}}static fetchPackageBy(e,t){class r extends ye{pullPackageData(s){return t(s,this.resolvePath(s))}}return{key:"package-registry$lambda",forRoles:["compiler"],provides:[we(new r(e))]}}setCompilerInitOptions(e){this.requireIsUninitialized("compiler",this.cc,U.$buildC),this.ccOptions=e}setRendererInitOptions(e){this.requireIsUninitialized("renderer",this.ex,U.$buildR),this.exOptions=e}setMainFilePath(e){this.mainFilePath=e}getMainFilePath(){return this.mainFilePath}removeTmp(e){return e.mainFilePath.startsWith("/tmp/")?this.unmapShadow(e.mainFilePath):Promise.resolve()}async addSource(e,t){(await this.getCompiler()).addSource(e,t)}async resetShadow(){(await this.getCompiler()).resetShadow()}async mapShadow(e,t){(await this.getCompiler()).mapShadow(e,t)}async unmapShadow(e){(await this.getCompiler()).unmapShadow(e)}async vector(e){const t=await this.getCompileOptions(e);return(await this.getCompiler()).compile(t).then(r=>r.result).finally(()=>this.removeTmp(t))}async pdf(e){const t=await this.getCompileOptions(e);return t.format="pdf",(await this.getCompiler()).compile(t).then(r=>r.result).finally(()=>this.removeTmp(t))}async svg(e){return this.transientRender(e,(t,r)=>t.renderSvg({...e,renderSession:r}))}async canvas(e,t){return this.transientRender(t,(r,i)=>r.renderToCanvas({container:e,...t,renderSession:i}))}async query(e){const t=await this.getCompileOptions(e);return(await this.getCompiler()).query({...e,...t}).finally(()=>this.removeTmp(t))}async getSemanticTokenLegend(){return(await this.getCompiler()).getSemanticTokenLegend()}async getSemanticTokens(e){const t=await this.getCompileOptions(e);return(await this.getCompiler()).getSemanticTokens({mainFilePath:t.mainFilePath,resultId:e.resultId}).finally(()=>this.removeTmp(t))}async getCompileOptions(e){if(e===void 0)return{mainFilePath:this.mainFilePath,diagnostics:"none"};if(typeof e=="string")throw new Error("please specify opts as {mainContent: '...'} or {mainFilePath: '...'}");if("mainFilePath"in e)return{...e,diagnostics:"none"};{const t=`/tmp/${gr()}.typ`;return await this.addSource(t,e.mainContent),{mainFilePath:t,inputs:e.inputs,diagnostics:"none"}}}async getVector(e){if(e&&"vectorData"in e)return e.vectorData;const t=await this.getCompileOptions(e);return(await this.getCompiler()).compile(t).then(r=>r.result).finally(()=>this.removeTmp(t))}async transientRender(e,t){const r=await this.getRenderer();if(!r)throw new Error("does not provide renderer instance");const i=await this.getVector(e);return await r.runWithSession(async s=>(r.manipulateData({renderSession:s,action:"reset",data:i}),t(r,s)))}async prepareUse(){if(!this.providers)return;const e=await Promise.all(this.providers.map(a=>typeof a=="function"?a():a));if(this.providers=[],oe==this&&!e.some(a=>a.key.includes("package-registry")||a.key.includes("access-model")))if(fr){const a=new Function("m","return import(m)");try{const u=new qe,{default:d}=await a("sync-request");oe.use(U.withAccessModel(u),U.fetchPackageBy(u,(f,w)=>{const x=d("GET",w);if(x.statusCode===200)return x.getBody(void 0)}))}catch{}}else oe.use(U.fetchPackageRegistry());const t=await Promise.all(this.providers.map(a=>typeof a=="function"?a():a)),r=this.ccOptions||(this.ccOptions={}),i=r.beforeBuild||(r.beforeBuild=[]),s=this.exOptions||(this.exOptions={}),o=s.beforeBuild||(s.beforeBuild=[]);for(const a of[...e,...t])a.forRoles.includes("compiler")&&(this.requireIsUninitialized("compiler",this.cc,U.$buildC),i.push(...a.provides)),a.forRoles.includes("renderer")&&(this.requireIsUninitialized("renderer",this.ex,U.$buildR),o.push(...a.provides));this.providers=void 0}requireIsUninitialized(e,t,r){if(typeof t!="function")throw new Error(`${e} has been initialized: ${t}`);if(r&&t!=r)throw new Error(`${e} instance is set to non default value`)}static async $buildC(){const{createGlobalCompiler:e}=await Promise.resolve().then(()=>qr),{createTypstCompiler:t}=await Promise.resolve().then(()=>Yr);return await this.prepareUse(),e(t,this.ccOptions)}static async $buildR(){const{createGlobalRenderer:e}=await Promise.resolve().then(()=>en),{createTypstRenderer:t}=await Promise.resolve().then(()=>dn);return await this.prepareUse(),e(t,this.exOptions)}}const oe=new U({compiler:U.$buildC,renderer:U.$buildR}),E=Symbol.for("reflexo-obj");var Ge=(n=>(n[n.PIXEL_PER_PT=3]="PIXEL_PER_PT",n))(Ge||{});let Tt=class{constructor(e,t,r){l(this,"loadPageCount");l(this,"imageScaleFactor");l(this,"container");l(this,"canvasList");l(this,"textLayerList");l(this,"commonList");l(this,"textLayerParentList");l(this,"semanticLayerList");this.pageInfos=e,this.imageScaleFactor=r.pixelPerPt??Ge.PIXEL_PER_PT,t.innerHTML="",t.style.width="100%",this.container=t,this.canvasList=new Array(this.loadPageCount),this.textLayerList=new Array(this.loadPageCount),this.commonList=new Array(this.loadPageCount),this.textLayerParentList=new Array(this.loadPageCount),this.semanticLayerList=new Array(this.loadPageCount);const i=(s,o,a)=>{const u=Math.ceil(o.width)*this.imageScaleFactor,d=Math.ceil(o.height)*this.imageScaleFactor,f=this.canvasList[s]=document.createElement("canvas"),w=this.semanticLayerList[s]=document.createElement("div"),x=this.textLayerList[s]=document.createElement("div"),C=this.textLayerParentList[s]=document.createElement("div");if(f.getContext("2d")){const T=document.createElement("div");f.width=u,f.height=d,T.appendChild(f),a.appendChild(T),T.style.position="absolute"}{C.appendChild(x),C.className="typst-html-semantics";const T=t.offsetWidth,$=T/o.width;C.style.width=`${T}px`,C.style.height=`${o.height*$}px`,C.style.setProperty("--data-text-width",`${$}px`),C.style.setProperty("--data-text-height",`${$}px`),a.classList.add("typst-page"),a.classList.add("canvas"),a.style.width=`${T}px`,a.style.height=`${d*$}px`,a.style.position="relative",w.appendChild(C),a.appendChild(w)}};for(let s=0;s<this.pageInfos.length;s++){const o=this.pageInfos[s];let a;a=this.commonList[s]=document.createElement("div"),t.appendChild(a),i(s,o,a)}}resetLayout(){for(let e=0;e<this.pageInfos.length;e++){const t=this.pageInfos[e],r=Math.ceil(t.width)*this.imageScaleFactor,i=Math.ceil(t.height)*this.imageScaleFactor,s=this.canvasList[e].parentElement;if(!s)throw new Error(`canvasDiv is null for page ${e}, canvas list length ${this.canvasList.length}`);const o=this.commonList[e],a=this.textLayerParentList[e],u=this.container.offsetWidth,d=u/r;a.style.width=`${u}px`,a.style.height=`${i*d}px`,o.style.width=`${u}px`,o.style.height=`${i*d}px`;const f=this.container.offsetWidth/r;s.style.transformOrigin="0px 0px",s.style.transform=`scale(${f})`}}};const wr=n=>{let e=!1,t;return()=>e?t:(e=!0,t=n())};let Lt=class{constructor(e){l(this,"wasmBin");l(this,"initOnce");if(typeof e!="function")throw new Error("initFn is not a function");this.initOnce=wr(async()=>{await e(this.wasmBin)})}async init(e){this.wasmBin=e,await this.initOnce()}};const hr=(n,e)=>e.some(t=>n instanceof t);let Ze,et;function pr(){return Ze||(Ze=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function br(){return et||(et=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const At=new WeakMap,Ue=new WeakMap,Ot=new WeakMap,Me=new WeakMap,Qe=new WeakMap;function mr(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(ae(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&At.set(t,n)}).catch(()=>{}),Qe.set(e,n),e}function yr(n){if(Ue.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});Ue.set(n,e)}let Ne={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Ue.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Ot.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ae(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function vr(n){Ne=n(Ne)}function Sr(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Te(this),e,...t);return Ot.set(r,e.sort?e.sort():[e]),ae(r)}:br().includes(n)?function(...e){return n.apply(Te(this),e),ae(At.get(this))}:function(...e){return ae(n.apply(Te(this),e))}}function Cr(n){return typeof n=="function"?Sr(n):(n instanceof IDBTransaction&&yr(n),hr(n,pr())?new Proxy(n,Ne):n)}function ae(n){if(n instanceof IDBRequest)return mr(n);if(Me.has(n))return Me.get(n);const e=Cr(n);return e!==n&&(Me.set(n,e),Qe.set(e,n)),e}const Te=n=>Qe.get(n),xr=["get","getKey","getAll","getAllKeys","count"],kr=["put","add","delete","clear"],Le=new Map;function tt(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Le.get(e))return Le.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=kr.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||xr.includes(t)))return;const s=async function(o,...a){const u=this.transaction(o,i?"readwrite":"readonly");let d=u.store;return r&&(d=d.index(a.shift())),(await Promise.all([d[t](...a),i&&u.done]))[0]};return Le.set(e,s),s}vr(n=>({...n,get:(e,t,r)=>tt(e,t)||n.get(e,t,r),has:(e,t)=>!!tt(e,t)||n.has(e,t)}));let Rr=class{constructor(){l(this,"loadedFonts",new Set);l(this,"fetcher",fetch)}setFetcher(e){this.fetcher=e}async loadFonts(e,t){const r=new Function("m","return import(m)"),i=this.fetcher||(this.fetcher=await async function(){const{fetchBuilder:a,FileSystemCache:u}=await r("node-fetch-cache"),d=new u({cacheDirectory:".cache/typst/fonts"}),f=a.withCache(d);return function(w,x){const C=setTimeout(()=>{console.warn("font fetching is stucking:",w)},15e3);return f(w,x).finally(()=>{clearTimeout(C)})}}()),s=t.filter(a=>a instanceof Uint8Array?!0:this.loadedFonts.has(a)?!1:(this.loadedFonts.add(a),!0)),o=await Promise.all(s.map(async a=>{if(a instanceof Uint8Array){await e.add_raw_font(a);return}return new Uint8Array(await(await i(a)).arrayBuffer())}));for(const a of o)a&&await e.add_raw_font(a)}async build(e,t,r){const i={ref:this,builder:t,hooks:r};for(const o of(e==null?void 0:e.beforeBuild)??[])await o(void 0,i);return r.latelyBuild&&r.latelyBuild(i),await t.build()}};async function Ft(n,e,t,r){var i;return await e.init((i=n==null?void 0:n.getModule)==null?void 0:i.call(n)),await new Rr().build(n,new t,r)}let Er=class Dt{constructor(e){l(this,"hookedElem");l(this,"kModule");l(this,"opts");l(this,"modes",[]);l(this,"partialRendering",!0);l(this,"renderMode","svg");l(this,"r");l(this,"previewMode",0);l(this,"isContentPreview",!1);l(this,"isMixinOutline",!1);l(this,"backgroundColor","black");l(this,"pageColor","white");l(this,"pixelPerPt",3);l(this,"retrieveDOMState");l(this,"isRendering",!1);l(this,"moduleInitialized",!1);l(this,"patchQueue",[]);l(this,"disposeList",[]);l(this,"canvasRenderCToken");l(this,"currentRealScale",1);l(this,"currentScaleRatio",1);l(this,"vpTimeout");l(this,"sampledRenderTime",0);l(this,"partialRenderPage",0);l(this,"outline");l(this,"cursorPosition");l(this,"cachedDOMState",{width:0,height:0,window:{innerWidth:0,innerHeight:0},boundingRect:{left:0,top:0,right:0}});var t,r;this.hookedElem=e.hookedElem,this.kModule=e.kModule,this.opts=e||{};{const{renderMode:i,previewMode:s,isContentPreview:o,retrieveDOMState:a}=e||{};this.partialRendering=!1,this.renderMode=i??this.renderMode,this.previewMode=s??this.previewMode,this.isContentPreview=o||!1,this.retrieveDOMState=a??(()=>({width:this.hookedElem.offsetWidth,height:this.hookedElem.offsetHeight,window:{innerWidth:window.innerWidth,innerHeight:window.innerHeight},boundingRect:this.hookedElem.getBoundingClientRect()})),this.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--typst-preview-background-color")}this.hookedElem.classList.add("hide-scrollbar-x"),(t=this.hookedElem.parentElement)==null||t.classList.add("hide-scrollbar-x"),this.previewMode===1&&(this.hookedElem.classList.add("hide-scrollbar-y"),(r=this.hookedElem.parentElement)==null||r.classList.add("hide-scrollbar-y")),this.installCtrlWheelHandler()}reset(){this.kModule.reset(),this.moduleInitialized=!1}dispose(){const e=this.disposeList;this.disposeList=[],e.forEach(t=>t())}static derive(e,t){return["rescale","rerender","postRender"].reduce((r,i)=>(r[i]=e[`${i}$${t}`].bind(e),console.assert(r[i]!==void 0,`${i}$${t} is undefined`),r),{})}registerMode(e){const t=Dt.derive(this,e);this.modes.push([e,t]),e===this.renderMode&&(this.r=t)}installCtrlWheelHandler(){const e=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2.1,2.4,2.7,3,3.3,3.7,4.1,4.6,5.1,5.7,6.3,7,7.7,8.5,9.4,10],t=r=>{var i,s,o,a;if(r.ctrlKey){r.preventDefault(),this.cachedDOMState=this.retrieveDOMState(),window.onresize!==null&&(window.onresize=null);const u=this.currentScaleRatio;if(r.deltaY<0){if(this.currentScaleRatio>=e.at(-1))return;this.currentScaleRatio=e.filter(C=>C>this.currentScaleRatio).at(0)}else if(r.deltaY>0){if(this.currentScaleRatio<=e.at(0))return;this.currentScaleRatio=e.filter(C=>C<this.currentScaleRatio).at(-1)}else return;const d=this.currentScaleRatio/u,f=r.pageX*(d-1),w=r.pageY*(d-1);Math.abs(this.currentScaleRatio-1)<1e-5?(this.hookedElem.classList.add("hide-scrollbar-x"),(i=this.hookedElem.parentElement)==null||i.classList.add("hide-scrollbar-x"),this.previewMode===1&&(this.hookedElem.classList.add("hide-scrollbar-y"),(s=this.hookedElem.parentElement)==null||s.classList.add("hide-scrollbar-y"))):(this.hookedElem.classList.remove("hide-scrollbar-x"),(o=this.hookedElem.parentElement)==null||o.classList.remove("hide-scrollbar-x"),this.previewMode===1&&(this.hookedElem.classList.remove("hide-scrollbar-y"),(a=this.hookedElem.parentElement)==null||a.classList.remove("hide-scrollbar-y")));const x=this.hookedElem.firstElementChild;if(x){const C=this.getSvgScaleRatio(),F=Number.parseFloat(x.getAttribute("data-height")),T=Math.ceil(F*C);this.hookedElem.style.height=`${T*2}px`}return window.scrollBy(f,w),this.addViewportChange(),!1}};this.renderMode!=="dom"&&(typeof acquireVsCodeApi<"u"?(window.addEventListener("wheel",t,{passive:!1}),this.disposeList.push(()=>{window.removeEventListener("wheel",t)})):(document.body.addEventListener("wheel",t,{passive:!1}),this.disposeList.push(()=>{document.body.removeEventListener("wheel",t)})))}getSvgScaleRatio(){const e=this.hookedElem.firstElementChild;if(!e)return 0;const t=this.cachedDOMState,r=Number.parseFloat(e.getAttribute("data-width")||e.getAttribute("width")||"1"),i=Number.parseFloat(e.getAttribute("data-height")||e.getAttribute("height")||"1");return this.currentRealScale=this.previewMode===1?Math.min(t.width/r,t.height/i):t.width/r,this.currentRealScale*this.currentScaleRatio}processQueue(e){const t=e[0];switch(t){case"new":case"diff-v1":return t==="new"&&this.reset(),this.kModule.manipulateData({action:"merge",data:e[1]}),this.moduleInitialized=!0,!0;case"viewport-change":return this.moduleInitialized?!0:(console.log("viewport-change before initialization"),!1);default:return console.log("svgUpdateEvent",e),!1}}triggerUpdate(){if(this.isRendering)return;this.isRendering=!0;const e=async()=>{if(this.cachedDOMState=this.retrieveDOMState(),this.patchQueue.length===0){this.isRendering=!1,this.postprocessChanges();return}try{let t=performance.now();const r=this.canvasRenderCToken;r&&(await r.cancel(),await r.wait(),this.canvasRenderCToken=void 0,console.log("cancel canvas rendering"));let i=!1;for(;this.patchQueue.length>0;)i=this.processQueue(this.patchQueue.shift())||i;let s=performance.now();i&&(this.r.rescale(),await this.r.rerender(),this.r.rescale());let o=performance.now();const a=(u,d,f)=>`${u} ${(f-d).toFixed(2)} ms`;this.sampledRenderTime=o-t,console.log([a("parse",t,s),a("rerender",s,o),a("total",t,o)].join(", ")),requestAnimationFrame(e)}catch(t){console.error(t),this.isRendering=!1,this.postprocessChanges()}};requestAnimationFrame(e)}postprocessChanges(){this.r.postRender(),this.previewMode===1&&document.querySelectorAll(".typst-page-number-indicator").forEach(e=>{e.textContent=`${this.kModule.retrievePagesInfo().length}`})}addChangement(e){e[0]==="new"&&this.patchQueue.splice(0,this.patchQueue.length);const t=()=>{this.vpTimeout=void 0,this.patchQueue.push(e),this.triggerUpdate()};this.vpTimeout!==void 0&&clearTimeout(this.vpTimeout),e[0]==="viewport-change"&&this.isRendering?this.vpTimeout=setTimeout(t,this.sampledRenderTime||100):t()}addViewportChange(){this.addChangement(["viewport-change",""])}};function Pr(n){return class{constructor(t){l(this,"impl");l(this,"kModule");if(t.isContentPreview&&(t.renderMode="canvas"),this.kModule=t.kModule,this.impl=new n(t),!this.impl.r)throw new Error(`mode is not supported, ${t==null?void 0:t.renderMode}`);t.isContentPreview&&(this.impl.partialRendering=!0,this.impl.pixelPerPt=1,this.impl.isMixinOutline=!0)}dispose(){this.impl.dispose()}reset(){this.impl.reset()}addChangement(t){this.impl.addChangement(t)}addViewportChange(){this.impl.addViewportChange()}setPageColor(t){this.impl.pageColor=t,this.addViewportChange()}setPartialRendering(t){this.impl.partialRendering=t}setCursor(t,r,i){this.impl.cursorPosition=[t,r,i]}setPartialPageNumber(t){return t<=0||t>this.kModule.retrievePagesInfo().length?!1:(this.impl.partialRenderPage=t-1,this.addViewportChange(),!0)}getPartialPageNumber(){return this.impl.partialRenderPage+1}setOutineData(t){this.impl.outline=t,this.addViewportChange()}}}function Ir(n,...e){return e.reduce((t,r)=>r(t),n)}let Mr=class{constructor(){l(this,"isCancellationRequested",!1);l(this,"_onCancelled");l(this,"_onCancelledResolveResolved");let e,t;this._onCancelled=new Promise(r=>{e=r,t&&t(r)}),this._onCancelledResolveResolved=new Promise(r=>{t=r,e&&r(e)})}async cancel(){await this._onCancelledResolveResolved,this.isCancellationRequested=!0}isCancelRequested(){return this.isCancellationRequested}async consume(){(await this._onCancelledResolveResolved)()}wait(){return this._onCancelled}};const Tr=()=>new Promise(n=>requestAnimationFrame(n));function Lr(n){return class extends n{constructor(...r){super(...r);l(this,"tmpl",document.createElement("template"));l(this,"stub",this.createElement("<stub></stub>"));l(this,"plugin");l(this,"docKernel");l(this,"resourceHeader");l(this,"pages",[]);l(this,"domScale",1);l(this,"track_mode",0);l(this,"current_task");l(this,"viewport");if(this.registerMode("dom"),this.disposeList.push(()=>{this.dispose()}),this.plugin=this.opts.renderer,this.opts.domScale!==void 0){if(this.opts.domScale<=0)throw new Error("domScale must be positive");this.domScale=this.opts.domScale}}dispose(){for(const r of this.pages)r.dispose();this.docKernel&&this.docKernel.free()}createElement(r){return this.tmpl.innerHTML=r,this.tmpl.content.firstElementChild}async mountDom(r){if(console.log("mountDom",r),this.docKernel)throw new Error("already mounted");this.hookedElem.innerHTML='<svg class="typst-svg-resources" viewBox="0 0 0 0" width="0" height="0" style="opacity: 0; position: absolute;"></svg>',this.resourceHeader=this.hookedElem.querySelector(".typst-svg-resources"),this.docKernel=await this.plugin.renderer.mount_dom(this.kModule[E],this.hookedElem),this.docKernel.bind_functions({populateGlyphs:i=>{let s=this.createElement(i);console.log("populateGlyphs",s);let o=s.firstElementChild;this.resourceHeader.append(o)}})}async cancelAnyway$dom(){if(console.log("cancelAnyway$dom"),this.current_task){const r=this.current_task;this.current_task=void 0,await r.cancel()}}retrieveDOMPages(){return Array.from(this.hookedElem.querySelectorAll(".typst-dom-page"))}postRender$dom(){}rescale$dom(){}getDomViewport(r,i){const s=i.left,o=-i.top,a=i.right,u=r.innerHeight-i.top,d={x:0,y:o/this.domScale,width:Math.max(a-s,0)/this.domScale,height:Math.max(u-o,0)/this.domScale};return(d.width<=0||d.height<=0)&&(d.x=d.y=d.width=d.height=0),d}async rerender$dom(){const r=this.retrieveDOMState(),{x:i,y:s,width:o,height:a}=this.getDomViewport(r.window,r.boundingRect);if(!await this.docKernel.relayout(i,s,o,a))return;const d=new Mr;this.doRender$dom(d),this.current_task=d}async doRender$dom(r){const i=(u,d)=>{if(u&&!r.isCancelRequested()&&d)return d()},s=this.retrieveDOMPages().map(u=>{const{innerWidth:d,innerHeight:f}=window,w=u.getBoundingClientRect();return{inWindow:!(w.left>d||w.right<0||w.top>f||w.bottom<0),page:u}}),o=async u=>{if(await Tr(),r.isCancelRequested()){console.log("cancel stage",0,u);return}const d=s[u].page,f=d.getBoundingClientRect(),w=this.getDomViewport(window,f),x=D=>this.docKernel.need_repaint(u,w.x,w.y,w.width,w.height,D),C=D=>this.docKernel.repaint(u,w.x,w.y,w.width,w.height,D),F=D=>{if(!r.isCancelRequested())return i(x(D),()=>C(D))};await F(0);const T=(f.width?Number.parseFloat(d.getAttribute("data-width"))/f.width:1)*this.domScale,$=(f.height?Number.parseFloat(d.getAttribute("data-height"))/f.height:1)*this.domScale;if(w.x*=T,w.y*=$,w.y-=100,w.width*=T,w.height*=$,w.height+=200,await F(1),await F(2),r.isCancelRequested()){console.log("cancel stage",2,u);return}x(3)?(async()=>{if(await C(3),!r.isCancelRequested())return F(4)})():await F(4)},a=async u=>{for(let d=0;d<s.length;++d){if(r.isCancelRequested()){console.log("cancel page",0,d);return}s[d].inWindow===u&&await o(d)}};this.cancelAnyway$dom(),await a(!0),await a(!1),!r.isCancelRequested()&&console.log("finished",0)}}}let Ar=class extends Pr(Ir(Er,Lr)){};var xt;let Ae=(xt=E,class{constructor(e,t){l(this,xt);this.plugin=e,this[E]=t}set backgroundColor(e){e!==void 0&&(this[E].background_color=e)}get backgroundColor(){return this[E].background_color}set pixelPerPt(e){e!==void 0&&(this[E].pixel_per_pt=e)}get pixelPerPt(){return this[E].pixel_per_pt}reset(){this.plugin.resetSession(this)}get doc_width(){return this[E].doc_width}get docWidth(){return this[E].doc_width}get doc_height(){return this[E].doc_height}get docHeight(){return this[E].doc_height}retrievePagesInfo(){const e=this[E].pages_info,t=[],r=e.page_count;for(let i=0;i<r;i++){const s=e.page(i);t.push({pageOffset:s.page_off,width:s.width_pt,height:s.height_pt})}return t}getSourceLoc(e){return this[E].source_span(e)}renderSvg(e){return this.plugin.renderSvg({renderSession:this,...e})}renderToSvg(e){return this.plugin.renderToSvg({renderSession:this,...e})}renderCanvas(e){return this.plugin.renderCanvas({renderSession:this,...e})}manipulateData(e){this.plugin.manipulateData({renderSession:this,...e})}renderSvgDiff(e){return this.plugin.renderSvgDiff({renderSession:this,...e})}get_source_loc(e){return this[E].source_span(e)}render_in_window(e,t,r,i){return this[E].render_in_window(e,t,r,i)}merge_delta(e){this.plugin.manipulateData({renderSession:this,action:"merge",data:e})}});var kt;let Or=(kt=E,class{constructor(e,t){l(this,kt);l(this,"managedCanvasElemList",new Map);l(this,"canvasCounter",Math.random());this.plugin=e,this[E]=t}manipulateData(e,t){return this[E].manipulate_data(e,t)}renderCanvas(e){const t=this.managedCanvasElemList;for(const[a,u]of t)u[0]=0;for(const a of e){const u=a.canvas;let d=u.dataset.manageId,f=2;d||(d=this.canvasCounter.toFixed(5),this.canvasCounter+=1,u.dataset.manageId=d,f=1);let w=t.get(d);if(w&&w[0]!==0)throw new Error("cannot update a canvas for two times in batch");t.set(d,[f,{...a}])}const r=Array.from(t.entries()),i=new Uint8Array(r.length),s=new Array(r.length),o=r.map(([a,[u,d]],f)=>(u||t.delete(a),i[f]=u,s[f]=d.canvas,this.plugin.canvasOptionsToRust(d)));return this[E].render_canvas(i,s,o)}async retrievePagesInfo(){const e=await this[E].get_pages_info();console.log(e);const t=[],r=e.page_count;for(let i=0;i<r;i++){const s=e.page(i);t.push({pageOffset:s.page_off,width:s.width_pt,height:s.height_pt})}return t}});const Fr=n=>new Lt(async e=>await n.default(e));function He(){return new $t}function Dr(){return new $t}async function $r(){return(await Promise.resolve().then(()=>Ye)).renderer_build_info()}let rt=!0,$t=class{constructor(){l(this,"renderer");l(this,"rendererJs")}async init(e){var r;this.rendererJs=await(((r=e==null?void 0:e.getWrapper)==null?void 0:r.call(e))||Promise.resolve().then(()=>Ye));const t=this.rendererJs.TypstRendererBuilder;this.renderer=await Ft(e,Fr(this.rendererJs),t,{})}loadGlyphPack(e){return Promise.resolve()}createOptionsToRust(e){const t=new this.rendererJs.CreateSessionOptions;return e.format!==void 0&&(t.format=e.format),e.artifactContent!==void 0&&(t.artifact_content=e.artifactContent),t}canvasOptionsToRust(e){const t=new this.rendererJs.RenderPageImageOptions;if(e.pageOffset===void 0)throw new Error("pageOffset is required in reflexo v0.5.0");if(t.page_off=e.pageOffset,e.cacheKey!==void 0&&(t.cache_key=e.cacheKey),e.backgroundColor!==void 0&&(t.background_color=e.backgroundColor),e.pixelPerPt!==void 0&&(t.pixel_per_pt=e.pixelPerPt),e.dataSelection!==void 0){let r=0;e.dataSelection.body?r|=1:e.canvas&&rt&&(rt=!1,console.warn("dataSelection.body is not set but providing canvas for body")),(e.dataSelection.text||e.dataSelection.annotation)&&console.error("dataSelection.text and dataSelection.annotation are deprecated"),e.dataSelection.semantics&&(r|=8),t.data_selection=r}return t}retrievePagesInfoFromSession(e){return e.retrievePagesInfo()}renderCanvas(e){return this.withinOptionSession(e,async t=>this.renderer.render_page_to_canvas(t[E],e.canvas||void 0,this.canvasOptionsToRust(e)))}async inAnimationFrame(e){return new Promise((t,r)=>{requestAnimationFrame(()=>{try{t(e())}catch(i){r(i)}})})}async renderDisplayLayer(e,t,r){const s=e[E].pages_info.page_count,o=async(f,w)=>{const C=t[f].getContext("2d");if(!C)throw new Error("canvas context is null");return await this.renderCanvas({...r,canvas:C,renderSession:e,pageOffset:w})},a=performance.now(),u=await(async()=>{const f=[];for(let w=0;w<s;w++)f.push(await this.inAnimationFrame(()=>o(w,w)));return f})(),d=performance.now();return console.log(`display layer used: render = ${(d-a).toFixed(1)}ms`),u}renderTextLayer(e,t){const r=performance.now();e.forEach((s,o)=>{s.innerHTML=t[o].htmlSemantics[0]});const i=performance.now();console.log(`text layer used: render = ${(i-r).toFixed(1)}ms`)}async render(e){if("format"in e&&e.format!=="vector"&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.renderToCanvas(e)}async renderDom(e){if("format"in e&&e.format!=="vector"&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.withinOptionSession(e,async t=>{const r=new Ar({...e,renderMode:"dom",hookedElem:e.container,kModule:t,renderer:this});return await r.impl.mountDom(e.pixelPerPt),r})}async renderToCanvas(e){let t,r;const i=e.container;i.style.visibility="hidden";const s=async(o,a)=>{try{r=await this.renderDisplayLayer(t,o,e),a()}finally{i.style.visibility="visible"}};return this.withinOptionSession(e,async o=>{if(t=o,t[E].pages_info.page_count===0)throw new Error("No page found in session");if(e.pixelPerPt!==void 0&&e.pixelPerPt<=0)throw new Error("Invalid typst.RenderOptions.pixelPerPt, should be a positive number "+e.pixelPerPt);let a=e.backgroundColor;if(a!==void 0&&!/^#[0-9a-f]{6}$/.test(a))throw new Error("Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ "+a);t.pixelPerPt=e.pixelPerPt??Ge.PIXEL_PER_PT,t.backgroundColor=a??"#ffffff";const u=performance.now(),d=new Tt(this.retrievePagesInfoFromSession(t),i,e),f=performance.now();console.log(`layer used: retieve = ${(f-u).toFixed(1)}ms`),await s(d.canvasList,()=>d.resetLayout()),this.renderTextLayer(d.textLayerList,r)})}createModule(e){return Promise.resolve(new Ae(this,this.renderer.create_session(e&&this.createOptionsToRust({format:"vector",artifactContent:e}))))}async createWorkerV0(e){return new Or(this,await this.renderer.create_worker(e))}workerBridge(){return this.renderer.create_worker_bridge()}renderSvg(e,t){if(e instanceof Ae||t)throw new Error("removed api, please use renderToSvg({ renderSession, container }) instead");return this.withinOptionSession(e,async r=>{let i;return e.data_selection&&(i=0,e.data_selection.body&&(i|=1),e.data_selection.defs&&(i|=2),e.data_selection.css&&(i|=4),e.data_selection.js&&(i|=8)),Promise.resolve(this.renderer.svg_data(r[E],i))})}renderSvgDiff(e){return e.window?this.renderer.render_svg_diff(e.renderSession[E],e.window.lo.x,e.window.lo.y,e.window.hi.x,e.window.hi.y):this.renderer.render_svg_diff(e.renderSession[E],0,0,1e33,1e33)}renderToSvg(e){return this.withinOptionSession(e,async t=>Promise.resolve(this.renderer.render_svg(t[E],e.container)))}getCustomV1(e){return Promise.resolve(this.renderer.get_customs(e.renderSession[E]))}resetSession(e){return this.renderer.reset(e[E])}manipulateData(e){return this.renderer.manipulate_data(e.renderSession[E],e.action??"reset",e.data)}withinOptionSession(e,t){function r(i){return"artifactContent"in i}if("renderSession"in e)return t(e.renderSession);if(r(e))return this.runWithSession(e,t);throw new Error("Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions")}async runWithSession(e,t){let r=e,i=t;t||(r=void 0,i=e);const s=this.renderer.create_session(r&&this.createOptionsToRust(r));try{const o=await i(new Ae(this,s));return s.free(),o}catch(o){throw s.free(),o}}};var Rt;let jr=(Rt=E,class{constructor(e){l(this,Rt);this[E]=e}reset(){this[E].reset()}current(){return this[E].current()}setAttachDebugInfo(e){this[E].set_attach_debug_info(e)}});const Br=new Lt(async n=>await(await Promise.resolve().then(()=>Ie)).default(n));function jt(){return new Wr}let Wr=class{constructor(){l(this,"compiler");l(this,"compilerJs")}async init(e){var a,u,d,f;this.compilerJs=await Promise.resolve().then(()=>Ie);const t=this.compilerJs.TypstCompilerBuilder,r={...e||{}},i=(a=r.beforeBuild)==null?void 0:a.some(w=>w._preloadRemoteFontOptions!==void 0),s=(u=r.beforeBuild)==null?void 0:u.some(w=>{var x;return((x=w._preloadRemoteFontOptions)==null?void 0:x.assets)!==void 0}),o=(d=r.beforeBuild)==null?void 0:d.some(w=>{var x;return((x=w._preloadRemoteFontOptions)==null?void 0:x.assets)===!1});(!i||!s&&!o)&&((f=r.beforeBuild)==null||f.push(me([],{assets:["text"]}))),this.compiler=await Ft(e,Br,t,{})}compile(e){return new Promise(t=>{if("incrementalServer"in e){t(this.compiler.incr_compile(e.mainFilePath,Oe(e.inputs),e.incrementalServer[E],nt(e.diagnostics)));return}t(this.compiler.compile(e.mainFilePath,Oe(e.inputs),e.format||"vector",nt(e.diagnostics)))})}query(e){return new Promise(t=>{t(JSON.parse(this.compiler.query(e.mainFilePath,Oe(e.inputs),e.selector,e.field)))})}getSemanticTokenLegend(){return new Promise(e=>{e(this.compiler.get_semantic_token_legend())})}getSemanticTokens(e){return new Promise(t=>{this.compiler.reset(),t(this.compiler.get_semantic_tokens(e.offsetEncoding||"utf-16",e.mainFilePath,e.resultId))})}async withIncrementalServer(e){const t=new jr(this.compiler.create_incr_server());try{return await e(t)}finally{t[E].free()}}async getAst(e){return this.compiler.get_ast(e)}async reset(){await new Promise(e=>{this.compiler.reset(),e(void 0)})}addSource(e,t){if(arguments.length>2)throw new Error("use of addSource(path, source, isMain) is deprecated, please use addSource(path, source) instead");this.compiler.add_source(e,t)}mapShadow(e,t){this.compiler.map_shadow(e,t)}unmapShadow(e){this.compiler.unmap_shadow(e)}resetShadow(){this.compiler.reset_shadow()}renderPageToCanvas(){throw new Error("Please use the api TypstRenderer.renderToCanvas in v0.4.0")}};function Oe(n){return n?Object.entries(n):void 0}function nt(n){switch(n){case"none":return 1;case"unix":return 2;case"full":return 3;default:return 0}}typeof window<"u"&&(window.TypstRenderModule={RenderView:Tt,createTypstRenderer:He,createTypstSvgRenderer:He,preloadRemoteFonts:me,preloadSystemFonts:We},window.TypstCompileModule={createTypstCompiler:jt,preloadRemoteFonts:me,preloadSystemFonts:We,FetchAccessModel:Mt,MemoryAccessModel:qe,FetchPackageRegistry:ye,withAccessModel:ze,withPackageRegistry:we});window.$typst=oe;window.TypstSnippet=U;let it,Fe;function zr(n,e){const t=it||n();return Fe!==void 0?Fe:Fe=(async()=>(await t.init(e),it=t))()}const qr=Object.freeze(Object.defineProperty({__proto__:null,createGlobalCompiler:zr},Symbol.toStringTag,{value:"Module"}));class Ur{constructor(){l(this,"loadedFonts",new Set);l(this,"fetcher",fetch)}setFetcher(e){this.fetcher=e}async loadFonts(e,t){const r=new Function("m","return import(m)"),i=this.fetcher||(this.fetcher=await async function(){const{fetchBuilder:a,FileSystemCache:u}=await r("node-fetch-cache"),d=new u({cacheDirectory:".cache/typst/fonts"}),f=a.withCache(d);return function(w,x){const C=setTimeout(()=>{console.warn("font fetching is stucking:",w)},15e3);return f(w,x).finally(()=>{clearTimeout(C)})}}()),s=t.filter(a=>a instanceof Uint8Array?!0:this.loadedFonts.has(a)?!1:(this.loadedFonts.add(a),!0)),o=await Promise.all(s.map(async a=>{if(a instanceof Uint8Array){await e.add_raw_font(a);return}return new Uint8Array(await(await i(a)).arrayBuffer())}));for(const a of o)a&&await e.add_raw_font(a)}async build(e,t,r){const i={ref:this,builder:t,hooks:r};for(const o of(e==null?void 0:e.beforeBuild)??[])await o(void 0,i);return r.latelyBuild&&r.latelyBuild(i),await t.build()}}async function Bt(n,e,t,r){var i;return await e.init((i=n==null?void 0:n.getModule)==null?void 0:i.call(n)),await new Ur().build(n,new t,r)}const P=Symbol.for("reflexo-obj");var ce;(function(n){n[n.PIXEL_PER_PT=3]="PIXEL_PER_PT"})(ce=ce||(ce={}));const Nr=["LinLibertine_R.ttf","LinLibertine_RB.ttf","LinLibertine_RBI.ttf","LinLibertine_RI.ttf","NewCMMath-Book.otf","NewCMMath-Regular.otf","NewCM10-Regular.otf","NewCM10-Bold.otf","NewCM10-Italic.otf","NewCM10-BoldItalic.otf","DejaVuSansMono.ttf","DejaVuSansMono-Bold.ttf","DejaVuSansMono-Oblique.ttf","DejaVuSansMono-BoldOblique.ttf"],Hr=["InriaSerif-Bold.ttf","InriaSerif-BoldItalic.ttf","InriaSerif-Italic.ttf","InriaSerif-Regular.ttf","Roboto-Regular.ttf","NotoSerifCJKsc-Regular.otf"],Vr=["TwitterColorEmoji.ttf","NotoColorEmoji.ttf"];function Jr(n,e){var i,s;const t=[...n];if(e&&(e==null?void 0:e.assets)!==!1&&((i=e==null?void 0:e.assets)!=null&&i.length)&&((s=e==null?void 0:e.assets)==null?void 0:s.length)>0){let o=e.assetUrlPrefix??"https://raw.githubusercontent.com/Myriad-Dreamin/typst/assets-fonts";o[o.length-1]!=="/"&&(o+="/");const a=u=>u.map(d=>o+d);for(const u of e.assets)switch(u){case"text":t.push(...a(Nr));break;case"cjk":t.push(...a(Hr));break;case"emoji":t.push(...a(Vr));break}}const r=async(o,{ref:a,builder:u})=>{e!=null&&e.fetcher&&a.setFetcher(e.fetcher),await a.loadFonts(u,t)};return r._preloadRemoteFontOptions=e,r}const Kr=n=>{let e=!1,t;return()=>e?t:(e=!0,t=n())};class Wt{constructor(e){l(this,"wasmBin");l(this,"initOnce");if(typeof e!="function")throw new Error("initFn is not a function");this.initOnce=Kr(async()=>{await e(this.wasmBin)})}async init(e){this.wasmBin=e,await this.initOnce()}}var Et;Et=P;class zt{constructor(e){l(this,Et);this[P]=e}reset(){this[P].reset()}current(){return this[P].current()}setAttachDebugInfo(e){this[P].set_attach_debug_info(e)}}const Gr=new Wt(async n=>await(await Promise.resolve().then(()=>Ie)).default(n));function Qr(){return new Xr}class Xr{constructor(){l(this,"compiler");l(this,"compilerJs")}async init(e){var a,u,d,f;this.compilerJs=await Promise.resolve().then(()=>Ie);const t=this.compilerJs.TypstCompilerBuilder,r={...e||{}},i=(a=r.beforeBuild)==null?void 0:a.some(w=>w._preloadRemoteFontOptions!==void 0),s=(u=r.beforeBuild)==null?void 0:u.some(w=>{var x;return((x=w._preloadRemoteFontOptions)==null?void 0:x.assets)!==void 0}),o=(d=r.beforeBuild)==null?void 0:d.some(w=>{var x;return((x=w._preloadRemoteFontOptions)==null?void 0:x.assets)===!1});(!i||!s&&!o)&&((f=r.beforeBuild)==null||f.push(Jr([],{assets:["text"]}))),this.compiler=await Bt(e,Gr,t,{})}compile(e){return new Promise(t=>{if("incrementalServer"in e){t(this.compiler.incr_compile(e.mainFilePath,De(e.inputs),e.incrementalServer[P],st(e.diagnostics)));return}t(this.compiler.compile(e.mainFilePath,De(e.inputs),e.format||"vector",st(e.diagnostics)))})}query(e){return new Promise(t=>{t(JSON.parse(this.compiler.query(e.mainFilePath,De(e.inputs),e.selector,e.field)))})}getSemanticTokenLegend(){return new Promise(e=>{e(this.compiler.get_semantic_token_legend())})}getSemanticTokens(e){return new Promise(t=>{this.compiler.reset(),t(this.compiler.get_semantic_tokens(e.offsetEncoding||"utf-16",e.mainFilePath,e.resultId))})}async withIncrementalServer(e){const t=new zt(this.compiler.create_incr_server());try{return await e(t)}finally{t[P].free()}}async getAst(e){return this.compiler.get_ast(e)}async reset(){await new Promise(e=>{this.compiler.reset(),e(void 0)})}addSource(e,t){if(arguments.length>2)throw new Error("use of addSource(path, source, isMain) is deprecated, please use addSource(path, source) instead");this.compiler.add_source(e,t)}mapShadow(e,t){this.compiler.map_shadow(e,t)}unmapShadow(e){this.compiler.unmap_shadow(e)}resetShadow(){this.compiler.reset_shadow()}renderPageToCanvas(){throw new Error("Please use the api TypstRenderer.renderToCanvas in v0.4.0")}}function De(n){return n?Object.entries(n):void 0}function st(n){switch(n){case"none":return 1;case"unix":return 2;case"full":return 3;default:return 0}}const Yr=Object.freeze(Object.defineProperty({__proto__:null,IncrementalServer:zt,createTypstCompiler:Qr},Symbol.toStringTag,{value:"Module"}));let ot,$e;function Zr(n,e){const t=ot||n();return $e!==void 0?$e:$e=(async()=>(await t.init(e),ot=t))()}const en=Object.freeze(Object.defineProperty({__proto__:null,createGlobalRenderer:Zr},Symbol.toStringTag,{value:"Module"}));class tn{constructor(e,t,r){l(this,"pageInfos");l(this,"loadPageCount");l(this,"imageScaleFactor");l(this,"container");l(this,"canvasList");l(this,"textLayerList");l(this,"commonList");l(this,"textLayerParentList");l(this,"semanticLayerList");this.pageInfos=e,this.imageScaleFactor=r.pixelPerPt??ce.PIXEL_PER_PT,t.innerHTML="",t.style.width="100%",this.container=t,this.canvasList=new Array(this.loadPageCount),this.textLayerList=new Array(this.loadPageCount),this.commonList=new Array(this.loadPageCount),this.textLayerParentList=new Array(this.loadPageCount),this.semanticLayerList=new Array(this.loadPageCount);const i=(s,o,a)=>{const u=Math.ceil(o.width)*this.imageScaleFactor,d=Math.ceil(o.height)*this.imageScaleFactor,f=this.canvasList[s]=document.createElement("canvas"),w=this.semanticLayerList[s]=document.createElement("div"),x=this.textLayerList[s]=document.createElement("div"),C=this.textLayerParentList[s]=document.createElement("div");if(f.getContext("2d")){const T=document.createElement("div");f.width=u,f.height=d,T.appendChild(f),a.appendChild(T),T.style.position="absolute"}{C.appendChild(x),C.className="typst-html-semantics";const T=t.offsetWidth,$=T/o.width;C.style.width=`${T}px`,C.style.height=`${o.height*$}px`,C.style.setProperty("--data-text-width",`${$}px`),C.style.setProperty("--data-text-height",`${$}px`),a.classList.add("typst-page"),a.classList.add("canvas"),a.style.width=`${T}px`,a.style.height=`${d*$}px`,a.style.position="relative",w.appendChild(C),a.appendChild(w)}};for(let s=0;s<this.pageInfos.length;s++){const o=this.pageInfos[s];let a;a=this.commonList[s]=document.createElement("div"),t.appendChild(a),i(s,o,a)}}resetLayout(){for(let e=0;e<this.pageInfos.length;e++){const t=this.pageInfos[e],r=Math.ceil(t.width)*this.imageScaleFactor,i=Math.ceil(t.height)*this.imageScaleFactor,s=this.canvasList[e].parentElement;if(!s)throw new Error(`canvasDiv is null for page ${e}, canvas list length ${this.canvasList.length}`);const o=this.commonList[e],a=this.textLayerParentList[e],u=this.container.offsetWidth,d=u/r;a.style.width=`${u}px`,a.style.height=`${i*d}px`,o.style.width=`${u}px`,o.style.height=`${i*d}px`;const f=this.container.offsetWidth/r;s.style.transformOrigin="0px 0px",s.style.transform=`scale(${f})`}}}var K;(function(n){n[n.Doc=0]="Doc",n[n.Slide=1]="Slide"})(K=K||(K={}));class Xe{constructor(e){l(this,"hookedElem");l(this,"kModule");l(this,"opts");l(this,"modes",[]);l(this,"partialRendering",!0);l(this,"renderMode","svg");l(this,"r");l(this,"previewMode",K.Doc);l(this,"isContentPreview",!1);l(this,"isMixinOutline",!1);l(this,"backgroundColor","black");l(this,"pageColor","white");l(this,"pixelPerPt",3);l(this,"retrieveDOMState");l(this,"isRendering",!1);l(this,"moduleInitialized",!1);l(this,"patchQueue",[]);l(this,"disposeList",[]);l(this,"canvasRenderCToken");l(this,"currentRealScale",1);l(this,"currentScaleRatio",1);l(this,"vpTimeout");l(this,"sampledRenderTime",0);l(this,"partialRenderPage",0);l(this,"outline");l(this,"cursorPosition");l(this,"cachedDOMState",{width:0,height:0,window:{innerWidth:0,innerHeight:0},boundingRect:{left:0,top:0,right:0}});var t,r;this.hookedElem=e.hookedElem,this.kModule=e.kModule,this.opts=e||{};{const{renderMode:i,previewMode:s,isContentPreview:o,retrieveDOMState:a}=e||{};this.partialRendering=!1,this.renderMode=i??this.renderMode,this.previewMode=s??this.previewMode,this.isContentPreview=o||!1,this.retrieveDOMState=a??(()=>({width:this.hookedElem.offsetWidth,height:this.hookedElem.offsetHeight,window:{innerWidth:window.innerWidth,innerHeight:window.innerHeight},boundingRect:this.hookedElem.getBoundingClientRect()})),this.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--typst-preview-background-color")}this.hookedElem.classList.add("hide-scrollbar-x"),(t=this.hookedElem.parentElement)==null||t.classList.add("hide-scrollbar-x"),this.previewMode===K.Slide&&(this.hookedElem.classList.add("hide-scrollbar-y"),(r=this.hookedElem.parentElement)==null||r.classList.add("hide-scrollbar-y")),this.installCtrlWheelHandler()}reset(){this.kModule.reset(),this.moduleInitialized=!1}dispose(){const e=this.disposeList;this.disposeList=[],e.forEach(t=>t())}static derive(e,t){return["rescale","rerender","postRender"].reduce((r,i)=>(r[i]=e[`${i}$${t}`].bind(e),console.assert(r[i]!==void 0,`${i}$${t} is undefined`),r),{})}registerMode(e){const t=Xe.derive(this,e);this.modes.push([e,t]),e===this.renderMode&&(this.r=t)}installCtrlWheelHandler(){const e=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2.1,2.4,2.7,3,3.3,3.7,4.1,4.6,5.1,5.7,6.3,7,7.7,8.5,9.4,10],t=r=>{var i,s,o,a;if(r.ctrlKey){r.preventDefault(),this.cachedDOMState=this.retrieveDOMState(),window.onresize!==null&&(window.onresize=null);const u=this.currentScaleRatio;if(r.deltaY<0){if(this.currentScaleRatio>=e.at(-1))return;this.currentScaleRatio=e.filter(C=>C>this.currentScaleRatio).at(0)}else if(r.deltaY>0){if(this.currentScaleRatio<=e.at(0))return;this.currentScaleRatio=e.filter(C=>C<this.currentScaleRatio).at(-1)}else return;const d=this.currentScaleRatio/u,f=r.pageX*(d-1),w=r.pageY*(d-1);Math.abs(this.currentScaleRatio-1)<1e-5?(this.hookedElem.classList.add("hide-scrollbar-x"),(i=this.hookedElem.parentElement)==null||i.classList.add("hide-scrollbar-x"),this.previewMode===K.Slide&&(this.hookedElem.classList.add("hide-scrollbar-y"),(s=this.hookedElem.parentElement)==null||s.classList.add("hide-scrollbar-y"))):(this.hookedElem.classList.remove("hide-scrollbar-x"),(o=this.hookedElem.parentElement)==null||o.classList.remove("hide-scrollbar-x"),this.previewMode===K.Slide&&(this.hookedElem.classList.remove("hide-scrollbar-y"),(a=this.hookedElem.parentElement)==null||a.classList.remove("hide-scrollbar-y")));const x=this.hookedElem.firstElementChild;if(x){const C=this.getSvgScaleRatio(),F=Number.parseFloat(x.getAttribute("data-height")),T=Math.ceil(F*C);this.hookedElem.style.height=`${T*2}px`}return window.scrollBy(f,w),this.addViewportChange(),!1}};this.renderMode!=="dom"&&(typeof acquireVsCodeApi<"u"?(window.addEventListener("wheel",t,{passive:!1}),this.disposeList.push(()=>{window.removeEventListener("wheel",t)})):(document.body.addEventListener("wheel",t,{passive:!1}),this.disposeList.push(()=>{document.body.removeEventListener("wheel",t)})))}getSvgScaleRatio(){const e=this.hookedElem.firstElementChild;if(!e)return 0;const t=this.cachedDOMState,r=Number.parseFloat(e.getAttribute("data-width")||e.getAttribute("width")||"1"),i=Number.parseFloat(e.getAttribute("data-height")||e.getAttribute("height")||"1");return this.currentRealScale=this.previewMode===K.Slide?Math.min(t.width/r,t.height/i):t.width/r,this.currentRealScale*this.currentScaleRatio}processQueue(e){const t=e[0];switch(t){case"new":case"diff-v1":return t==="new"&&this.reset(),this.kModule.manipulateData({action:"merge",data:e[1]}),this.moduleInitialized=!0,!0;case"viewport-change":return this.moduleInitialized?!0:(console.log("viewport-change before initialization"),!1);default:return console.log("svgUpdateEvent",e),!1}}triggerUpdate(){if(this.isRendering)return;this.isRendering=!0;const e=async()=>{if(this.cachedDOMState=this.retrieveDOMState(),this.patchQueue.length===0){this.isRendering=!1,this.postprocessChanges();return}try{let t=performance.now();const r=this.canvasRenderCToken;r&&(await r.cancel(),await r.wait(),this.canvasRenderCToken=void 0,console.log("cancel canvas rendering"));let i=!1;for(;this.patchQueue.length>0;)i=this.processQueue(this.patchQueue.shift())||i;let s=performance.now();i&&(this.r.rescale(),await this.r.rerender(),this.r.rescale());let o=performance.now();const a=(u,d,f)=>`${u} ${(f-d).toFixed(2)} ms`;this.sampledRenderTime=o-t,console.log([a("parse",t,s),a("rerender",s,o),a("total",t,o)].join(", ")),requestAnimationFrame(e)}catch(t){console.error(t),this.isRendering=!1,this.postprocessChanges()}};requestAnimationFrame(e)}postprocessChanges(){this.r.postRender(),this.previewMode===K.Slide&&document.querySelectorAll(".typst-page-number-indicator").forEach(e=>{e.textContent=`${this.kModule.retrievePagesInfo().length}`})}addChangement(e){e[0]==="new"&&this.patchQueue.splice(0,this.patchQueue.length);const t=()=>{this.vpTimeout=void 0,this.patchQueue.push(e),this.triggerUpdate()};this.vpTimeout!==void 0&&clearTimeout(this.vpTimeout),e[0]==="viewport-change"&&this.isRendering?this.vpTimeout=setTimeout(t,this.sampledRenderTime||100):t()}addViewportChange(){this.addChangement(["viewport-change",""])}}function rn(n){return class{constructor(t){l(this,"impl");l(this,"kModule");if(t.isContentPreview&&(t.renderMode="canvas"),this.kModule=t.kModule,this.impl=new n(t),!this.impl.r)throw new Error(`mode is not supported, ${t==null?void 0:t.renderMode}`);t.isContentPreview&&(this.impl.partialRendering=!0,this.impl.pixelPerPt=1,this.impl.isMixinOutline=!0)}dispose(){this.impl.dispose()}reset(){this.impl.reset()}addChangement(t){this.impl.addChangement(t)}addViewportChange(){this.impl.addViewportChange()}setPageColor(t){this.impl.pageColor=t,this.addViewportChange()}setPartialRendering(t){this.impl.partialRendering=t}setCursor(t,r,i){this.impl.cursorPosition=[t,r,i]}setPartialPageNumber(t){return t<=0||t>this.kModule.retrievePagesInfo().length?!1:(this.impl.partialRenderPage=t-1,this.addViewportChange(),!0)}getPartialPageNumber(){return this.impl.partialRenderPage+1}setOutineData(t){this.impl.outline=t,this.addViewportChange()}}}function nn(n,...e){return e.reduce((t,r)=>r(t),n)}class sn{constructor(){l(this,"isCancellationRequested",!1);l(this,"_onCancelled");l(this,"_onCancelledResolveResolved");let e,t;this._onCancelled=new Promise(r=>{e=r,t&&t(r)}),this._onCancelledResolveResolved=new Promise(r=>{t=r,e&&r(e)})}async cancel(){await this._onCancelledResolveResolved,this.isCancellationRequested=!0}isCancelRequested(){return this.isCancellationRequested}async consume(){(await this._onCancelledResolveResolved)()}wait(){return this._onCancelled}}const on=()=>new Promise(n=>requestAnimationFrame(n));var Ve;(function(n){n[n.Doc=0]="Doc",n[n.Pages=1]="Pages"})(Ve||(Ve={}));var z;(function(n){n[n.Layout=0]="Layout",n[n.Svg=1]="Svg",n[n.Semantics=2]="Semantics",n[n.PrepareCanvas=3]="PrepareCanvas",n[n.Canvas=4]="Canvas"})(z||(z={}));function an(n){return class extends n{constructor(...r){super(...r);l(this,"tmpl",document.createElement("template"));l(this,"stub",this.createElement("<stub></stub>"));l(this,"plugin");l(this,"docKernel");l(this,"resourceHeader");l(this,"pages",[]);l(this,"domScale",1);l(this,"track_mode",Ve.Doc);l(this,"current_task");l(this,"viewport");if(this.registerMode("dom"),this.disposeList.push(()=>{this.dispose()}),this.plugin=this.opts.renderer,this.opts.domScale!==void 0){if(this.opts.domScale<=0)throw new Error("domScale must be positive");this.domScale=this.opts.domScale}}dispose(){for(const r of this.pages)r.dispose();this.docKernel&&this.docKernel.free()}createElement(r){return this.tmpl.innerHTML=r,this.tmpl.content.firstElementChild}async mountDom(r){if(console.log("mountDom",r),this.docKernel)throw new Error("already mounted");this.hookedElem.innerHTML='<svg class="typst-svg-resources" viewBox="0 0 0 0" width="0" height="0" style="opacity: 0; position: absolute;"></svg>',this.resourceHeader=this.hookedElem.querySelector(".typst-svg-resources"),this.docKernel=await this.plugin.renderer.mount_dom(this.kModule[P],this.hookedElem),this.docKernel.bind_functions({populateGlyphs:i=>{let s=this.createElement(i);console.log("populateGlyphs",s);let o=s.firstElementChild;this.resourceHeader.append(o)}})}async cancelAnyway$dom(){if(console.log("cancelAnyway$dom"),this.current_task){const r=this.current_task;this.current_task=void 0,await r.cancel()}}retrieveDOMPages(){return Array.from(this.hookedElem.querySelectorAll(".typst-dom-page"))}postRender$dom(){}rescale$dom(){}getDomViewport(r,i){const s=i.left,o=-i.top,a=i.right,u=r.innerHeight-i.top,d={x:0,y:o/this.domScale,width:Math.max(a-s,0)/this.domScale,height:Math.max(u-o,0)/this.domScale};return(d.width<=0||d.height<=0)&&(d.x=d.y=d.width=d.height=0),d}async rerender$dom(){const r=this.retrieveDOMState(),{x:i,y:s,width:o,height:a}=this.getDomViewport(r.window,r.boundingRect);if(!await this.docKernel.relayout(i,s,o,a))return;const d=new sn;this.doRender$dom(d),this.current_task=d}async doRender$dom(r){const i=(u,d)=>{if(u&&!r.isCancelRequested()&&d)return d()},s=this.retrieveDOMPages().map(u=>{const{innerWidth:d,innerHeight:f}=window,w=u.getBoundingClientRect();return{inWindow:!(w.left>d||w.right<0||w.top>f||w.bottom<0),page:u}}),o=async u=>{if(await on(),r.isCancelRequested()){console.log("cancel stage",z.Layout,u);return}const d=s[u].page,f=d.getBoundingClientRect(),w=this.getDomViewport(window,f),x=D=>this.docKernel.need_repaint(u,w.x,w.y,w.width,w.height,D),C=D=>this.docKernel.repaint(u,w.x,w.y,w.width,w.height,D),F=D=>{if(!r.isCancelRequested())return i(x(D),()=>C(D))};await F(z.Layout);const T=(f.width?Number.parseFloat(d.getAttribute("data-width"))/f.width:1)*this.domScale,$=(f.height?Number.parseFloat(d.getAttribute("data-height"))/f.height:1)*this.domScale;if(w.x*=T,w.y*=$,w.y-=100,w.width*=T,w.height*=$,w.height+=200,await F(z.Svg),await F(z.Semantics),r.isCancelRequested()){console.log("cancel stage",z.Semantics,u);return}x(z.PrepareCanvas)?(async()=>{if(await C(z.PrepareCanvas),!r.isCancelRequested())return F(z.Canvas)})():await F(z.Canvas)},a=async u=>{for(let d=0;d<s.length;++d){if(r.isCancelRequested()){console.log("cancel page",z.Layout,d);return}s[d].inWindow===u&&await o(d)}};this.cancelAnyway$dom(),await a(!0),await a(!1),!r.isCancelRequested()&&console.log("finished",z.Layout)}}}class cn extends rn(nn(Xe,an)){}var Pt;let he=(Pt=P,class{constructor(e,t){l(this,"plugin");l(this,Pt);this.plugin=e,this[P]=t}set backgroundColor(e){e!==void 0&&(this[P].background_color=e)}get backgroundColor(){return this[P].background_color}set pixelPerPt(e){e!==void 0&&(this[P].pixel_per_pt=e)}get pixelPerPt(){return this[P].pixel_per_pt}reset(){this.plugin.resetSession(this)}get doc_width(){return this[P].doc_width}get docWidth(){return this[P].doc_width}get doc_height(){return this[P].doc_height}get docHeight(){return this[P].doc_height}retrievePagesInfo(){const e=this[P].pages_info,t=[],r=e.page_count;for(let i=0;i<r;i++){const s=e.page(i);t.push({pageOffset:s.page_off,width:s.width_pt,height:s.height_pt})}return t}getSourceLoc(e){return this[P].source_span(e)}renderSvg(e){return this.plugin.renderSvg({renderSession:this,...e})}renderToSvg(e){return this.plugin.renderToSvg({renderSession:this,...e})}renderCanvas(e){return this.plugin.renderCanvas({renderSession:this,...e})}manipulateData(e){this.plugin.manipulateData({renderSession:this,...e})}renderSvgDiff(e){return this.plugin.renderSvgDiff({renderSession:this,...e})}get_source_loc(e){return this[P].source_span(e)}render_in_window(e,t,r,i){return this[P].render_in_window(e,t,r,i)}merge_delta(e){this.plugin.manipulateData({renderSession:this,action:"merge",data:e})}});var Z;(function(n){n[n.Delete=0]="Delete",n[n.New=1]="New",n[n.Update=2]="Update"})(Z||(Z={}));var It;let qt=(It=P,class{constructor(e,t){l(this,"plugin");l(this,It);l(this,"managedCanvasElemList",new Map);l(this,"canvasCounter",Math.random());this.plugin=e,this[P]=t}manipulateData(e,t){return this[P].manipulate_data(e,t)}renderCanvas(e){const t=this.managedCanvasElemList;for(const[a,u]of t)u[0]=Z.Delete;for(const a of e){const u=a.canvas;let d=u.dataset.manageId,f=Z.Update;d||(d=this.canvasCounter.toFixed(5),this.canvasCounter+=1,u.dataset.manageId=d,f=Z.New);let w=t.get(d);if(w&&w[0]!==Z.Delete)throw new Error("cannot update a canvas for two times in batch");t.set(d,[f,{...a}])}const r=Array.from(t.entries()),i=new Uint8Array(r.length),s=new Array(r.length),o=r.map(([a,[u,d]],f)=>(u||t.delete(a),i[f]=u,s[f]=d.canvas,this.plugin.canvasOptionsToRust(d)));return this[P].render_canvas(i,s,o)}async retrievePagesInfo(){const e=await this[P].get_pages_info();console.log(e);const t=[],r=e.page_count;for(let i=0;i<r;i++){const s=e.page(i);t.push({pageOffset:s.page_off,width:s.width_pt,height:s.height_pt})}return t}});const _n=n=>new Wt(async e=>await n.default(e));function un(){return new Ut}let at=!0;class Ut{constructor(){l(this,"renderer");l(this,"rendererJs")}async init(e){var r;this.rendererJs=await(((r=e==null?void 0:e.getWrapper)==null?void 0:r.call(e))||Promise.resolve().then(()=>Ye));const t=this.rendererJs.TypstRendererBuilder;this.renderer=await Bt(e,_n(this.rendererJs),t,{})}loadGlyphPack(e){return Promise.resolve()}createOptionsToRust(e){const t=new this.rendererJs.CreateSessionOptions;return e.format!==void 0&&(t.format=e.format),e.artifactContent!==void 0&&(t.artifact_content=e.artifactContent),t}canvasOptionsToRust(e){const t=new this.rendererJs.RenderPageImageOptions;if(e.pageOffset===void 0)throw new Error("pageOffset is required in reflexo v0.5.0");if(t.page_off=e.pageOffset,e.cacheKey!==void 0&&(t.cache_key=e.cacheKey),e.backgroundColor!==void 0&&(t.background_color=e.backgroundColor),e.pixelPerPt!==void 0&&(t.pixel_per_pt=e.pixelPerPt),e.dataSelection!==void 0){let r=0;e.dataSelection.body?r|=1:e.canvas&&at&&(at=!1,console.warn("dataSelection.body is not set but providing canvas for body")),(e.dataSelection.text||e.dataSelection.annotation)&&console.error("dataSelection.text and dataSelection.annotation are deprecated"),e.dataSelection.semantics&&(r|=8),t.data_selection=r}return t}retrievePagesInfoFromSession(e){return e.retrievePagesInfo()}renderCanvas(e){return this.withinOptionSession(e,async t=>this.renderer.render_page_to_canvas(t[P],e.canvas||void 0,this.canvasOptionsToRust(e)))}async inAnimationFrame(e){return new Promise((t,r)=>{requestAnimationFrame(()=>{try{t(e())}catch(i){r(i)}})})}async renderDisplayLayer(e,t,r){const s=e[P].pages_info.page_count,o=async(f,w)=>{const C=t[f].getContext("2d");if(!C)throw new Error("canvas context is null");return await this.renderCanvas({...r,canvas:C,renderSession:e,pageOffset:w})},a=performance.now(),u=await(async()=>{const f=[];for(let w=0;w<s;w++)f.push(await this.inAnimationFrame(()=>o(w,w)));return f})(),d=performance.now();return console.log(`display layer used: render = ${(d-a).toFixed(1)}ms`),u}renderTextLayer(e,t){const r=performance.now();e.forEach((s,o)=>{s.innerHTML=t[o].htmlSemantics[0]});const i=performance.now();console.log(`text layer used: render = ${(i-r).toFixed(1)}ms`)}async render(e){if("format"in e&&e.format!=="vector"&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.renderToCanvas(e)}async renderDom(e){if("format"in e&&e.format!=="vector"&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.withinOptionSession(e,async t=>{const r=new cn({...e,renderMode:"dom",hookedElem:e.container,kModule:t,renderer:this});return await r.impl.mountDom(e.pixelPerPt),r})}async renderToCanvas(e){let t,r;const i=e.container;i.style.visibility="hidden";const s=async(o,a)=>{try{r=await this.renderDisplayLayer(t,o,e),a()}finally{i.style.visibility="visible"}};return this.withinOptionSession(e,async o=>{if(t=o,t[P].pages_info.page_count===0)throw new Error("No page found in session");if(e.pixelPerPt!==void 0&&e.pixelPerPt<=0)throw new Error("Invalid typst.RenderOptions.pixelPerPt, should be a positive number "+e.pixelPerPt);let a=e.backgroundColor;if(a!==void 0&&!/^#[0-9a-f]{6}$/.test(a))throw new Error("Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ "+a);t.pixelPerPt=e.pixelPerPt??ce.PIXEL_PER_PT,t.backgroundColor=a??"#ffffff";const u=performance.now(),d=new tn(this.retrievePagesInfoFromSession(t),i,e),f=performance.now();console.log(`layer used: retieve = ${(f-u).toFixed(1)}ms`),await s(d.canvasList,()=>d.resetLayout()),this.renderTextLayer(d.textLayerList,r)})}createModule(e){return Promise.resolve(new he(this,this.renderer.create_session(e&&this.createOptionsToRust({format:"vector",artifactContent:e}))))}async createWorkerV0(e){return new qt(this,await this.renderer.create_worker(e))}workerBridge(){return this.renderer.create_worker_bridge()}renderSvg(e,t){if(e instanceof he||t)throw new Error("removed api, please use renderToSvg({ renderSession, container }) instead");return this.withinOptionSession(e,async r=>{let i;return e.data_selection&&(i=0,e.data_selection.body&&(i|=1),e.data_selection.defs&&(i|=2),e.data_selection.css&&(i|=4),e.data_selection.js&&(i|=8)),Promise.resolve(this.renderer.svg_data(r[P],i))})}renderSvgDiff(e){return e.window?this.renderer.render_svg_diff(e.renderSession[P],e.window.lo.x,e.window.lo.y,e.window.hi.x,e.window.hi.y):this.renderer.render_svg_diff(e.renderSession[P],0,0,1e33,1e33)}renderToSvg(e){return this.withinOptionSession(e,async t=>Promise.resolve(this.renderer.render_svg(t[P],e.container)))}getCustomV1(e){return Promise.resolve(this.renderer.get_customs(e.renderSession[P]))}resetSession(e){return this.renderer.reset(e[P])}manipulateData(e){return this.renderer.manipulate_data(e.renderSession[P],e.action??"reset",e.data)}withinOptionSession(e,t){function r(i){return"artifactContent"in i}if("renderSession"in e)return t(e.renderSession);if(r(e))return this.runWithSession(e,t);throw new Error("Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions")}async runWithSession(e,t){let r=e,i=t;t||(r=void 0,i=e);const s=this.renderer.create_session(r&&this.createOptionsToRust(r));try{const o=await i(new he(this,s));return s.free(),o}catch(o){throw s.free(),o}}}const dn=Object.freeze(Object.defineProperty({__proto__:null,RenderSession:he,TypstRendererDriver:Ut,TypstWorker:qt,createTypstRenderer:un},Symbol.toStringTag,{value:"Module"}));let c;const G=new Array(128).fill(void 0);G.push(void 0,null,!0,!1);function _(n){return G[n]}let ee=G.length;function ln(n){n<132||(G[n]=ee,ee=n)}function M(n){const e=_(n);return ln(n),e}function y(n){ee===G.length&&G.push(G.length+1);const e=ee;if(ee=G[e],typeof ee!="number")throw new Error("corrupt heap");return G[e]=n,e}function j(n){if(typeof n!="boolean")throw new Error(`expected a boolean argument, found ${typeof n}`)}const Nt=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Nt.decode();let ne=null;function _e(){return(ne===null||ne.byteLength===0)&&(ne=new Uint8Array(c.memory.buffer)),ne}function R(n,e){return n=n>>>0,Nt.decode(_e().subarray(n,n+e))}let A=0;const pe=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},gn=typeof pe.encodeInto=="function"?function(n,e){return pe.encodeInto(n,e)}:function(n,e){const t=pe.encode(n);return e.set(t),{read:n.length,written:t.length}};function W(n,e,t){if(typeof n!="string")throw new Error(`expected a string argument, found ${typeof n}`);if(t===void 0){const a=pe.encode(n),u=e(a.length,1)>>>0;return _e().subarray(u,u+a.length).set(a),A=a.length,u}let r=n.length,i=e(r,1)>>>0;const s=_e();let o=0;for(;o<r;o++){const a=n.charCodeAt(o);if(a>127)break;s[i+o]=a}if(o!==r){o!==0&&(n=n.slice(o)),i=t(i,r,r=o+n.length*3,1)>>>0;const a=_e().subarray(i+o,i+r),u=gn(n,a);if(u.read!==n.length)throw new Error("failed to pass whole string");o+=u.written,i=t(i,r,o,1)>>>0}return A=o,i}function O(n){return n==null}let X=null;function b(){return(X===null||X.buffer.detached===!0||X.buffer.detached===void 0&&X.buffer!==c.memory.buffer)&&(X=new DataView(c.memory.buffer)),X}function Je(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){const i=n.length;let s="[";i>0&&(s+=Je(n[0]));for(let o=1;o<i;o++)s+=", "+Je(n[o]);return s+="]",s}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}const ve=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>{c.__wbindgen_export_2.get(n.dtor)(n.a,n.b)});function ct(n,e,t,r){const i={a:n,b:e,cnt:1,dtor:t},s=(...o)=>{i.cnt++;try{return r(i.a,i.b,...o)}finally{--i.cnt===0&&(c.__wbindgen_export_2.get(i.dtor)(i.a,i.b),i.a=0,ve.unregister(i))}};return s.original=i,ve.register(s,i,i),s}function h(n,e){try{return n.apply(this,e)}catch(t){let r=function(){try{return t instanceof Error?`${t.message}

Stack:
${t.stack}`:t.toString()}catch{return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",r),t}}function p(n){if(typeof n!="number")throw new Error(`expected a number argument, found ${typeof n}`)}function fn(n,e){p(n),p(e),c.__wbindgen_export_3(n,e)}function wn(n,e,t){p(n),p(e),c.__wbindgen_export_4(n,e,y(t))}function hn(n,e,t,r){const i={a:n,b:e,cnt:1,dtor:t},s=(...o)=>{i.cnt++;const a=i.a;i.a=0;try{return r(a,i.b,...o)}finally{--i.cnt===0?(c.__wbindgen_export_2.get(i.dtor)(a,i.b),ve.unregister(i)):i.a=a}};return s.original=i,ve.register(s,i,i),s}function pn(n,e,t){p(n),p(e),c.__wbindgen_export_5(n,e,y(t))}function k(n,e){try{return n.apply(this,e)}catch(t){c.__wbindgen_export_7(y(t))}}function bn(n,e,t,r){p(n),p(e),c.__wbindgen_export_8(n,e,y(t),y(r))}function H(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`);return n.ptr}function mn(){const n=c.renderer_build_info();return M(n)}function Se(n,e){const t=e(n.length*1,1)>>>0;return _e().set(n,t/1),A=n.length,t}function _t(n,e){const t=e(n.length*4,4)>>>0,r=b();for(let i=0;i<n.length;i++)r.setUint32(t+4*i,y(n[i]),!0);return A=n.length,t}let ie=null;function yn(){return(ie===null||ie.byteLength===0)&&(ie=new Uint32Array(c.memory.buffer)),ie}function vn(n,e){const t=e(n.length*4,4)>>>0;return yn().set(n,t/4),A=n.length,t}const ut=["nonzero","evenodd"],dt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_createsessionoptions_free(n>>>0,1));class Ht{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,dt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_createsessionoptions_free(e,0)}constructor(){const e=c.createsessionoptions_new();return this.__wbg_ptr=e>>>0,dt.register(this,this.__wbg_ptr,this),this}set format(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);const t=W(e,c.__wbindgen_export_0,c.__wbindgen_export_1),r=A;c.createsessionoptions_set_format(this.__wbg_ptr,t,r)}set artifact_content(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);const t=Se(e,c.__wbindgen_export_0),r=A;c.createsessionoptions_set_artifact_content(this.__wbg_ptr,t,r)}}const lt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_incrdomdocclient_free(n>>>0,1));class Ce{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;const t=Object.create(Ce.prototype);return t.__wbg_ptr=e,lt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,lt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_incrdomdocclient_free(e,0)}bind_functions(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),c.incrdomdocclient_bind_functions(this.__wbg_ptr,y(e))}relayout(e,t,r,i){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);const s=c.incrdomdocclient_relayout(this.__wbg_ptr,e,t,r,i);return M(s)}need_repaint(e,t,r,i,s,o){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const f=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),p(e),p(o),c.incrdomdocclient_need_repaint(f,this.__wbg_ptr,e,t,r,i,s,o);var a=b().getInt32(f+4*0,!0),u=b().getInt32(f+4*1,!0),d=b().getInt32(f+4*2,!0);if(d)throw M(u);return a!==0}finally{c.__wbindgen_add_to_stack_pointer(16)}}repaint(e,t,r,i,s,o){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const f=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),p(e),p(o),c.incrdomdocclient_repaint(f,this.__wbg_ptr,e,t,r,i,s,o);var a=b().getInt32(f+4*0,!0),u=b().getInt32(f+4*1,!0),d=b().getInt32(f+4*2,!0);if(d)throw M(u);return M(a)}finally{c.__wbindgen_add_to_stack_pointer(16)}}}const gt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_pageinfo_free(n>>>0,1));class de{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;const t=Object.create(de.prototype);return t.__wbg_ptr=e,gt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,gt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_pageinfo_free(e,0)}get page_off(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),c.pageinfo_page_off(this.__wbg_ptr)>>>0}get width_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),c.pageinfo_width_pt(this.__wbg_ptr)}get height_pt(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),c.pageinfo_height_pt(this.__wbg_ptr)}}const ft=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_pagesinfo_free(n>>>0,1));class xe{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;const t=Object.create(xe.prototype);return t.__wbg_ptr=e,ft.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ft.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_pagesinfo_free(e,0)}get page_count(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),c.pagesinfo_page_count(this.__wbg_ptr)>>>0}page_by_number(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),p(e);const t=c.pagesinfo_page_by_number(this.__wbg_ptr,e);return t===0?void 0:de.__wrap(t)}page(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),p(e);const t=c.pagesinfo_page(this.__wbg_ptr,e);return de.__wrap(t)}width(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),c.pagesinfo_width(this.__wbg_ptr)}height(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),c.pagesinfo_height(this.__wbg_ptr)}}const wt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_renderpageimageoptions_free(n>>>0,1));class ge{static __unwrap(e){return e instanceof ge?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,wt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_renderpageimageoptions_free(e,0)}constructor(){const e=c.renderpageimageoptions_new();return this.__wbg_ptr=e>>>0,wt.register(this,this.__wbg_ptr,this),this}get pixel_per_pt(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),c.renderpageimageoptions_pixel_per_pt(r,this.__wbg_ptr);var e=b().getInt32(r+4*0,!0),t=b().getFloat32(r+4*1,!0);return e===0?void 0:t}finally{c.__wbindgen_add_to_stack_pointer(16)}}set pixel_per_pt(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),O(e)||p(e),c.renderpageimageoptions_set_pixel_per_pt(this.__wbg_ptr,!O(e),O(e)?0:e)}get background_color(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),c.renderpageimageoptions_background_color(r,this.__wbg_ptr);var e=b().getInt32(r+4*0,!0),t=b().getInt32(r+4*1,!0);let i;return e!==0&&(i=R(e,t).slice(),c.__wbindgen_export_6(e,t*1,1)),i}finally{c.__wbindgen_add_to_stack_pointer(16)}}set background_color(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);var t=O(e)?0:W(e,c.__wbindgen_export_0,c.__wbindgen_export_1),r=A;c.renderpageimageoptions_set_background_color(this.__wbg_ptr,t,r)}get page_off(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),c.renderpageimageoptions_page_off(this.__wbg_ptr)>>>0}set page_off(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),p(e),c.renderpageimageoptions_set_page_off(this.__wbg_ptr,e)}get cache_key(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),c.renderpageimageoptions_cache_key(r,this.__wbg_ptr);var e=b().getInt32(r+4*0,!0),t=b().getInt32(r+4*1,!0);let i;return e!==0&&(i=R(e,t).slice(),c.__wbindgen_export_6(e,t*1,1)),i}finally{c.__wbindgen_add_to_stack_pointer(16)}}set cache_key(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);var t=O(e)?0:W(e,c.__wbindgen_export_0,c.__wbindgen_export_1),r=A;c.renderpageimageoptions_set_cache_key(this.__wbg_ptr,t,r)}get data_selection(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),c.renderpageimageoptions_data_selection(r,this.__wbg_ptr);var e=b().getInt32(r+4*0,!0),t=b().getInt32(r+4*1,!0);return e===0?void 0:t>>>0}finally{c.__wbindgen_add_to_stack_pointer(16)}}set data_selection(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),O(e)||p(e),c.renderpageimageoptions_set_data_selection(this.__wbg_ptr,!O(e),O(e)?0:e)}}const ht=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_rendersession_free(n>>>0,1));class q{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;const t=Object.create(q.prototype);return t.__wbg_ptr=e,ht.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ht.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_rendersession_free(e,0)}render_in_window(e,t,r,i){let s,o;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const d=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),c.rendersession_render_in_window(d,this.__wbg_ptr,e,t,r,i);var a=b().getInt32(d+4*0,!0),u=b().getInt32(d+4*1,!0);return s=a,o=u,R(a,u)}finally{c.__wbindgen_add_to_stack_pointer(16),c.__wbindgen_export_6(s,o,1)}}get pixel_per_pt(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),c.rendersession_pixel_per_pt(r,this.__wbg_ptr);var e=b().getInt32(r+4*0,!0),t=b().getFloat32(r+4*1,!0);return e===0?void 0:t}finally{c.__wbindgen_add_to_stack_pointer(16)}}set pixel_per_pt(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),c.rendersession_set_pixel_per_pt(this.__wbg_ptr,e)}get background_color(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),c.rendersession_background_color(r,this.__wbg_ptr);var e=b().getInt32(r+4*0,!0),t=b().getInt32(r+4*1,!0);let i;return e!==0&&(i=R(e,t).slice(),c.__wbindgen_export_6(e,t*1,1)),i}finally{c.__wbindgen_add_to_stack_pointer(16)}}set background_color(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);const t=W(e,c.__wbindgen_export_0,c.__wbindgen_export_1),r=A;c.rendersession_set_background_color(this.__wbg_ptr,t,r)}get pages_info(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);const e=c.rendersession_pages_info(this.__wbg_ptr);return xe.__wrap(e)}get doc_width(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),c.rendersession_doc_width(this.__wbg_ptr)}get doc_height(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");return p(this.__wbg_ptr),c.rendersession_doc_height(this.__wbg_ptr)}source_span(e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const o=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr);const a=vn(e,c.__wbindgen_export_0),u=A;c.rendersession_source_span(o,this.__wbg_ptr,a,u);var t=b().getInt32(o+4*0,!0),r=b().getInt32(o+4*1,!0),i=b().getInt32(o+4*2,!0),s=b().getInt32(o+4*3,!0);if(s)throw M(i);let d;return t!==0&&(d=R(t,r).slice(),c.__wbindgen_export_6(t,r*1,1)),d}finally{c.__wbindgen_add_to_stack_pointer(16)}}}const pt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_rendersessionoptions_free(n>>>0,1));class Sn{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,pt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_rendersessionoptions_free(e,0)}constructor(){const e=c.rendersessionoptions_new();return this.__wbg_ptr=e>>>0,pt.register(this,this.__wbg_ptr,this),this}get pixel_per_pt(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),c.rendersessionoptions_pixel_per_pt(r,this.__wbg_ptr);var e=b().getInt32(r+4*0,!0),t=b().getFloat32(r+4*1,!0);return e===0?void 0:t}finally{c.__wbindgen_add_to_stack_pointer(16)}}set pixel_per_pt(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr),c.rendersessionoptions_set_pixel_per_pt(this.__wbg_ptr,e)}get background_color(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),c.rendersessionoptions_background_color(r,this.__wbg_ptr);var e=b().getInt32(r+4*0,!0),t=b().getInt32(r+4*1,!0);let i;return e!==0&&(i=R(e,t).slice(),c.__wbindgen_export_6(e,t*1,1)),i}finally{c.__wbindgen_add_to_stack_pointer(16)}}set background_color(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);const t=W(e,c.__wbindgen_export_0,c.__wbindgen_export_1),r=A;c.rendersessionoptions_set_background_color(this.__wbg_ptr,t,r)}get format(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const r=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),c.rendersessionoptions_format(r,this.__wbg_ptr);var e=b().getInt32(r+4*0,!0),t=b().getInt32(r+4*1,!0);let i;return e!==0&&(i=R(e,t).slice(),c.__wbindgen_export_6(e,t*1,1)),i}finally{c.__wbindgen_add_to_stack_pointer(16)}}set format(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);const t=W(e,c.__wbindgen_export_0,c.__wbindgen_export_1),r=A;c.rendersessionoptions_set_format(this.__wbg_ptr,t,r)}}const je=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_typstrenderer_free(n>>>0,1));class ke{static __wrap(e){e=e>>>0;const t=Object.create(ke.prototype);return t.__wbg_ptr=e,je.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,je.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_typstrenderer_free(e,0)}render_page_to_canvas(e,t,r){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");if(p(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");let i=0;if(!O(r)){if(H(r,ge),r.__wbg_ptr===0)throw new Error("Attempt to use a moved value");i=r.__destroy_into_raw()}const s=c.typstrenderer_render_page_to_canvas(this.__wbg_ptr,e.__wbg_ptr,y(t),i);return M(s)}load_glyph_pack(e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const i=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr),c.typstrenderer_load_glyph_pack(i,this.__wbg_ptr,y(e));var t=b().getInt32(i+4*0,!0),r=b().getInt32(i+4*1,!0);if(r)throw M(t)}finally{c.__wbindgen_add_to_stack_pointer(16)}}mount_dom(e,t){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");if(p(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");const r=c.typstrenderer_mount_dom(this.__wbg_ptr,e.__wbg_ptr,y(t));return M(r)}constructor(){const e=c.typstrenderer_new();return this.__wbg_ptr=e>>>0,je.register(this,this.__wbg_ptr,this),this}create_session(e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const s=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr);let o=0;if(!O(e)){if(H(e,Ht),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");o=e.__destroy_into_raw()}c.typstrenderer_create_session(s,this.__wbg_ptr,o);var t=b().getInt32(s+4*0,!0),r=b().getInt32(s+4*1,!0),i=b().getInt32(s+4*2,!0);if(i)throw M(r);return q.__wrap(t)}finally{c.__wbindgen_add_to_stack_pointer(16)}}reset(e){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const i=c.__wbindgen_add_to_stack_pointer(-16);if(p(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");c.typstrenderer_reset(i,this.__wbg_ptr,e.__wbg_ptr);var t=b().getInt32(i+4*0,!0),r=b().getInt32(i+4*1,!0);if(r)throw M(t)}finally{c.__wbindgen_add_to_stack_pointer(16)}}manipulate_data(e,t,r){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const o=c.__wbindgen_add_to_stack_pointer(-16);if(p(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");const a=W(t,c.__wbindgen_export_0,c.__wbindgen_export_1),u=A,d=Se(r,c.__wbindgen_export_0),f=A;c.typstrenderer_manipulate_data(o,this.__wbg_ptr,e.__wbg_ptr,a,u,d,f);var i=b().getInt32(o+4*0,!0),s=b().getInt32(o+4*1,!0);if(s)throw M(i)}finally{c.__wbindgen_add_to_stack_pointer(16)}}session_from_artifact(e,t){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const o=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr);const a=Se(e,c.__wbindgen_export_0),u=A,d=W(t,c.__wbindgen_export_0,c.__wbindgen_export_1),f=A;c.typstrenderer_session_from_artifact(o,this.__wbg_ptr,a,u,d,f);var r=b().getInt32(o+4*0,!0),i=b().getInt32(o+4*1,!0),s=b().getInt32(o+4*2,!0);if(s)throw M(i);return q.__wrap(r)}finally{c.__wbindgen_add_to_stack_pointer(16)}}render_svg_diff(e,t,r,i,s){let o,a;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const f=c.__wbindgen_add_to_stack_pointer(-16);if(p(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");c.typstrenderer_render_svg_diff(f,this.__wbg_ptr,e.__wbg_ptr,t,r,i,s);var u=b().getInt32(f+4*0,!0),d=b().getInt32(f+4*1,!0);return o=u,a=d,R(u,d)}finally{c.__wbindgen_add_to_stack_pointer(16),c.__wbindgen_export_6(o,a,1)}}svg_data(e,t){let r,i;try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const w=c.__wbindgen_add_to_stack_pointer(-16);if(p(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");O(t)||p(t),c.typstrenderer_svg_data(w,this.__wbg_ptr,e.__wbg_ptr,!O(t),O(t)?0:t);var s=b().getInt32(w+4*0,!0),o=b().getInt32(w+4*1,!0),a=b().getInt32(w+4*2,!0),u=b().getInt32(w+4*3,!0),d=s,f=o;if(u)throw d=0,f=0,M(a);return r=d,i=f,R(d,f)}finally{c.__wbindgen_add_to_stack_pointer(16),c.__wbindgen_export_6(r,i,1)}}get_customs(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");if(p(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");const t=c.typstrenderer_get_customs(this.__wbg_ptr,e.__wbg_ptr);return M(t)}render_svg(e,t){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const o=c.__wbindgen_add_to_stack_pointer(-16);if(p(this.__wbg_ptr),H(e,q),e.__wbg_ptr===0)throw new Error("Attempt to use a moved value");c.typstrenderer_render_svg(o,this.__wbg_ptr,e.__wbg_ptr,y(t));var r=b().getInt32(o+4*0,!0),i=b().getInt32(o+4*1,!0),s=b().getInt32(o+4*2,!0);if(s)throw M(i);return r!==0}finally{c.__wbindgen_add_to_stack_pointer(16)}}create_worker(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);const t=c.typstrenderer_create_worker(this.__wbg_ptr,y(e));return M(t)}create_worker_bridge(){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const i=this.__destroy_into_raw(),s=c.__wbindgen_add_to_stack_pointer(-16);p(i),c.typstrenderer_create_worker_bridge(s,i);var e=b().getInt32(s+4*0,!0),t=b().getInt32(s+4*1,!0),r=b().getInt32(s+4*2,!0);if(r)throw M(t);return Re.__wrap(e)}finally{c.__wbindgen_add_to_stack_pointer(16)}}}const bt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_typstrendererbuilder_free(n>>>0,1));class Cn{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,bt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_typstrendererbuilder_free(e,0)}add_glyph_pack(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);const t=c.typstrendererbuilder_add_glyph_pack(this.__wbg_ptr,y(e));return M(t)}add_raw_font(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);const t=c.typstrendererbuilder_add_raw_font(this.__wbg_ptr,y(e));return M(t)}add_web_fonts(e){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);const t=c.typstrendererbuilder_add_web_fonts(this.__wbg_ptr,y(e));return M(t)}constructor(){try{const i=c.__wbindgen_add_to_stack_pointer(-16);c.typstrendererbuilder_new(i);var e=b().getInt32(i+4*0,!0),t=b().getInt32(i+4*1,!0),r=b().getInt32(i+4*2,!0);if(r)throw M(t);return this.__wbg_ptr=e>>>0,bt.register(this,this.__wbg_ptr,this),this}finally{c.__wbindgen_add_to_stack_pointer(16)}}build(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const e=this.__destroy_into_raw();p(e);const t=c.typstrendererbuilder_build(e);return M(t)}}const xn=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_typstworker_free(n>>>0,1));class kn{constructor(){throw new Error("cannot invoke `new` directly")}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xn.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_typstworker_free(e,0)}manipulate_data(e,t){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const o=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr);const a=W(e,c.__wbindgen_export_0,c.__wbindgen_export_1),u=A;c.typstworker_manipulate_data(o,this.__wbg_ptr,a,u,y(t));var r=b().getInt32(o+4*0,!0),i=b().getInt32(o+4*1,!0),s=b().getInt32(o+4*2,!0);if(s)throw M(i);return M(r)}finally{c.__wbindgen_add_to_stack_pointer(16)}}get_pages_info(){if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");p(this.__wbg_ptr);const e=c.typstworker_get_pages_info(this.__wbg_ptr);return M(e)}render_canvas(e,t,r){try{if(this.__wbg_ptr==0)throw new Error("Attempt to use a moved value");const a=c.__wbindgen_add_to_stack_pointer(-16);p(this.__wbg_ptr);const u=Se(e,c.__wbindgen_export_0),d=A,f=_t(t,c.__wbindgen_export_0),w=A,x=_t(r,c.__wbindgen_export_0),C=A;c.typstworker_render_canvas(a,this.__wbg_ptr,u,d,f,w,x,C);var i=b().getInt32(a+4*0,!0),s=b().getInt32(a+4*1,!0),o=b().getInt32(a+4*2,!0);if(o)throw M(s);return M(i)}finally{c.__wbindgen_add_to_stack_pointer(16)}}}const mt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>c.__wbg_workerbridge_free(n>>>0,1));class Re{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e=e>>>0;const t=Object.create(Re.prototype);return t.__wbg_ptr=e,mt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,mt.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_workerbridge_free(e,0)}}async function Rn(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function Vt(){const n={};return n.wbg={},n.wbg.__wbg_typstrenderer_new=function(){return h(function(e){const t=ke.__wrap(e);return y(t)},arguments)},n.wbg.__wbg_call_3bfa248576352471=function(){return k(function(e,t,r){const i=_(e).call(_(t),_(r));return y(i)},arguments)},n.wbg.__wbindgen_object_drop_ref=function(e){M(e)},n.wbg.__wbindgen_object_clone_ref=function(e){const t=_(e);return y(t)},n.wbg.__wbg_incrdomdocclient_new=function(){return h(function(e){const t=Ce.__wrap(e);return y(t)},arguments)},n.wbg.__wbindgen_jsval_eq=function(e,t){const r=_(e)===_(t);return j(r),r},n.wbg.__wbg_instanceof_CanvasRenderingContext2d_775df7bd32f07559=function(){return h(function(e){let t;try{t=_(e)instanceof CanvasRenderingContext2D}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbg_instanceof_OffscreenCanvasRenderingContext2d_07b9d9deabbab2c4=function(){return h(function(e){let t;try{t=_(e)instanceof OffscreenCanvasRenderingContext2D}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbg_new_034f913e7636e987=function(){return h(function(){const e=new Array;return y(e)},arguments)},n.wbg.__wbindgen_string_new=function(e,t){const r=R(e,t);return y(r)},n.wbg.__wbg_set_425e70f7c64ac962=function(){return h(function(e,t,r){_(e)[t>>>0]=M(r)},arguments)},n.wbg.__wbg_new_e69b5f66fda8f13c=function(){return h(function(){const e=new Object;return y(e)},arguments)},n.wbg.__wbg_set_e864d25d9b399c9f=function(){return k(function(e,t,r){const i=Reflect.set(_(e),_(t),_(r));return j(i),i},arguments)},n.wbg.__wbg_remove_d7a18d9f46bc50fd=function(){return h(function(e){_(e).remove()},arguments)},n.wbg.__wbg_new_abda76e883ba8a5f=function(){return h(function(){const e=new Error;return y(e)},arguments)},n.wbg.__wbg_stack_658279fe44541cf6=function(){return h(function(e,t){const r=_(t).stack,i=W(r,c.__wbindgen_export_0,c.__wbindgen_export_1),s=A;b().setInt32(e+4*1,s,!0),b().setInt32(e+4*0,i,!0)},arguments)},n.wbg.__wbg_error_f851667af71bcfc6=function(){return h(function(e,t){let r,i;try{r=e,i=t,console.error(R(e,t))}finally{c.__wbindgen_export_6(r,i,1)}},arguments)},n.wbg.__wbg_self_bf91bf94d9e04084=function(){return k(function(){const e=self.self;return y(e)},arguments)},n.wbg.__wbg_window_52dd9f07d03fd5f8=function(){return k(function(){const e=window.window;return y(e)},arguments)},n.wbg.__wbg_globalThis_05c129bf37fcf1be=function(){return k(function(){const e=globalThis.globalThis;return y(e)},arguments)},n.wbg.__wbg_global_3eca19bb09e9c484=function(){return k(function(){const e=global.global;return y(e)},arguments)},n.wbg.__wbindgen_is_undefined=function(e){const t=_(e)===void 0;return j(t),t},n.wbg.__wbg_newnoargs_1ede4bf2ebbaaf43=function(){return h(function(e,t){const r=new Function(R(e,t));return y(r)},arguments)},n.wbg.__wbg_call_a9ef466721e824f2=function(){return k(function(e,t){const r=_(e).call(_(t));return y(r)},arguments)},n.wbg.__wbg_new_70a2f23d1565c04c=function(){return h(function(e,t){const r=new Error(R(e,t));return y(r)},arguments)},n.wbg.__wbg_new_b1572e0bf16bb8b0=function(){return k(function(e,t){const r=new OffscreenCanvas(e>>>0,t>>>0);return y(r)},arguments)},n.wbg.__wbg_getContext_211e7f0e615215a4=function(){return k(function(e,t,r){const i=_(e).getContext(R(t,r));return O(i)?0:y(i)},arguments)},n.wbg.__wbg_save_51c5c825520e8fd0=function(){return h(function(e){_(e).save()},arguments)},n.wbg.__wbg_setfont_34289a9ff190aed8=function(){return h(function(e,t,r){_(e).font=R(t,r)},arguments)},n.wbg.__wbg_measureText_8547338485b05bb0=function(){return k(function(e,t,r){const i=_(e).measureText(R(t,r));return y(i)},arguments)},n.wbg.__wbg_width_e4c18791794a7c38=function(){return h(function(e){return _(e).width},arguments)},n.wbg.__wbg_restore_cd7f36f354e951db=function(){return h(function(e){_(e).restore()},arguments)},n.wbg.__wbg_push_36cf4d81d7da33d1=function(){return h(function(e,t){const r=_(e).push(_(t));return p(r),r},arguments)},n.wbg.__wbg_settype_623d2ee701e6310a=function(){return h(function(e,t,r){_(e).type=R(t,r)},arguments)},n.wbg.__wbg_newwithu8arraysequenceandoptions_d41c0fdf78490206=function(){return k(function(e,t){const r=new Blob(_(e),_(t));return y(r)},arguments)},n.wbg.__wbg_log_f740dc2253ea759b=function(){return h(function(e){console.log(_(e))},arguments)},n.wbg.__wbg_newwithlength_76462a666eca145f=function(){return h(function(e){const t=new Uint8Array(e>>>0);return y(t)},arguments)},n.wbg.__wbg_length_9254c4bd3b9f23c4=function(){return h(function(e){const t=_(e).length;return p(t),t},arguments)},n.wbg.__wbindgen_memory=function(){const e=c.memory;return y(e)},n.wbg.__wbg_buffer_ccaed51a635d8a2d=function(){return h(function(e){const t=_(e).buffer;return y(t)},arguments)},n.wbg.__wbg_newwithbyteoffsetandlength_7e3eb787208af730=function(){return h(function(e,t,r){const i=new Uint8Array(_(e),t>>>0,r>>>0);return y(i)},arguments)},n.wbg.__wbg_set_ec2fcf81bc573fd9=function(){return h(function(e,t,r){_(e).set(_(t),r>>>0)},arguments)},n.wbg.__wbg_instanceof_Window_6575cd7f1322f82f=function(){return h(function(e){let t;try{t=_(e)instanceof Window}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbg_instanceof_WorkerGlobalScope_90a78b9e967b8726=function(){return h(function(e){let t;try{t=_(e)instanceof WorkerGlobalScope}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbg_createImageBitmap_7893beeb597d1f1b=function(){return k(function(e,t){const r=_(e).createImageBitmap(_(t));return y(r)},arguments)},n.wbg.__wbg_get_ef828680c64da212=function(){return k(function(e,t){const r=Reflect.get(_(e),_(t));return y(r)},arguments)},n.wbg.__wbindgen_is_function=function(e){const t=typeof _(e)=="function";return j(t),t},n.wbg.__wbg_call_5fb7c8066a4a4825=function(){return k(function(e,t,r,i){const s=_(e).call(_(t),_(r),_(i));return y(s)},arguments)},n.wbg.__wbg_instanceof_Promise_f3fd1bcac3157f0c=function(){return h(function(e){let t;try{t=_(e)instanceof Promise}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbg_createImageBitmap_17badae68300b0a6=function(){return k(function(e,t){const r=_(e).createImageBitmap(_(t));return y(r)},arguments)},n.wbg.__wbg_new_1073970097e5a420=function(){return h(function(e,t){try{var r={a:e,b:t},i=(o,a)=>{const u=r.a;r.a=0;try{return bn(u,r.b,o,a)}finally{r.a=u}};const s=new Promise(i);return y(s)}finally{r.a=r.b=0}},arguments)},n.wbg.__wbg_instanceof_ImageBitmap_b77911fe0757088f=function(){return h(function(e){let t;try{t=_(e)instanceof ImageBitmap}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbg_instanceof_OffscreenCanvas_ff1551edf0e1303c=function(){return h(function(e){let t;try{t=_(e)instanceof OffscreenCanvas}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbindgen_number_new=function(e){return y(e)},n.wbg.__wbg_newwithpathstring_ac464baa5b9a788c=function(){return k(function(e,t){const r=new Path2D(R(e,t));return y(r)},arguments)},n.wbg.__wbg_new_b5bf9532bd5c97fd=function(){return k(function(){const e=new Image;return y(e)},arguments)},n.wbg.__wbg_createObjectURL_11804d71ac214694=function(){return k(function(e,t){const r=URL.createObjectURL(_(t)),i=W(r,c.__wbindgen_export_0,c.__wbindgen_export_1),s=A;b().setInt32(e+4*1,s,!0),b().setInt32(e+4*0,i,!0)},arguments)},n.wbg.__wbg_width_fa277b4243adaabb=function(){return h(function(e){const t=_(e).width;return p(t),t},arguments)},n.wbg.__wbg_height_250d8ced017769f8=function(){return h(function(e){const t=_(e).height;return p(t),t},arguments)},n.wbg.__wbg_drawImage_5c4488af6c903314=function(){return k(function(e,t,r,i){_(e).drawImage(_(t),r,i)},arguments)},n.wbg.__wbg_transferToImageBitmap_a7216e0d45f09601=function(){return k(function(e){const t=_(e).transferToImageBitmap();return y(t)},arguments)},n.wbg.__wbg_setsrc_feb07d9d5b693db7=function(){return h(function(e,t,r){_(e).src=R(t,r)},arguments)},n.wbg.__wbg_setonload_c44788491be30c5c=function(){return h(function(e,t){_(e).onload=_(t)},arguments)},n.wbg.__wbg_setonerror_7e172f547433d10e=function(){return h(function(e,t){_(e).onerror=_(t)},arguments)},n.wbg.__wbg_setTransform_ab9bffd1dfaadef8=function(){return k(function(e,t,r,i,s,o,a){_(e).setTransform(t,r,i,s,o,a)},arguments)},n.wbg.__wbg_putImageData_f9c66228770c0556=function(){return k(function(e,t,r,i){_(e).putImageData(_(t),r,i)},arguments)},n.wbg.__wbg_globalCompositeOperation_7599ad6f23aa7915=function(){return k(function(e,t){const r=_(t).globalCompositeOperation,i=W(r,c.__wbindgen_export_0,c.__wbindgen_export_1),s=A;b().setInt32(e+4*1,s,!0),b().setInt32(e+4*0,i,!0)},arguments)},n.wbg.__wbg_setglobalCompositeOperation_1ec7de7c74b1fffb=function(){return k(function(e,t,r){_(e).globalCompositeOperation=R(t,r)},arguments)},n.wbg.__wbg_setfillStyle_2cc2c748b938a95e=function(){return h(function(e,t,r){_(e).fillStyle=R(t,r)},arguments)},n.wbg.__wbg_fillRect_6784ab0aab9eebd5=function(){return h(function(e,t,r,i,s){_(e).fillRect(t,r,i,s)},arguments)},n.wbg.__wbg_drawImage_007806da723a1e8b=function(){return k(function(e,t,r,i){_(e).drawImage(_(t),r,i)},arguments)},n.wbg.__wbg_clip_6e3594f765ee3015=function(){return h(function(e,t){_(e).clip(_(t))},arguments)},n.wbg.__wbg_setstrokeStyle_3c29a4e85b6087f5=function(){return h(function(e,t,r){_(e).strokeStyle=R(t,r)},arguments)},n.wbg.__wbg_stroke_18a7adc53a38d993=function(){return h(function(e,t){_(e).stroke(_(t))},arguments)},n.wbg.__wbg_drawImage_92c2feb5c6a72619=function(){return k(function(e,t,r,i,s,o){_(e).drawImage(_(t),r,i,s,o)},arguments)},n.wbg.__wbg_drawImage_198159bdfa8bb195=function(){return k(function(e,t,r,i,s,o){_(e).drawImage(_(t),r,i,s,o)},arguments)},n.wbg.__wbg_setlineWidth_267c5e81c3c67348=function(){return h(function(e,t){_(e).lineWidth=t},arguments)},n.wbg.__wbg_setlineCap_46e48efce673b5bc=function(){return h(function(e,t,r){_(e).lineCap=R(t,r)},arguments)},n.wbg.__wbg_setlineJoin_a17a487f4008f18f=function(){return h(function(e,t,r){_(e).lineJoin=R(t,r)},arguments)},n.wbg.__wbg_setmiterLimit_4b85dd19bf9935d5=function(){return h(function(e,t){_(e).miterLimit=t},arguments)},n.wbg.__wbg_setlineDashOffset_4c94a9565370ff7f=function(){return h(function(e,t){_(e).lineDashOffset=t},arguments)},n.wbg.__wbg_restore_53f9e3ba68ab6122=function(){return h(function(e){_(e).restore()},arguments)},n.wbg.__wbg_save_7da51dd755170877=function(){return h(function(e){_(e).save()},arguments)},n.wbg.__wbg_setLineDash_a27082dd66f071a9=function(){return k(function(e,t){_(e).setLineDash(_(t))},arguments)},n.wbg.__wbg_fill_dfa41e6d1844b522=function(){return h(function(e,t){_(e).fill(_(t))},arguments)},n.wbg.__wbg_fill_ab72269002ce7fc4=function(){return h(function(e,t,r){_(e).fill(_(t),ut[r])},arguments)},n.wbg.__wbg_revokeObjectURL_8e72bad4541bdca0=function(){return k(function(e,t){URL.revokeObjectURL(R(e,t))},arguments)},n.wbg.__wbg_stringify_eead5648c09faaf8=function(){return k(function(e){const t=JSON.stringify(_(e));return y(t)},arguments)},n.wbg.__wbindgen_string_get=function(e,t){const r=_(t),i=typeof r=="string"?r:void 0;var s=O(i)?0:W(i,c.__wbindgen_export_0,c.__wbindgen_export_1),o=A;b().setInt32(e+4*1,o,!0),b().setInt32(e+4*0,s,!0)},n.wbg.__wbindgen_cb_drop=function(e){const t=M(e).original;if(t.cnt--==1)return t.a=0,!0;const r=!1;return j(r),r},n.wbg.__wbg_setTransform_378786ee36ec3a18=function(){return k(function(e,t,r,i,s,o,a){_(e).setTransform(t,r,i,s,o,a)},arguments)},n.wbg.__wbg_putImageData_44bf3a0787b975b7=function(){return k(function(e,t,r,i){_(e).putImageData(_(t),r,i)},arguments)},n.wbg.__wbg_globalCompositeOperation_ce4b579a83346ce3=function(){return k(function(e,t){const r=_(t).globalCompositeOperation,i=W(r,c.__wbindgen_export_0,c.__wbindgen_export_1),s=A;b().setInt32(e+4*1,s,!0),b().setInt32(e+4*0,i,!0)},arguments)},n.wbg.__wbg_setglobalCompositeOperation_904684eaf6e9e441=function(){return k(function(e,t,r){_(e).globalCompositeOperation=R(t,r)},arguments)},n.wbg.__wbg_setfillStyle_f8273bc6290143be=function(){return h(function(e,t,r){_(e).fillStyle=R(t,r)},arguments)},n.wbg.__wbg_fillRect_0a5c5e635be36fc5=function(){return h(function(e,t,r,i,s){_(e).fillRect(t,r,i,s)},arguments)},n.wbg.__wbg_drawImage_cb573ac1888557f6=function(){return k(function(e,t,r,i){_(e).drawImage(_(t),r,i)},arguments)},n.wbg.__wbg_clip_69ebc8c1a170c5e2=function(){return h(function(e,t){_(e).clip(_(t))},arguments)},n.wbg.__wbg_setstrokeStyle_3c3c67fd62a77730=function(){return h(function(e,t,r){_(e).strokeStyle=R(t,r)},arguments)},n.wbg.__wbg_stroke_a76887577bd68088=function(){return h(function(e,t){_(e).stroke(_(t))},arguments)},n.wbg.__wbg_drawImage_79ac57dabab20303=function(){return k(function(e,t,r,i,s,o){_(e).drawImage(_(t),r,i,s,o)},arguments)},n.wbg.__wbg_drawImage_02d5af4f48e0dc26=function(){return k(function(e,t,r,i,s,o){_(e).drawImage(_(t),r,i,s,o)},arguments)},n.wbg.__wbg_setlineWidth_037dd016057a68de=function(){return h(function(e,t){_(e).lineWidth=t},arguments)},n.wbg.__wbg_setlineCap_aa5b25b6af766ba6=function(){return h(function(e,t,r){_(e).lineCap=R(t,r)},arguments)},n.wbg.__wbg_setlineJoin_316d4ae6dc0464ea=function(){return h(function(e,t,r){_(e).lineJoin=R(t,r)},arguments)},n.wbg.__wbg_setmiterLimit_06bd35f2d7370de1=function(){return h(function(e,t){_(e).miterLimit=t},arguments)},n.wbg.__wbg_setlineDashOffset_66ebdfaed783c789=function(){return h(function(e,t){_(e).lineDashOffset=t},arguments)},n.wbg.__wbg_setLineDash_8566a73c937296d9=function(){return k(function(e,t){_(e).setLineDash(_(t))},arguments)},n.wbg.__wbg_fill_35e67b0a78856ae3=function(){return h(function(e,t){_(e).fill(_(t))},arguments)},n.wbg.__wbg_fill_d28a44b2f91d1baf=function(){return h(function(e,t,r){_(e).fill(_(t),ut[r])},arguments)},n.wbg.__wbg_log_c5235279373186d4=function(){return h(function(e,t){console.log(_(e),_(t))},arguments)},n.wbg.__wbg_replaceWith_abcd4c84c203850c=function(){return k(function(e,t){_(e).replaceWith(_(t))},arguments)},n.wbg.__wbg_firstElementChild_26953b81a3e880c1=function(){return h(function(e){const t=_(e).firstElementChild;return O(t)?0:y(t)},arguments)},n.wbg.__wbg_instanceof_SvgGraphicsElement_aa4a8dae50f94d8e=function(){return h(function(e){let t;try{t=_(e)instanceof SVGGraphicsElement}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbg_nextElementSibling_f4a27a6c59d89e33=function(){return h(function(e){const t=_(e).nextElementSibling;return O(t)?0:y(t)},arguments)},n.wbg.__wbg_lastElementChild_ae2f2e9fde5a862e=function(){return h(function(e){const t=_(e).lastElementChild;return O(t)?0:y(t)},arguments)},n.wbg.__wbg_document_d7fa2c739c2b191a=function(){return h(function(e){const t=_(e).document;return O(t)?0:y(t)},arguments)},n.wbg.__wbg_createElement_e4523490bd0ae51d=function(){return k(function(e,t,r){const i=_(e).createElement(R(t,r));return y(i)},arguments)},n.wbg.__wbg_instanceof_HtmlTemplateElement_bdfc6fd7326a5794=function(){return h(function(e){let t;try{t=_(e)instanceof HTMLTemplateElement}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbg_cloneNode_bd4b7e47afe3ce9f=function(){return k(function(e){const t=_(e).cloneNode();return y(t)},arguments)},n.wbg.__wbg_instanceof_Element_1a81366cc90e70e2=function(){return h(function(e){let t;try{t=_(e)instanceof Element}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbg_setAttribute_2a8f647a8d92c712=function(){return k(function(e,t,r,i,s){_(e).setAttribute(R(t,r),R(i,s))},arguments)},n.wbg.__wbg_style_04eb1488bc2ceffc=function(){return h(function(e){const t=_(e).style;return y(t)},arguments)},n.wbg.__wbg_setProperty_b9a2384cbfb499fb=function(){return k(function(e,t,r,i,s){_(e).setProperty(R(t,r),R(i,s))},arguments)},n.wbg.__wbg_setwidth_23bf2deedd907275=function(){return h(function(e,t){_(e).width=t>>>0},arguments)},n.wbg.__wbg_setheight_239dc283bbe50da4=function(){return h(function(e,t){_(e).height=t>>>0},arguments)},n.wbg.__wbg_setinnerHTML_559d45055154f1d8=function(){return h(function(e,t,r){_(e).innerHTML=R(t,r)},arguments)},n.wbg.__wbg_content_57ec141416462f04=function(){return h(function(e){const t=_(e).content;return y(t)},arguments)},n.wbg.__wbg_firstElementChild_4d48ea0ca6da5169=function(){return h(function(e){const t=_(e).firstElementChild;return O(t)?0:y(t)},arguments)},n.wbg.__wbg_instanceof_HtmlCanvasElement_022ad88c76df9031=function(){return h(function(e){let t;try{t=_(e)instanceof HTMLCanvasElement}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbg_instanceof_SvgsvgElement_c57616bdbf67654f=function(){return h(function(e){let t;try{t=_(e)instanceof SVGSVGElement}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbg_instanceof_HtmlDivElement_571e59de6195834c=function(){return h(function(e){let t;try{t=_(e)instanceof HTMLDivElement}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbg_call_8547f4f9ec48f360=function(){return k(function(e,t,r,i,s){const o=_(e).call(_(t),_(r),_(i),_(s));return y(o)},arguments)},n.wbg.__wbg_appendChild_bc4a0deae90a5164=function(){return k(function(e,t){const r=_(e).appendChild(_(t));return y(r)},arguments)},n.wbg.__wbg_instanceof_HtmlElement_aab18e065dc9207d=function(){return h(function(e){let t;try{t=_(e)instanceof HTMLElement}catch{t=!1}const r=t;return j(r),r},arguments)},n.wbg.__wbg_getContext_bf8985355a4d22ca=function(){return k(function(e,t,r){const i=_(e).getContext(R(t,r));return O(i)?0:y(i)},arguments)},n.wbg.__wbg_clearRect_b31e8293856d6504=function(){return h(function(e,t,r,i,s){_(e).clearRect(t,r,i,s)},arguments)},n.wbg.__wbg_getAttribute_8ac49f4186f4cefd=function(){return h(function(e,t,r,i){const s=_(t).getAttribute(R(r,i));var o=O(s)?0:W(s,c.__wbindgen_export_0,c.__wbindgen_export_1),a=A;b().setInt32(e+4*1,a,!0),b().setInt32(e+4*0,o,!0)},arguments)},n.wbg.__wbg_removeProperty_5acbca68235d0706=function(){return k(function(e,t,r,i){const s=_(t).removeProperty(R(r,i)),o=W(s,c.__wbindgen_export_0,c.__wbindgen_export_1),a=A;b().setInt32(e+4*1,a,!0),b().setInt32(e+4*0,o,!0)},arguments)},n.wbg.__wbg_warn_41503a1c2194de89=function(){return h(function(e){console.warn(_(e))},arguments)},n.wbg.__wbg_new_fec2611eb9180f95=function(){return h(function(e){const t=new Uint8Array(_(e));return y(t)},arguments)},n.wbg.__wbg_clientWidth_600f98ddd2b6cb36=function(){return h(function(e){const t=_(e).clientWidth;return p(t),t},arguments)},n.wbg.__wbg_renderpageimageoptions_unwrap=function(){return h(function(e){const t=ge.__unwrap(M(e));return p(t),t},arguments)},n.wbg.__wbindgen_throw=function(e,t){throw new Error(R(e,t))},n.wbg.__wbindgen_debug_string=function(e,t){const r=Je(_(t)),i=W(r,c.__wbindgen_export_0,c.__wbindgen_export_1),s=A;b().setInt32(e+4*1,s,!0),b().setInt32(e+4*0,i,!0)},n.wbg.__wbg_then_4866a7d9f55d8f3e=function(){return h(function(e,t,r){const i=_(e).then(_(t),_(r));return y(i)},arguments)},n.wbg.__wbg_queueMicrotask_848aa4969108a57e=function(){return h(function(e){const t=_(e).queueMicrotask;return y(t)},arguments)},n.wbg.__wbg_resolve_0aad7c1484731c99=function(){return h(function(e){const t=Promise.resolve(_(e));return y(t)},arguments)},n.wbg.__wbg_then_748f75edfb032440=function(){return h(function(e,t){const r=_(e).then(_(t));return y(r)},arguments)},n.wbg.__wbg_queueMicrotask_c5419c06eab41e73=function(){return h(function(e){queueMicrotask(_(e))},arguments)},n.wbg.__wbindgen_closure_wrapper1673=function(){return h(function(e,t,r){const i=ct(e,t,201,fn);return y(i)},arguments)},n.wbg.__wbindgen_closure_wrapper1674=function(){return h(function(e,t,r){const i=ct(e,t,201,wn);return y(i)},arguments)},n.wbg.__wbindgen_closure_wrapper2245=function(){return h(function(e,t,r){const i=hn(e,t,201,pn);return y(i)},arguments)},n}function Jt(n,e){return c=n.exports,Kt.__wbindgen_wasm_module=e,X=null,ie=null,ne=null,c}function En(n){if(c!==void 0)return c;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module:n}=n:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));const e=Vt();n instanceof WebAssembly.Module||(n=new WebAssembly.Module(n));const t=new WebAssembly.Instance(n,e);return Jt(t,n)}async function Kt(n){if(c!==void 0)return c;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=Gt("typst_ts_renderer_bg.wasm",typeof document>"u"?require("url").pathToFileURL(__filename).href:te&&te.tagName.toUpperCase()==="SCRIPT"&&te.src||new URL("cjs/all-in-one-lite.bundle.js",document.baseURI).href));const e=Vt();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await Rn(await n,e);return Jt(t,r)}let Gt=async function(n,e){throw new Error("Cannot import wasm module without importer: "+n+" "+e)};function Qt(n){Gt=n}let Pn=async function(n,e){const t=new Function("m","return import(m)"),r=await t("path"),{readFileSync:i}=await t("fs"),s=new URL(r.join(r.dirname(e),n));return await i(s).buffer};const In=typeof process<"u"&&process.versions!=null&&process.versions.node!=null;In&&Qt(Pn);const Ye=Object.freeze(Object.defineProperty({__proto__:null,CreateSessionOptions:Ht,IncrDomDocClient:Ce,PageInfo:de,PagesInfo:xe,RenderPageImageOptions:ge,RenderSession:q,RenderSessionOptions:Sn,TypstRenderer:ke,TypstRendererBuilder:Cn,TypstWorker:kn,WorkerBridge:Re,default:Kt,initSync:En,renderer_build_info:mn,setImportWasmModule:Qt},Symbol.toStringTag,{value:"Module"}));let g;const Q=new Array(128).fill(void 0);Q.push(void 0,null,!0,!1);function m(n){return Q[n]}let ue=Q.length;function Mn(n){n<132||(Q[n]=ue,ue=n)}function I(n){const e=m(n);return Mn(n),e}function v(n){ue===Q.length&&Q.push(Q.length+1);const e=ue;return ue=Q[e],Q[e]=n,e}function N(n){return n==null}let Y=null;function S(){return(Y===null||Y.buffer.detached===!0||Y.buffer.detached===void 0&&Y.buffer!==g.memory.buffer)&&(Y=new DataView(g.memory.buffer)),Y}let L=0,se=null;function re(){return(se===null||se.byteLength===0)&&(se=new Uint8Array(g.memory.buffer)),se}const be=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Tn=typeof be.encodeInto=="function"?function(n,e){return be.encodeInto(n,e)}:function(n,e){const t=be.encode(n);return e.set(t),{read:n.length,written:t.length}};function B(n,e,t){if(t===void 0){const a=be.encode(n),u=e(a.length,1)>>>0;return re().subarray(u,u+a.length).set(a),L=a.length,u}let r=n.length,i=e(r,1)>>>0;const s=re();let o=0;for(;o<r;o++){const a=n.charCodeAt(o);if(a>127)break;s[i+o]=a}if(o!==r){o!==0&&(n=n.slice(o)),i=t(i,r,r=o+n.length*3,1)>>>0;const a=re().subarray(i+o,i+r),u=Tn(n,a);o+=u.written,i=t(i,r,o,1)>>>0}return L=o,i}const Xt=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Xt.decode();function J(n,e){return n=n>>>0,Xt.decode(re().subarray(n,n+e))}function Ke(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){const i=n.length;let s="[";i>0&&(s+=Ke(n[0]));for(let o=1;o<i;o++)s+=", "+Ke(n[o]);return s+="]",s}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}const yt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>{g.__wbindgen_export_2.get(n.dtor)(n.a,n.b)});function Ln(n,e,t,r){const i={a:n,b:e,cnt:1,dtor:t},s=(...o)=>{i.cnt++;const a=i.a;i.a=0;try{return r(a,i.b,...o)}finally{--i.cnt===0?(g.__wbindgen_export_2.get(i.dtor)(a,i.b),yt.unregister(i)):i.a=a}};return s.original=i,yt.register(s,i,i),s}function An(n,e,t){g.__wbindgen_export_3(n,e,v(t))}function V(n,e){try{return n.apply(this,e)}catch(t){g.__wbindgen_export_5(v(t))}}function On(n,e,t,r){g.__wbindgen_export_6(n,e,v(t),v(r))}function Yt(n,e){const t=e(n.length*1,1)>>>0;return re().set(n,t/1),L=n.length,t}function Fn(n){const e=g.get_font_info(v(n));return I(e)}function Dn(n,e){n=n>>>0;const t=S(),r=[];for(let i=n;i<n+4*e;i+=4)r.push(I(t.getUint32(i,!0)));return r}function fe(n,e){const t=e(n.length*4,4)>>>0,r=S();for(let i=0;i<n.length;i++)r.setUint32(t+4*i,v(n[i]),!0);return L=n.length,t}function $n(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`);return n.ptr}function jn(n,e){return n=n>>>0,re().subarray(n/1,n/1+e)}const vt=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>g.__wbg_incrserver_free(n>>>0,1));class le{static __wrap(e){e=e>>>0;const t=Object.create(le.prototype);return t.__wbg_ptr=e,vt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,vt.unregister(this),e}free(){const e=this.__destroy_into_raw();g.__wbg_incrserver_free(e,0)}set_attach_debug_info(e){g.incrserver_set_attach_debug_info(this.__wbg_ptr,e)}current(){try{const r=g.__wbindgen_add_to_stack_pointer(-16);g.incrserver_current(r,this.__wbg_ptr);var e=S().getInt32(r+4*0,!0),t=S().getInt32(r+4*1,!0);let i;return e!==0&&(i=jn(e,t).slice(),g.__wbindgen_export_4(e,t*1,1)),i}finally{g.__wbindgen_add_to_stack_pointer(16)}}reset(){g.incrserver_reset(this.__wbg_ptr)}}const Be=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>g.__wbg_proxycontext_free(n>>>0,1));class Ee{static __wrap(e){e=e>>>0;const t=Object.create(Ee.prototype);return t.__wbg_ptr=e,Be.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Be.unregister(this),e}free(){const e=this.__destroy_into_raw();g.__wbg_proxycontext_free(e,0)}constructor(e){const t=g.proxycontext_new(v(e));return this.__wbg_ptr=t>>>0,Be.register(this,this.__wbg_ptr,this),this}get context(){const e=g.proxycontext_context(this.__wbg_ptr);return I(e)}untar(e,t){try{const s=g.__wbindgen_add_to_stack_pointer(-16),o=Yt(e,g.__wbindgen_export_0),a=L;g.proxycontext_untar(s,this.__wbg_ptr,o,a,v(t));var r=S().getInt32(s+4*0,!0),i=S().getInt32(s+4*1,!0);if(i)throw I(r)}finally{g.__wbindgen_add_to_stack_pointer(16)}}}const St=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>g.__wbg_typstcompiler_free(n>>>0,1));class Pe{static __wrap(e){e=e>>>0;const t=Object.create(Pe.prototype);return t.__wbg_ptr=e,St.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,St.unregister(this),e}free(){const e=this.__destroy_into_raw();g.__wbg_typstcompiler_free(e,0)}reset(){try{const r=g.__wbindgen_add_to_stack_pointer(-16);g.typstcompiler_reset(r,this.__wbg_ptr);var e=S().getInt32(r+4*0,!0),t=S().getInt32(r+4*1,!0);if(t)throw I(e)}finally{g.__wbindgen_add_to_stack_pointer(16)}}set_inputs(e){try{const i=g.__wbindgen_add_to_stack_pointer(-16);g.typstcompiler_set_inputs(i,this.__wbg_ptr,v(e));var t=S().getInt32(i+4*0,!0),r=S().getInt32(i+4*1,!0);if(r)throw I(t)}finally{g.__wbindgen_add_to_stack_pointer(16)}}add_source(e,t){const r=B(e,g.__wbindgen_export_0,g.__wbindgen_export_1),i=L,s=B(t,g.__wbindgen_export_0,g.__wbindgen_export_1),o=L;return g.typstcompiler_add_source(this.__wbg_ptr,r,i,s,o)!==0}map_shadow(e,t){const r=B(e,g.__wbindgen_export_0,g.__wbindgen_export_1),i=L,s=Yt(t,g.__wbindgen_export_0),o=L;return g.typstcompiler_add_source(this.__wbg_ptr,r,i,s,o)!==0}unmap_shadow(e){const t=B(e,g.__wbindgen_export_0,g.__wbindgen_export_1),r=L;return g.typstcompiler_unmap_shadow(this.__wbg_ptr,t,r)!==0}reset_shadow(){g.typstcompiler_reset_shadow(this.__wbg_ptr)}get_loaded_fonts(){try{const i=g.__wbindgen_add_to_stack_pointer(-16);g.typstcompiler_get_loaded_fonts(i,this.__wbg_ptr);var e=S().getInt32(i+4*0,!0),t=S().getInt32(i+4*1,!0),r=Dn(e,t).slice();return g.__wbindgen_export_4(e,t*4,4),r}finally{g.__wbindgen_add_to_stack_pointer(16)}}get_ast(e){let t,r;try{const f=g.__wbindgen_add_to_stack_pointer(-16),w=B(e,g.__wbindgen_export_0,g.__wbindgen_export_1),x=L;g.typstcompiler_get_ast(f,this.__wbg_ptr,w,x);var i=S().getInt32(f+4*0,!0),s=S().getInt32(f+4*1,!0),o=S().getInt32(f+4*2,!0),a=S().getInt32(f+4*3,!0),u=i,d=s;if(a)throw u=0,d=0,I(o);return t=u,r=d,J(u,d)}finally{g.__wbindgen_add_to_stack_pointer(16),g.__wbindgen_export_4(t,r,1)}}get_semantic_token_legend(){try{const i=g.__wbindgen_add_to_stack_pointer(-16);g.typstcompiler_get_semantic_token_legend(i,this.__wbg_ptr);var e=S().getInt32(i+4*0,!0),t=S().getInt32(i+4*1,!0),r=S().getInt32(i+4*2,!0);if(r)throw I(t);return I(e)}finally{g.__wbindgen_add_to_stack_pointer(16)}}get_semantic_tokens(e,t,r){try{const w=g.__wbindgen_add_to_stack_pointer(-16),x=B(e,g.__wbindgen_export_0,g.__wbindgen_export_1),C=L;var i=N(t)?0:B(t,g.__wbindgen_export_0,g.__wbindgen_export_1),s=L,o=N(r)?0:B(r,g.__wbindgen_export_0,g.__wbindgen_export_1),a=L;g.typstcompiler_get_semantic_tokens(w,this.__wbg_ptr,x,C,i,s,o,a);var u=S().getInt32(w+4*0,!0),d=S().getInt32(w+4*1,!0),f=S().getInt32(w+4*2,!0);if(f)throw I(d);return I(u)}finally{g.__wbindgen_add_to_stack_pointer(16)}}get_artifact(e,t){try{const o=g.__wbindgen_add_to_stack_pointer(-16),a=B(e,g.__wbindgen_export_0,g.__wbindgen_export_1),u=L;g.typstcompiler_get_artifact(o,this.__wbg_ptr,a,u,t);var r=S().getInt32(o+4*0,!0),i=S().getInt32(o+4*1,!0),s=S().getInt32(o+4*2,!0);if(s)throw I(i);return I(r)}finally{g.__wbindgen_add_to_stack_pointer(16)}}set_compiler_options(e,t){try{const a=g.__wbindgen_add_to_stack_pointer(-16),u=B(e,g.__wbindgen_export_0,g.__wbindgen_export_1),d=L;var r=N(t)?0:fe(t,g.__wbindgen_export_0),i=L;g.typstcompiler_set_compiler_options(a,this.__wbg_ptr,u,d,r,i);var s=S().getInt32(a+4*0,!0),o=S().getInt32(a+4*1,!0);if(o)throw I(s)}finally{g.__wbindgen_add_to_stack_pointer(16)}}query(e,t,r,i){let s,o;try{const D=g.__wbindgen_add_to_stack_pointer(-16),ir=B(e,g.__wbindgen_export_0,g.__wbindgen_export_1),sr=L;var a=N(t)?0:fe(t,g.__wbindgen_export_0),u=L;const or=B(r,g.__wbindgen_export_0,g.__wbindgen_export_1),ar=L;var d=N(i)?0:B(i,g.__wbindgen_export_0,g.__wbindgen_export_1),f=L;g.typstcompiler_query(D,this.__wbg_ptr,ir,sr,a,u,or,ar,d,f);var w=S().getInt32(D+4*0,!0),x=S().getInt32(D+4*1,!0),C=S().getInt32(D+4*2,!0),F=S().getInt32(D+4*3,!0),T=w,$=x;if(F)throw T=0,$=0,I(C);return s=T,o=$,J(T,$)}finally{g.__wbindgen_add_to_stack_pointer(16),g.__wbindgen_export_4(s,o,1)}}compile(e,t,r,i){try{const f=g.__wbindgen_add_to_stack_pointer(-16),w=B(e,g.__wbindgen_export_0,g.__wbindgen_export_1),x=L;var s=N(t)?0:fe(t,g.__wbindgen_export_0),o=L;const C=B(r,g.__wbindgen_export_0,g.__wbindgen_export_1),F=L;g.typstcompiler_compile(f,this.__wbg_ptr,w,x,s,o,C,F,i);var a=S().getInt32(f+4*0,!0),u=S().getInt32(f+4*1,!0),d=S().getInt32(f+4*2,!0);if(d)throw I(u);return I(a)}finally{g.__wbindgen_add_to_stack_pointer(16)}}create_incr_server(){try{const i=g.__wbindgen_add_to_stack_pointer(-16);g.typstcompiler_create_incr_server(i,this.__wbg_ptr);var e=S().getInt32(i+4*0,!0),t=S().getInt32(i+4*1,!0),r=S().getInt32(i+4*2,!0);if(r)throw I(t);return le.__wrap(e)}finally{g.__wbindgen_add_to_stack_pointer(16)}}incr_compile(e,t,r,i){try{const f=g.__wbindgen_add_to_stack_pointer(-16),w=B(e,g.__wbindgen_export_0,g.__wbindgen_export_1),x=L;var s=N(t)?0:fe(t,g.__wbindgen_export_0),o=L;$n(r,le),g.typstcompiler_incr_compile(f,this.__wbg_ptr,w,x,s,o,r.__wbg_ptr,i);var a=S().getInt32(f+4*0,!0),u=S().getInt32(f+4*1,!0),d=S().getInt32(f+4*2,!0);if(d)throw I(u);return I(a)}finally{g.__wbindgen_add_to_stack_pointer(16)}}}const Ct=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>g.__wbg_typstcompilerbuilder_free(n>>>0,1));class Bn{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ct.unregister(this),e}free(){const e=this.__destroy_into_raw();g.__wbg_typstcompilerbuilder_free(e,0)}constructor(){try{const i=g.__wbindgen_add_to_stack_pointer(-16);g.typstcompilerbuilder_new(i);var e=S().getInt32(i+4*0,!0),t=S().getInt32(i+4*1,!0),r=S().getInt32(i+4*2,!0);if(r)throw I(t);return this.__wbg_ptr=e>>>0,Ct.register(this,this.__wbg_ptr,this),this}finally{g.__wbindgen_add_to_stack_pointer(16)}}set_dummy_access_model(){try{const r=g.__wbindgen_add_to_stack_pointer(-16);g.typstcompilerbuilder_set_dummy_access_model(r,this.__wbg_ptr);var e=S().getInt32(r+4*0,!0),t=S().getInt32(r+4*1,!0);if(t)throw I(e)}finally{g.__wbindgen_add_to_stack_pointer(16)}}set_access_model(e,t,r,i,s){const o=g.typstcompilerbuilder_set_access_model(this.__wbg_ptr,v(e),v(t),v(r),v(i),v(s));return I(o)}set_package_registry(e,t){const r=g.typstcompilerbuilder_set_package_registry(this.__wbg_ptr,v(e),v(t));return I(r)}add_raw_font(e){const t=g.typstcompilerbuilder_add_raw_font(this.__wbg_ptr,v(e));return I(t)}add_web_fonts(e){const t=g.typstcompilerbuilder_add_web_fonts(this.__wbg_ptr,v(e));return I(t)}add_glyph_pack(e){const t=g.typstcompilerbuilder_add_glyph_pack(this.__wbg_ptr,v(e));return I(t)}build(){const e=this.__destroy_into_raw(),t=g.typstcompilerbuilder_build(e);return I(t)}}async function Wn(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function Zt(){const n={};return n.wbg={},n.wbg.__wbindgen_object_drop_ref=function(e){I(e)},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return v(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=m(t).stack,i=B(r,g.__wbindgen_export_0,g.__wbindgen_export_1),s=L;S().setInt32(e+4*1,s,!0),S().setInt32(e+4*0,i,!0)},n.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let r,i;try{r=e,i=t,console.error(J(e,t))}finally{g.__wbindgen_export_4(r,i,1)}},n.wbg.__wbg_iterator_695d699a44d6234c=function(){return v(Symbol.iterator)},n.wbg.__wbg_get_ef828680c64da212=function(){return V(function(e,t){const r=Reflect.get(m(e),m(t));return v(r)},arguments)},n.wbg.__wbindgen_is_function=function(e){return typeof m(e)=="function"},n.wbg.__wbg_call_a9ef466721e824f2=function(){return V(function(e,t){const r=m(e).call(m(t));return v(r)},arguments)},n.wbg.__wbindgen_is_object=function(e){const t=m(e);return typeof t=="object"&&t!==null},n.wbg.__wbg_next_13b477da1eaa3897=function(e){const t=m(e).next;return v(t)},n.wbg.__wbg_length_9254c4bd3b9f23c4=function(e){return m(e).length},n.wbg.__wbindgen_memory=function(){const e=g.memory;return v(e)},n.wbg.__wbg_buffer_ccaed51a635d8a2d=function(e){const t=m(e).buffer;return v(t)},n.wbg.__wbg_new_fec2611eb9180f95=function(e){const t=new Uint8Array(m(e));return v(t)},n.wbg.__wbg_set_ec2fcf81bc573fd9=function(e,t,r){m(e).set(m(t),r>>>0)},n.wbg.__wbg_self_bf91bf94d9e04084=function(){return V(function(){const e=self.self;return v(e)},arguments)},n.wbg.__wbg_window_52dd9f07d03fd5f8=function(){return V(function(){const e=window.window;return v(e)},arguments)},n.wbg.__wbg_globalThis_05c129bf37fcf1be=function(){return V(function(){const e=globalThis.globalThis;return v(e)},arguments)},n.wbg.__wbg_global_3eca19bb09e9c484=function(){return V(function(){const e=global.global;return v(e)},arguments)},n.wbg.__wbindgen_is_undefined=function(e){return m(e)===void 0},n.wbg.__wbg_newnoargs_1ede4bf2ebbaaf43=function(e,t){const r=new Function(J(e,t));return v(r)},n.wbg.__wbg_new_70a2f23d1565c04c=function(e,t){const r=new Error(J(e,t));return v(r)},n.wbg.__wbindgen_jsval_loose_eq=function(e,t){return m(e)==m(t)},n.wbg.__wbindgen_boolean_get=function(e){const t=m(e);return typeof t=="boolean"?t?1:0:2},n.wbg.__wbindgen_is_bigint=function(e){return typeof m(e)=="bigint"},n.wbg.__wbindgen_number_get=function(e,t){const r=m(t),i=typeof r=="number"?r:void 0;S().setFloat64(e+8*1,N(i)?0:i,!0),S().setInt32(e+4*0,!N(i),!0)},n.wbg.__wbindgen_string_get=function(e,t){const r=m(t),i=typeof r=="string"?r:void 0;var s=N(i)?0:B(i,g.__wbindgen_export_0,g.__wbindgen_export_1),o=L;S().setInt32(e+4*1,o,!0),S().setInt32(e+4*0,s,!0)},n.wbg.__wbg_isArray_6f3b47f09adb61b5=function(e){return Array.isArray(m(e))},n.wbg.__wbindgen_in=function(e,t){return m(e)in m(t)},n.wbg.__wbg_instanceof_Map_f96986929e7e89ed=function(e){let t;try{t=m(e)instanceof Map}catch{t=!1}return t},n.wbg.__wbg_isSafeInteger_b9dff570f01a9100=function(e){return Number.isSafeInteger(m(e))},n.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const r=m(t),i=typeof r=="bigint"?r:void 0;S().setBigInt64(e+8*1,N(i)?BigInt(0):i,!0),S().setInt32(e+4*0,!N(i),!0)},n.wbg.__wbindgen_bigint_from_i64=function(e){return v(e)},n.wbg.__wbindgen_jsval_eq=function(e,t){return m(e)===m(t)},n.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return v(t)},n.wbg.__wbindgen_error_new=function(e,t){const r=new Error(J(e,t));return v(r)},n.wbg.__wbindgen_object_clone_ref=function(e){const t=m(e);return v(t)},n.wbg.__wbindgen_string_new=function(e,t){const r=J(e,t);return v(r)},n.wbg.__wbg_newwithbyteoffsetandlength_7e3eb787208af730=function(e,t,r){const i=new Uint8Array(m(e),t>>>0,r>>>0);return v(i)},n.wbg.__wbindgen_number_new=function(e){return v(e)},n.wbg.__wbg_call_8547f4f9ec48f360=function(){return V(function(e,t,r,i,s){const o=m(e).call(m(t),m(r),m(i),m(s));return v(o)},arguments)},n.wbg.__wbg_next_b06e115d1b01e10b=function(){return V(function(e){const t=m(e).next();return v(t)},arguments)},n.wbg.__wbg_done_983b5ffcaec8c583=function(e){return m(e).done},n.wbg.__wbg_value_2ab8a198c834c26a=function(e){const t=m(e).value;return v(t)},n.wbg.__wbg_get_5419cf6b954aa11d=function(e,t){const r=m(e)[t>>>0];return v(r)},n.wbg.__wbg_entries_c02034de337d3ee2=function(e){const t=Object.entries(m(e));return v(t)},n.wbg.__wbg_length_f217bbbf7e8e4df4=function(e){return m(e).length},n.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(e,t){const r=m(e)[m(t)];return v(r)},n.wbg.__wbindgen_is_string=function(e){return typeof m(e)=="string"},n.wbg.__wbindgen_as_number=function(e){return+m(e)},n.wbg.__wbg_instanceof_Object_4bbac482eda9b711=function(e){let t;try{t=m(e)instanceof Object}catch{t=!1}return t},n.wbg.__wbg_log_a0e624261f3b0108=function(e,t,r){console.log(m(e),m(t),m(r))},n.wbg.__wbg_call_3bfa248576352471=function(){return V(function(e,t,r){const i=m(e).call(m(t),m(r));return v(i)},arguments)},n.wbg.__wbg_instanceof_ArrayBuffer_74945570b4a62ec7=function(e){let t;try{t=m(e)instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_instanceof_Uint8Array_df0761410414ef36=function(e){let t;try{t=m(e)instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_new_e69b5f66fda8f13c=function(){const e=new Object;return v(e)},n.wbg.__wbg_new_034f913e7636e987=function(){const e=new Array;return v(e)},n.wbg.__wbg_set_f975102236d3c502=function(e,t,r){m(e)[I(t)]=I(r)},n.wbg.__wbg_set_425e70f7c64ac962=function(e,t,r){m(e)[t>>>0]=I(r)},n.wbg.__wbg_now_70af4fe37a792251=function(){return Date.now()},n.wbg.__wbg_newwithbyteoffsetandlength_5f67057565ba35bf=function(e,t,r){const i=new Uint32Array(m(e),t>>>0,r>>>0);return v(i)},n.wbg.__wbg_new_f72bacad1bb22b64=function(e){const t=new Uint32Array(m(e));return v(t)},n.wbg.__wbg_set_e864d25d9b399c9f=function(){return V(function(e,t,r){return Reflect.set(m(e),m(t),m(r))},arguments)},n.wbg.__wbg_push_36cf4d81d7da33d1=function(e,t){return m(e).push(m(t))},n.wbg.__wbg_proxycontext_new=function(e){const t=Ee.__wrap(e);return v(t)},n.wbg.__wbg_newwithargs_54f5f31ff1323eb2=function(e,t,r,i){const s=new Function(J(e,t),J(r,i));return v(s)},n.wbg.__wbg_new_1073970097e5a420=function(e,t){try{var r={a:e,b:t},i=(o,a)=>{const u=r.a;r.a=0;try{return On(u,r.b,o,a)}finally{r.a=u}};const s=new Promise(i);return v(s)}finally{r.a=r.b=0}},n.wbg.__wbg_typstcompiler_new=function(e){const t=Pe.__wrap(e);return v(t)},n.wbg.__wbg_error_428a497903e96efa=function(e,t,r){console.error(m(e),m(t),m(r))},n.wbg.__wbindgen_throw=function(e,t){throw new Error(J(e,t))},n.wbg.__wbindgen_debug_string=function(e,t){const r=Ke(m(t)),i=B(r,g.__wbindgen_export_0,g.__wbindgen_export_1),s=L;S().setInt32(e+4*1,s,!0),S().setInt32(e+4*0,i,!0)},n.wbg.__wbg_queueMicrotask_848aa4969108a57e=function(e){const t=m(e).queueMicrotask;return v(t)},n.wbg.__wbg_resolve_0aad7c1484731c99=function(e){const t=Promise.resolve(m(e));return v(t)},n.wbg.__wbindgen_cb_drop=function(e){const t=I(e).original;return t.cnt--==1?(t.a=0,!0):!1},n.wbg.__wbg_then_748f75edfb032440=function(e,t){const r=m(e).then(m(t));return v(r)},n.wbg.__wbg_queueMicrotask_c5419c06eab41e73=function(e){queueMicrotask(m(e))},n.wbg.__wbindgen_closure_wrapper15132=function(e,t,r){const i=Ln(e,t,1488,An);return v(i)},n}function er(n,e){return g=n.exports,tr.__wbindgen_wasm_module=e,Y=null,se=null,g}function zn(n){if(g!==void 0)return g;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module:n}=n:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));const e=Zt();n instanceof WebAssembly.Module||(n=new WebAssembly.Module(n));const t=new WebAssembly.Instance(n,e);return er(t,n)}async function tr(n){if(g!==void 0)return g;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=rr("typst_ts_web_compiler_bg.wasm",typeof document>"u"?require("url").pathToFileURL(__filename).href:te&&te.tagName.toUpperCase()==="SCRIPT"&&te.src||new URL("cjs/all-in-one-lite.bundle.js",document.baseURI).href));const e=Zt();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await Wn(await n,e);return er(t,r)}let rr=async function(n,e){throw new Error("Cannot import wasm module without importer: "+n+" "+e)};function nr(n){rr=n}let qn=async function(n,e){const t=new Function("m","return import(m)"),r=await t("path"),{readFileSync:i}=await t("fs"),s=new URL(r.join(r.dirname(e),n));return await i(s).buffer};const Un=typeof process<"u"&&process.versions!=null&&process.versions.node!=null;Un&&nr(qn);const Ie=Object.freeze(Object.defineProperty({__proto__:null,IncrServer:le,ProxyContext:Ee,TypstCompiler:Pe,TypstCompilerBuilder:Bn,default:tr,get_font_info:Fn,initSync:zn,setImportWasmModule:nr},Symbol.toStringTag,{value:"Module"}));exports.$typst=oe;exports.FetchAccessModel=Mt;exports.FetchPackageRegistry=ye;exports.TypstSnippet=U;exports.createTypstCompiler=jt;exports.createTypstRenderer=He;exports.createTypstSvgRenderer=Dr;exports.preloadRemoteFonts=me;exports.preloadSystemFonts=We;exports.rendererBuildInfo=$r;
