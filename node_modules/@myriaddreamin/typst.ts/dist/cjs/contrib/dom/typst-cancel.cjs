"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TypstCancellationToken = void 0;
class TypstCancellationToken {
    isCancellationRequested = false;
    _onCancelled;
    _onCancelledResolveResolved;
    constructor() {
        let resolveT = undefined;
        let resolveX = undefined;
        this._onCancelled = new Promise(resolve => {
            resolveT = resolve;
            if (resolveX) {
                resolveX(resolve);
            }
        });
        this._onCancelledResolveResolved = new Promise(resolve => {
            resolveX = resolve;
            if (resolveT) {
                resolve(resolveT);
            }
        });
    }
    async cancel() {
        await this._onCancelledResolveResolved;
        this.isCancellationRequested = true;
    }
    isCancelRequested() {
        return this.isCancellationRequested;
    }
    async consume() {
        (await this._onCancelledResolveResolved)();
    }
    wait() {
        return this._onCancelled;
    }
}
exports.TypstCancellationToken = TypstCancellationToken;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwc3QtY2FuY2VsLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb250cmliL2RvbS90eXBzdC1jYW5jZWwubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLE1BQWEsc0JBQXNCO0lBQ2pDLHVCQUF1QixHQUFZLEtBQUssQ0FBQztJQUNqQyxZQUFZLENBQWdCO0lBQzVCLDJCQUEyQixDQUFzQjtJQUV6RDtRQUNFLElBQUksUUFBUSxHQUFlLFNBQVUsQ0FBQztRQUN0QyxJQUFJLFFBQVEsR0FBNEIsU0FBVSxDQUFDO1FBQ25ELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDeEMsUUFBUSxHQUFHLE9BQU8sQ0FBQztZQUNuQixJQUFJLFFBQVEsRUFBRTtnQkFDWixRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDbkI7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQywyQkFBMkIsR0FBRyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUN2RCxRQUFRLEdBQUcsT0FBTyxDQUFDO1lBQ25CLElBQUksUUFBUSxFQUFFO2dCQUNaLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUNuQjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyxNQUFNO1FBQ1YsTUFBTSxJQUFJLENBQUMsMkJBQTJCLENBQUM7UUFDdkMsSUFBSSxDQUFDLHVCQUF1QixHQUFHLElBQUksQ0FBQztJQUN0QyxDQUFDO0lBRUQsaUJBQWlCO1FBQ2YsT0FBTyxJQUFJLENBQUMsdUJBQXVCLENBQUM7SUFDdEMsQ0FBQztJQUVELEtBQUssQ0FBQyxPQUFPO1FBQ1gsQ0FBQyxNQUFNLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxFQUFFLENBQUM7SUFDN0MsQ0FBQztJQUVELElBQUk7UUFDRixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUM7SUFDM0IsQ0FBQztDQUNGO0FBdENELHdEQXNDQyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBUeXBzdENhbmNlbGxhdGlvblRva2VuIHtcclxuICBpc0NhbmNlbGxhdGlvblJlcXVlc3RlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIHByaXZhdGUgX29uQ2FuY2VsbGVkOiBQcm9taXNlPHZvaWQ+O1xyXG4gIHByaXZhdGUgX29uQ2FuY2VsbGVkUmVzb2x2ZVJlc29sdmVkOiBQcm9taXNlPCgpID0+IHZvaWQ+O1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIGxldCByZXNvbHZlVDogKCkgPT4gdm9pZCA9IHVuZGVmaW5lZCE7XHJcbiAgICBsZXQgcmVzb2x2ZVg6IChfOiAoKSA9PiB2b2lkKSA9PiB2b2lkID0gdW5kZWZpbmVkITtcclxuICAgIHRoaXMuX29uQ2FuY2VsbGVkID0gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgIHJlc29sdmVUID0gcmVzb2x2ZTtcclxuICAgICAgaWYgKHJlc29sdmVYKSB7XHJcbiAgICAgICAgcmVzb2x2ZVgocmVzb2x2ZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy5fb25DYW5jZWxsZWRSZXNvbHZlUmVzb2x2ZWQgPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgcmVzb2x2ZVggPSByZXNvbHZlO1xyXG4gICAgICBpZiAocmVzb2x2ZVQpIHtcclxuICAgICAgICByZXNvbHZlKHJlc29sdmVUKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBjYW5jZWwoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBhd2FpdCB0aGlzLl9vbkNhbmNlbGxlZFJlc29sdmVSZXNvbHZlZDtcclxuICAgIHRoaXMuaXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgaXNDYW5jZWxSZXF1ZXN0ZWQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5pc0NhbmNlbGxhdGlvblJlcXVlc3RlZDtcclxuICB9XHJcblxyXG4gIGFzeW5jIGNvbnN1bWUoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAoYXdhaXQgdGhpcy5fb25DYW5jZWxsZWRSZXNvbHZlUmVzb2x2ZWQpKCk7XHJcbiAgfVxyXG5cclxuICB3YWl0KCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX29uQ2FuY2VsbGVkO1xyXG4gIH1cclxufVxyXG4iXX0=