"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.withGlobalRenderer = exports.createGlobalRenderer = exports.getGlobalRenderer = void 0;
let globalRenderer = undefined;
let globalRendererInitReady;
let isReady = false;
function getGlobalRenderer() {
    return isReady ? globalRenderer : undefined;
}
exports.getGlobalRenderer = getGlobalRenderer;
function createGlobalRenderer(creator, initOptions) {
    // todo: determine renderer thread-safety
    // todo: check inconsistent initOptions
    const renderer = globalRenderer || creator();
    if (globalRendererInitReady !== undefined) {
        return globalRendererInitReady;
    }
    return (globalRendererInitReady = (async () => {
        isReady = true;
        await renderer.init(initOptions);
        return (globalRenderer = renderer);
    })());
}
exports.createGlobalRenderer = createGlobalRenderer;
function withGlobalRenderer(creator, initOptions, resolve, reject) {
    const renderer = getGlobalRenderer();
    if (renderer) {
        resolve(renderer);
        return;
    }
    createGlobalRenderer(creator, initOptions).then(resolve).catch(reject);
}
exports.withGlobalRenderer = withGlobalRenderer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xvYmFsLXJlbmRlcmVyLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cmliL2dsb2JhbC1yZW5kZXJlci5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBR0EsSUFBSSxjQUFjLEdBQThCLFNBQVMsQ0FBQztBQUMxRCxJQUFJLHVCQUErQyxDQUFDO0FBQ3BELElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQztBQUVwQixTQUFnQixpQkFBaUI7SUFDL0IsT0FBTyxPQUFPLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0FBQzlDLENBQUM7QUFGRCw4Q0FFQztBQUVELFNBQWdCLG9CQUFvQixDQUNsQyxPQUE0QixFQUM1QixXQUFrQztJQUVsQyx5Q0FBeUM7SUFDekMsdUNBQXVDO0lBQ3ZDLE1BQU0sUUFBUSxHQUFHLGNBQWMsSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUU3QyxJQUFJLHVCQUF1QixLQUFLLFNBQVMsRUFBRTtRQUN6QyxPQUFPLHVCQUF1QixDQUFDO0tBQ2hDO0lBRUQsT0FBTyxDQUFDLHVCQUF1QixHQUFHLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDNUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUNmLE1BQU0sUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNqQyxPQUFPLENBQUMsY0FBYyxHQUFHLFFBQVEsQ0FBQyxDQUFDO0lBQ3JDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUNSLENBQUM7QUFqQkQsb0RBaUJDO0FBRUQsU0FBZ0Isa0JBQWtCLENBQ2hDLE9BQTRCLEVBQzVCLFdBQTZDLEVBQzdDLE9BQTBDLEVBQzFDLE1BQTJCO0lBRTNCLE1BQU0sUUFBUSxHQUFHLGlCQUFpQixFQUFFLENBQUM7SUFDckMsSUFBSSxRQUFRLEVBQUU7UUFDWixPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEIsT0FBTztLQUNSO0lBRUQsb0JBQW9CLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDekUsQ0FBQztBQWJELGdEQWFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBJbml0T3B0aW9ucyB9IGZyb20gJy4uL29wdGlvbnMuaW5pdC5tanMnO1xyXG5pbXBvcnQgdHlwZSB7IFR5cHN0UmVuZGVyZXIgfSBmcm9tICcuLi9yZW5kZXJlci5tanMnO1xyXG5cclxubGV0IGdsb2JhbFJlbmRlcmVyOiBUeXBzdFJlbmRlcmVyIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xyXG5sZXQgZ2xvYmFsUmVuZGVyZXJJbml0UmVhZHk6IFByb21pc2U8VHlwc3RSZW5kZXJlcj47XHJcbmxldCBpc1JlYWR5ID0gZmFsc2U7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0R2xvYmFsUmVuZGVyZXIoKTogVHlwc3RSZW5kZXJlciB8IHVuZGVmaW5lZCB7XHJcbiAgcmV0dXJuIGlzUmVhZHkgPyBnbG9iYWxSZW5kZXJlciA6IHVuZGVmaW5lZDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUdsb2JhbFJlbmRlcmVyKFxyXG4gIGNyZWF0b3I6ICgpID0+IFR5cHN0UmVuZGVyZXIsXHJcbiAgaW5pdE9wdGlvbnM/OiBQYXJ0aWFsPEluaXRPcHRpb25zPixcclxuKTogUHJvbWlzZTxUeXBzdFJlbmRlcmVyPiB7XHJcbiAgLy8gdG9kbzogZGV0ZXJtaW5lIHJlbmRlcmVyIHRocmVhZC1zYWZldHlcclxuICAvLyB0b2RvOiBjaGVjayBpbmNvbnNpc3RlbnQgaW5pdE9wdGlvbnNcclxuICBjb25zdCByZW5kZXJlciA9IGdsb2JhbFJlbmRlcmVyIHx8IGNyZWF0b3IoKTtcclxuXHJcbiAgaWYgKGdsb2JhbFJlbmRlcmVySW5pdFJlYWR5ICE9PSB1bmRlZmluZWQpIHtcclxuICAgIHJldHVybiBnbG9iYWxSZW5kZXJlckluaXRSZWFkeTtcclxuICB9XHJcblxyXG4gIHJldHVybiAoZ2xvYmFsUmVuZGVyZXJJbml0UmVhZHkgPSAoYXN5bmMgKCkgPT4ge1xyXG4gICAgaXNSZWFkeSA9IHRydWU7XHJcbiAgICBhd2FpdCByZW5kZXJlci5pbml0KGluaXRPcHRpb25zKTtcclxuICAgIHJldHVybiAoZ2xvYmFsUmVuZGVyZXIgPSByZW5kZXJlcik7XHJcbiAgfSkoKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB3aXRoR2xvYmFsUmVuZGVyZXIoXHJcbiAgY3JlYXRvcjogKCkgPT4gVHlwc3RSZW5kZXJlcixcclxuICBpbml0T3B0aW9uczogUGFydGlhbDxJbml0T3B0aW9ucz4gfCB1bmRlZmluZWQsXHJcbiAgcmVzb2x2ZTogKHJlbmRlcmVyOiBUeXBzdFJlbmRlcmVyKSA9PiB2b2lkLFxyXG4gIHJlamVjdD86IChlcnI6IGFueSkgPT4gdm9pZCxcclxuKSB7XHJcbiAgY29uc3QgcmVuZGVyZXIgPSBnZXRHbG9iYWxSZW5kZXJlcigpO1xyXG4gIGlmIChyZW5kZXJlcikge1xyXG4gICAgcmVzb2x2ZShyZW5kZXJlcik7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICBjcmVhdGVHbG9iYWxSZW5kZXJlcihjcmVhdG9yLCBpbml0T3B0aW9ucykudGhlbihyZXNvbHZlKS5jYXRjaChyZWplY3QpO1xyXG59XHJcbiJdfQ==