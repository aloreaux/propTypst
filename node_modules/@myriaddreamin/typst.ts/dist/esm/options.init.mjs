/**
 * this mark is used to identify the beforeBuild stage
 * @description will not be used in runtime code
 */
const BeforeBuildSymbol = Symbol('beforeBuild');
/** @internal */
const _textFonts = [
    'LinLibertine_R.ttf',
    'LinLibertine_RB.ttf',
    'LinLibertine_RBI.ttf',
    'LinLibertine_RI.ttf',
    'NewCMMath-Book.otf',
    'NewCMMath-Regular.otf',
    'NewCM10-Regular.otf',
    'NewCM10-Bold.otf',
    'NewCM10-Italic.otf',
    'NewCM10-BoldItalic.otf',
    'DejaVuSansMono.ttf',
    'DejaVuSansMono-Bold.ttf',
    'DejaVuSansMono-Oblique.ttf',
    'DejaVuSansMono-BoldOblique.ttf',
];
/** @internal */
const _cjkFonts = [
    'InriaSerif-Bold.ttf',
    'InriaSerif-BoldItalic.ttf',
    'InriaSerif-Italic.ttf',
    'InriaSerif-Regular.ttf',
    'Roboto-Regular.ttf',
    'NotoSerifCJKsc-Regular.otf',
];
/** @internal */
const _emojiFonts = ['TwitterColorEmoji.ttf', 'NotoColorEmoji.ttf'];
/**
 * disable default font assets
 */
export function disableDefaultFontAssets() {
    return preloadRemoteFonts([], { assets: false });
}
/**
 * preload font assets
 */
export function preloadFontAssets(options) {
    return preloadRemoteFonts([], options);
}
/**
 * preload remote fonts
 *
 * @param fonts - url path to font files
 * @returns {BeforeBuildFn}
 * @example
 * ```typescript
 * import { init, preloadRemoteFonts } from 'typst';
 * init({
 *   beforeBuild: [
 *     preloadRemoteFonts([
 *      'https://fonts.gstatic.com/s/roboto/v27/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2', // remote url
 *      'dist/fonts/Roboto-Regular.ttf', // relative to the root of the website
 *     ]),
 *   ],
 * });
 * ```
 */
export function preloadRemoteFonts(userFonts, options) {
    const fonts = [...userFonts];
    if (options &&
        options?.assets !== false &&
        options?.assets?.length &&
        options?.assets?.length > 0) {
        let assetUrlPrefix = options.assetUrlPrefix ??
            'https://raw.githubusercontent.com/Myriad-Dreamin/typst/assets-fonts';
        if (assetUrlPrefix[assetUrlPrefix.length - 1] !== '/') {
            assetUrlPrefix += '/';
        }
        const prefix = (f) => f.map(font => assetUrlPrefix + font);
        for (const asset of options.assets) {
            switch (asset) {
                case 'text':
                    fonts.push(...prefix(_textFonts));
                    break;
                case 'cjk':
                    fonts.push(...prefix(_cjkFonts));
                    break;
                case 'emoji':
                    fonts.push(...prefix(_emojiFonts));
                    break;
            }
        }
    }
    const loader = async (_, { ref, builder }) => {
        if (options?.fetcher) {
            ref.setFetcher(options.fetcher);
        }
        await ref.loadFonts(builder, fonts);
    };
    loader._preloadRemoteFontOptions = options;
    return loader;
}
/**
 * preload system fonts
 * @param byFamily - filter system fonts to preload by family name
 * @returns {BeforeBuildFn}
 * @example
 * ```typescript
 * import { init, preloadSystemFonts } from 'typst';
 * init({
 *   beforeBuild: [
 *     preloadSystemFonts({
 *       byFamily: ['Roboto'], // preload fonts by family name
 *     }),
 *   ],
 * });
 * ```
 */
export function preloadSystemFonts({ byFamily }) {
    return async (_, { builder }) => {
        const t = performance.now();
        if ('queryLocalFonts' in window) {
            const fonts = await window.queryLocalFonts();
            byFamily = byFamily ?? [];
            for (const font of fonts) {
                if (!byFamily.includes(font.family)) {
                    continue;
                }
                const data = await (await font.blob()).arrayBuffer();
                await builder.add_raw_font(new Uint8Array(data));
            }
        }
        const t2 = performance.now();
        console.log('preload system font time used:', t2 - t);
    };
}
/**
 * (compile only) set pacoage registry
 *
 * @param accessModel: when compiling, the pacoage registry is used to access the
 * data of files
 * @returns {BeforeBuildFn}
 */
export function withPackageRegistry(packageRegistry) {
    return async (_, { builder }) => {
        return new Promise(resolve => {
            builder.set_package_registry(packageRegistry, function (spec) {
                return packageRegistry.resolve(spec, this);
            });
            resolve();
        });
    };
}
/**
 * (compile only) set access model
 *
 * @param accessModel: when compiling, the access model is used to access the
 * data of files
 * @returns {BeforeBuildFn}
 */
export function withAccessModel(accessModel) {
    return async (_, ctx) => {
        if (ctx.alreadySetAccessModel) {
            throw new Error(`already set some assess model before: ${ctx.alreadySetAccessModel.constructor?.name}(${ctx.alreadySetAccessModel})`);
        }
        ctx.alreadySetAccessModel = accessModel;
        return new Promise(resolve => {
            ctx.builder.set_access_model(accessModel, (path) => {
                const lastModified = accessModel.getMTime(path);
                if (lastModified) {
                    return lastModified.getTime();
                }
                return 0;
            }, (path) => {
                return accessModel.isFile(path) || false;
            }, (path) => {
                return accessModel.getRealPath(path) || path;
            }, (path) => {
                return accessModel.readAll(path);
            });
            resolve();
        });
    };
}
// todo: search browser
// searcher.search_browser().await?;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3B0aW9ucy5pbml0Lm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcHRpb25zLmluaXQubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWFBOzs7R0FHRztBQUNILE1BQU0saUJBQWlCLEdBQWtCLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQWlEL0QsZ0JBQWdCO0FBQ2hCLE1BQU0sVUFBVSxHQUFhO0lBQzNCLG9CQUFvQjtJQUNwQixxQkFBcUI7SUFDckIsc0JBQXNCO0lBQ3RCLHFCQUFxQjtJQUNyQixvQkFBb0I7SUFDcEIsdUJBQXVCO0lBQ3ZCLHFCQUFxQjtJQUNyQixrQkFBa0I7SUFDbEIsb0JBQW9CO0lBQ3BCLHdCQUF3QjtJQUN4QixvQkFBb0I7SUFDcEIseUJBQXlCO0lBQ3pCLDRCQUE0QjtJQUM1QixnQ0FBZ0M7Q0FDakMsQ0FBQztBQUNGLGdCQUFnQjtBQUNoQixNQUFNLFNBQVMsR0FBYTtJQUMxQixxQkFBcUI7SUFDckIsMkJBQTJCO0lBQzNCLHVCQUF1QjtJQUN2Qix3QkFBd0I7SUFDeEIsb0JBQW9CO0lBQ3BCLDRCQUE0QjtDQUM3QixDQUFDO0FBQ0YsZ0JBQWdCO0FBQ2hCLE1BQU0sV0FBVyxHQUFhLENBQUMsdUJBQXVCLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztBQW1DOUU7O0dBRUc7QUFDSCxNQUFNLFVBQVUsd0JBQXdCO0lBQ3RDLE9BQU8sa0JBQWtCLENBQUMsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7QUFDbkQsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLGlCQUFpQixDQUFDLE9BQWlDO0lBQ2pFLE9BQU8sa0JBQWtCLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ3pDLENBQUM7QUFFRDs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FpQkc7QUFDSCxNQUFNLFVBQVUsa0JBQWtCLENBQ2hDLFNBQWtDLEVBQ2xDLE9BQWdDO0lBRWhDLE1BQU0sS0FB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QyxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUM7WUFDM0MsQ0FBQyxFQUNELENBQUMsSUFBWSxFQUFFLEVBQUU7Z0JBQ2YsT0FBTyxXQUFXLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQztZQUMvQyxDQUFDLEVBQ0QsQ0FBQyxJQUFZLEVBQUUsRUFBRTtnQkFDZixPQUFPLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbkMsQ0FBQyxDQUNGLENBQUM7WUFDRixPQUFPLEVBQUUsQ0FBQztRQUNaLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQW1CRCx1QkFBdUI7QUFDdkIsb0NBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQHRzLWlnbm9yZVxyXG5pbXBvcnQgdHlwZSAqIGFzIHR5cHN0UmVuZGVyZXIgZnJvbSAnQG15cmlhZGRyZWFtaW4vdHlwc3QtdHMtcmVuZGVyZXInO1xyXG5pbXBvcnQgdHlwZSAqIGFzIHR5cHN0Q29tcGlsZXIgZnJvbSAnQG15cmlhZGRyZWFtaW4vdHlwc3QtdHMtd2ViLWNvbXBpbGVyJztcclxuaW1wb3J0IHR5cGUgeyBGc0FjY2Vzc01vZGVsLCBQYWNrYWdlUmVnaXN0cnksIFBhY2thZ2VTcGVjIH0gZnJvbSAnLi9pbnRlcm5hbC50eXBlcy5tanMnO1xyXG5pbXBvcnQgdHlwZSB7IFdlYkFzc2VtYmx5TW9kdWxlUmVmIH0gZnJvbSAnLi93YXNtLm1qcyc7XHJcblxyXG4vKipcclxuICogc3RhZ2VkIG9wdGlvbnMgZnVuY3Rpb25cclxuICogQHRlbXBsYXRlIFMgLSBzdGFnZSBtYXJrXHJcbiAqIEB0ZW1wbGF0ZSBUIC0gY29udGV4dCB0eXBlXHJcbiAqL1xyXG5leHBvcnQgdHlwZSBTdGFnZWRPcHRGbjxTIGV4dGVuZHMgc3ltYm9sLCBUID0gYW55PiA9IChzOiBTLCB0OiBUKSA9PiBQcm9taXNlPHZvaWQ+O1xyXG5cclxuLyoqXHJcbiAqIHRoaXMgbWFyayBpcyB1c2VkIHRvIGlkZW50aWZ5IHRoZSBiZWZvcmVCdWlsZCBzdGFnZVxyXG4gKiBAZGVzY3JpcHRpb24gd2lsbCBub3QgYmUgdXNlZCBpbiBydW50aW1lIGNvZGVcclxuICovXHJcbmNvbnN0IEJlZm9yZUJ1aWxkU3ltYm9sOiB1bmlxdWUgc3ltYm9sID0gU3ltYm9sKCdiZWZvcmVCdWlsZCcpO1xyXG5cclxuLyoqXHJcbiAqIHRoaXMgbWFyayBpcyB1c2VkIHRvIGlkZW50aWZ5IHRoZSBiZWZvcmVCdWlsZCBzdGFnZVxyXG4gKiBAZGVzY3JpcHRpb24gY2Fubm90IGJlIGNyZWF0ZWQgYnkgYW55IHJ1bnRpbWUgY29kZVxyXG4gKi9cclxuZXhwb3J0IHR5cGUgQmVmb3JlQnVpbGRNYXJrID0gdHlwZW9mIEJlZm9yZUJ1aWxkU3ltYm9sO1xyXG5cclxuLyoqXHJcbiAqIGJlZm9yZSBidWlsZCBzdGFnZVxyXG4gKiBAZGVzY3JpcHRpb24gcG9zc2libGUgY3JlYXRlZCBieTpcclxuICogICAtIHByZWxvYWRSZW1vdGVGb250c1xyXG4gKiAgIC0gcHJlbG9hZFN5c3RlbUZvbnRzXHJcbiAqICAgLSB3aXRoQWNjZXNzTW9kZWxcclxuICogICAtIHdpdGhQYWNrYWdlUmVnaXN0cnlcclxuICovXHJcbmV4cG9ydCB0eXBlIEJlZm9yZUJ1aWxkRm4gPSBTdGFnZWRPcHRGbjxCZWZvcmVCdWlsZE1hcms+O1xyXG5cclxuLyoqXHJcbiAqXHJcbiAqIEBwcm9wZXJ0eSB7QmVmb3JlQnVpbGRGbltdfSBiZWZvcmVCdWlsZCAtIGNhbGxiYWNrcyBiZWZvcmUgYnVpbGQgc3RhZ2VcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgSW5pdE9wdGlvbnMge1xyXG4gIC8qKlxyXG4gICAqIGNhbGxiYWNrcyBiZWZvcmUgYnVpbGQgc3RhZ2VcclxuICAgKlxyXG4gICAqIGJlZm9yZSBidWlsZCBzdGFnZSwgdGhlIHJlZ2lzdGVyZWQgZnVuY3Rpb25zIHdpbGwgYmUgZXhlY3V0ZWQgaW4gb3JkZXJcclxuICAgKiBwb3NzaWJsZSBvcHRpb25zOlxyXG4gICAqIC0gcHJlbG9hZFJlbW90ZUZvbnRzXHJcbiAgICogLSBwcmVsb2FkU3lzdGVtRm9udHNcclxuICAgKiAtIHdpdGhBY2Nlc3NNb2RlbFxyXG4gICAqL1xyXG4gIGJlZm9yZUJ1aWxkOiBCZWZvcmVCdWlsZEZuW107XHJcblxyXG4gIC8qKlxyXG4gICAqIGNhbGxiYWNrcyB0byBmZXRjaCB0aGUgd2FzbSBtb2R1bGUgd3JhcHBlclxyXG4gICAqL1xyXG4gIGdldFdyYXBwZXI/KCk6IFByb21pc2U8YW55PjtcclxuXHJcbiAgLyoqXHJcbiAgICogY2FsbGJhY2tzIHRvIGZldGNoIHRoZSB3YXNtIG1vZHVsZVxyXG4gICAqXHJcbiAgICogVGhlcmUgYXJlIG1hbnkgd2F5cyB0byBwcm92aWRlIGEgd2FzbSBtb2R1bGUsIHNlZVxyXG4gICAqIHtAbGluayBXZWJBc3NlbWJseU1vZHVsZVJlZn0gZm9yIG1vcmUgZGV0YWlscy4gSWYgeW91IGRvbid0IHByb3ZpZGUgYSB3YXNtXHJcbiAgICogbW9kdWxlLCB0aGUgZGVmYXVsdCBtb2R1bGUgd2lsbCBiZSB1c2VkLlxyXG4gICAqL1xyXG4gIGdldE1vZHVsZSgpOiBXZWJBc3NlbWJseU1vZHVsZVJlZiB8IFByb21pc2U8V2ViQXNzZW1ibHlNb2R1bGVSZWY+O1xyXG59XHJcblxyXG4vKiogQGludGVybmFsICovXHJcbmNvbnN0IF90ZXh0Rm9udHM6IHN0cmluZ1tdID0gW1xyXG4gICdMaW5MaWJlcnRpbmVfUi50dGYnLFxyXG4gICdMaW5MaWJlcnRpbmVfUkIudHRmJyxcclxuICAnTGluTGliZXJ0aW5lX1JCSS50dGYnLFxyXG4gICdMaW5MaWJlcnRpbmVfUkkudHRmJyxcclxuICAnTmV3Q01NYXRoLUJvb2sub3RmJyxcclxuICAnTmV3Q01NYXRoLVJlZ3VsYXIub3RmJyxcclxuICAnTmV3Q00xMC1SZWd1bGFyLm90ZicsXHJcbiAgJ05ld0NNMTAtQm9sZC5vdGYnLFxyXG4gICdOZXdDTTEwLUl0YWxpYy5vdGYnLFxyXG4gICdOZXdDTTEwLUJvbGRJdGFsaWMub3RmJyxcclxuICAnRGVqYVZ1U2Fuc01vbm8udHRmJyxcclxuICAnRGVqYVZ1U2Fuc01vbm8tQm9sZC50dGYnLFxyXG4gICdEZWphVnVTYW5zTW9uby1PYmxpcXVlLnR0ZicsXHJcbiAgJ0RlamFWdVNhbnNNb25vLUJvbGRPYmxpcXVlLnR0ZicsXHJcbl07XHJcbi8qKiBAaW50ZXJuYWwgKi9cclxuY29uc3QgX2Nqa0ZvbnRzOiBzdHJpbmdbXSA9IFtcclxuICAnSW5yaWFTZXJpZi1Cb2xkLnR0ZicsXHJcbiAgJ0lucmlhU2VyaWYtQm9sZEl0YWxpYy50dGYnLFxyXG4gICdJbnJpYVNlcmlmLUl0YWxpYy50dGYnLFxyXG4gICdJbnJpYVNlcmlmLVJlZ3VsYXIudHRmJyxcclxuICAnUm9ib3RvLVJlZ3VsYXIudHRmJyxcclxuICAnTm90b1NlcmlmQ0pLc2MtUmVndWxhci5vdGYnLFxyXG5dO1xyXG4vKiogQGludGVybmFsICovXHJcbmNvbnN0IF9lbW9qaUZvbnRzOiBzdHJpbmdbXSA9IFsnVHdpdHRlckNvbG9yRW1vamkudHRmJywgJ05vdG9Db2xvckVtb2ppLnR0ZiddO1xyXG5cclxudHlwZSBBdmFpbGFibGVGb250QXNzZXQgPSAndGV4dCcgfCAnY2prJyB8ICdlbW9qaSc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIExvYWRSZW1vdGVBc3NldHNPcHRpb25zIHtcclxuICAvKipcclxuICAgKiBwcmVsb2FkIGZvbnQgYXNzZXRzIG9yIGRvbid0IHByZWxvYWQgYW55IGZvbnQgYXNzZXRzXHJcbiAgICogQGRlZmF1bHQgWyd0ZXh0J11cclxuICAgKi9cclxuICBhc3NldHM/OiBBdmFpbGFibGVGb250QXNzZXRbXSB8IGZhbHNlO1xyXG5cclxuICAvKipcclxuICAgKiBjdXN0b21pemUgdXJsIHByZWZpeCBmb3IgZGVmYXVsdCBhc3NldHMgZnJvbSByZW1vdGVcclxuICAgKlxyXG4gICAqIFRoZSBkZWZhdWx0IGFzc2V0cyBhcmUgaG9zdGVkIG9uIGdpdGh1YiwgeW91IGNhbiBkb3dubG9hZCB0aGVtIGFuZCBob3N0XHJcbiAgICogdGhlbSBvbiB5b3VyIG93biBzZXJ2ZXIsIHdoaWNoIGlzIG1vcmUgcHJhY3RpY2FsIGZvciBwcm9kdWN0aW9uLlxyXG4gICAqXHJcbiAgICogSG9zdGVkIGF0OiBodHRwczovL2dpdGh1Yi5jb20vTXlyaWFkLURyZWFtaW4vdHlwc3QvdHJlZS9hc3NldHMtZm9udHNcclxuICAgKiBMaXN0IG9mIGFzc2V0czpcclxuICAgKiBTZWUge0BsaW5rIF90ZXh0Rm9udHN9LCB7QGxpbmsgX2Nqa0ZvbnRzfSwgYW5kIHtAbGluayBfZW1vamlGb250c31cclxuICAgKlxyXG4gICAqIEBkZWZhdWx0ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vTXlyaWFkLURyZWFtaW4vdHlwc3QvYXNzZXRzLWZvbnRzLycnXHJcbiAgICovXHJcbiAgYXNzZXRVcmxQcmVmaXg/OiBzdHJpbmc7XHJcblxyXG4gIC8qKlxyXG4gICAqIGN1c3RvbSBmZXRjaGVyXHJcbiAgICogTm90ZTogdGhlIGRlZmF1bHQgZmV0Y2hlciBmb3Igbm9kZS5qcyBkb2VzIG5vdCBjYWNoZSBhbnkgZm9udHNcclxuICAgKiBAZGVmYXVsdCBmZXRjaFxyXG4gICAqL1xyXG4gIGZldGNoZXI/OiB0eXBlb2YgZmV0Y2g7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgTG9hZFJlbW90ZUZvbnRzT3B0aW9ucyBleHRlbmRzIExvYWRSZW1vdGVBc3NldHNPcHRpb25zIHt9XHJcblxyXG4vKipcclxuICogZGlzYWJsZSBkZWZhdWx0IGZvbnQgYXNzZXRzXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZGlzYWJsZURlZmF1bHRGb250QXNzZXRzKCk6IEJlZm9yZUJ1aWxkRm4ge1xyXG4gIHJldHVybiBwcmVsb2FkUmVtb3RlRm9udHMoW10sIHsgYXNzZXRzOiBmYWxzZSB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIHByZWxvYWQgZm9udCBhc3NldHNcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwcmVsb2FkRm9udEFzc2V0cyhvcHRpb25zPzogTG9hZFJlbW90ZUFzc2V0c09wdGlvbnMpOiBCZWZvcmVCdWlsZEZuIHtcclxuICByZXR1cm4gcHJlbG9hZFJlbW90ZUZvbnRzKFtdLCBvcHRpb25zKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIHByZWxvYWQgcmVtb3RlIGZvbnRzXHJcbiAqXHJcbiAqIEBwYXJhbSBmb250cyAtIHVybCBwYXRoIHRvIGZvbnQgZmlsZXNcclxuICogQHJldHVybnMge0JlZm9yZUJ1aWxkRm59XHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYHR5cGVzY3JpcHRcclxuICogaW1wb3J0IHsgaW5pdCwgcHJlbG9hZFJlbW90ZUZvbnRzIH0gZnJvbSAndHlwc3QnO1xyXG4gKiBpbml0KHtcclxuICogICBiZWZvcmVCdWlsZDogW1xyXG4gKiAgICAgcHJlbG9hZFJlbW90ZUZvbnRzKFtcclxuICogICAgICAnaHR0cHM6Ly9mb250cy5nc3RhdGljLmNvbS9zL3JvYm90by92MjcvS0ZPbUNucUV1OTJGcjFNdTRteEtLVFUxS2cud29mZjInLCAvLyByZW1vdGUgdXJsXHJcbiAqICAgICAgJ2Rpc3QvZm9udHMvUm9ib3RvLVJlZ3VsYXIudHRmJywgLy8gcmVsYXRpdmUgdG8gdGhlIHJvb3Qgb2YgdGhlIHdlYnNpdGVcclxuICogICAgIF0pLFxyXG4gKiAgIF0sXHJcbiAqIH0pO1xyXG4gKiBgYGBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwcmVsb2FkUmVtb3RlRm9udHMoXHJcbiAgdXNlckZvbnRzOiAoc3RyaW5nIHwgVWludDhBcnJheSlbXSxcclxuICBvcHRpb25zPzogTG9hZFJlbW90ZUZvbnRzT3B0aW9ucyxcclxuKTogQmVmb3JlQnVpbGRGbiB7XHJcbiAgY29uc3QgZm9udHMgPSBbLi4udXNlckZvbnRzXTtcclxuICBpZiAoXHJcbiAgICBvcHRpb25zICYmXHJcbiAgICBvcHRpb25zPy5hc3NldHMgIT09IGZhbHNlICYmXHJcbiAgICBvcHRpb25zPy5hc3NldHM/Lmxlbmd0aCAmJlxyXG4gICAgb3B0aW9ucz8uYXNzZXRzPy5sZW5ndGggPiAwXHJcbiAgKSB7XHJcbiAgICBsZXQgYXNzZXRVcmxQcmVmaXggPVxyXG4gICAgICBvcHRpb25zLmFzc2V0VXJsUHJlZml4ID8/XHJcbiAgICAgICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vTXlyaWFkLURyZWFtaW4vdHlwc3QvYXNzZXRzLWZvbnRzJztcclxuICAgIGlmIChhc3NldFVybFByZWZpeFthc3NldFVybFByZWZpeC5sZW5ndGggLSAxXSAhPT0gJy8nKSB7XHJcbiAgICAgIGFzc2V0VXJsUHJlZml4ICs9ICcvJztcclxuICAgIH1cclxuICAgIGNvbnN0IHByZWZpeCA9IChmOiBzdHJpbmdbXSkgPT4gZi5tYXAoZm9udCA9PiBhc3NldFVybFByZWZpeCArIGZvbnQpO1xyXG4gICAgZm9yIChjb25zdCBhc3NldCBvZiBvcHRpb25zLmFzc2V0cykge1xyXG4gICAgICBzd2l0Y2ggKGFzc2V0KSB7XHJcbiAgICAgICAgY2FzZSAndGV4dCc6XHJcbiAgICAgICAgICBmb250cy5wdXNoKC4uLnByZWZpeChfdGV4dEZvbnRzKSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdjamsnOlxyXG4gICAgICAgICAgZm9udHMucHVzaCguLi5wcmVmaXgoX2Nqa0ZvbnRzKSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdlbW9qaSc6XHJcbiAgICAgICAgICBmb250cy5wdXNoKC4uLnByZWZpeChfZW1vamlGb250cykpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbnN0IGxvYWRlciA9IGFzeW5jIChfOiBCZWZvcmVCdWlsZE1hcmssIHsgcmVmLCBidWlsZGVyIH06IEluaXRDb250ZXh0KSA9PiB7XHJcbiAgICBpZiAob3B0aW9ucz8uZmV0Y2hlcikge1xyXG4gICAgICByZWYuc2V0RmV0Y2hlcihvcHRpb25zLmZldGNoZXIpO1xyXG4gICAgfVxyXG4gICAgYXdhaXQgcmVmLmxvYWRGb250cyhidWlsZGVyLCBmb250cyk7XHJcbiAgfTtcclxuICBsb2FkZXIuX3ByZWxvYWRSZW1vdGVGb250T3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgcmV0dXJuIGxvYWRlcjtcclxufVxyXG5cclxuLyoqXHJcbiAqIHByZWxvYWQgc3lzdGVtIGZvbnRzXHJcbiAqIEBwYXJhbSBieUZhbWlseSAtIGZpbHRlciBzeXN0ZW0gZm9udHMgdG8gcHJlbG9hZCBieSBmYW1pbHkgbmFtZVxyXG4gKiBAcmV0dXJucyB7QmVmb3JlQnVpbGRGbn1cclxuICogQGV4YW1wbGVcclxuICogYGBgdHlwZXNjcmlwdFxyXG4gKiBpbXBvcnQgeyBpbml0LCBwcmVsb2FkU3lzdGVtRm9udHMgfSBmcm9tICd0eXBzdCc7XHJcbiAqIGluaXQoe1xyXG4gKiAgIGJlZm9yZUJ1aWxkOiBbXHJcbiAqICAgICBwcmVsb2FkU3lzdGVtRm9udHMoe1xyXG4gKiAgICAgICBieUZhbWlseTogWydSb2JvdG8nXSwgLy8gcHJlbG9hZCBmb250cyBieSBmYW1pbHkgbmFtZVxyXG4gKiAgICAgfSksXHJcbiAqICAgXSxcclxuICogfSk7XHJcbiAqIGBgYFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHByZWxvYWRTeXN0ZW1Gb250cyh7IGJ5RmFtaWx5IH06IHsgYnlGYW1pbHk/OiBzdHJpbmdbXSB9KTogQmVmb3JlQnVpbGRGbiB7XHJcbiAgcmV0dXJuIGFzeW5jIChfLCB7IGJ1aWxkZXIgfTogSW5pdENvbnRleHQpID0+IHtcclxuICAgIGNvbnN0IHQgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuXHJcbiAgICBpZiAoJ3F1ZXJ5TG9jYWxGb250cycgaW4gd2luZG93KSB7XHJcbiAgICAgIGNvbnN0IGZvbnRzOiB7XHJcbiAgICAgICAgZmFtaWx5OiBzdHJpbmc7XHJcbiAgICAgICAgYmxvYigpOiBQcm9taXNlPEJsb2I+O1xyXG4gICAgICB9W10gPSBhd2FpdCAod2luZG93IGFzIGFueSkucXVlcnlMb2NhbEZvbnRzKCk7XHJcblxyXG4gICAgICBieUZhbWlseSA9IGJ5RmFtaWx5ID8/IFtdO1xyXG5cclxuICAgICAgZm9yIChjb25zdCBmb250IG9mIGZvbnRzKSB7XHJcbiAgICAgICAgaWYgKCFieUZhbWlseS5pbmNsdWRlcyhmb250LmZhbWlseSkpIHtcclxuICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZGF0YTogQXJyYXlCdWZmZXIgPSBhd2FpdCAoYXdhaXQgZm9udC5ibG9iKCkpLmFycmF5QnVmZmVyKCk7XHJcbiAgICAgICAgYXdhaXQgYnVpbGRlci5hZGRfcmF3X2ZvbnQobmV3IFVpbnQ4QXJyYXkoZGF0YSkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdDIgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgIGNvbnNvbGUubG9nKCdwcmVsb2FkIHN5c3RlbSBmb250IHRpbWUgdXNlZDonLCB0MiAtIHQpO1xyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiAoY29tcGlsZSBvbmx5KSBzZXQgcGFjb2FnZSByZWdpc3RyeVxyXG4gKlxyXG4gKiBAcGFyYW0gYWNjZXNzTW9kZWw6IHdoZW4gY29tcGlsaW5nLCB0aGUgcGFjb2FnZSByZWdpc3RyeSBpcyB1c2VkIHRvIGFjY2VzcyB0aGVcclxuICogZGF0YSBvZiBmaWxlc1xyXG4gKiBAcmV0dXJucyB7QmVmb3JlQnVpbGRGbn1cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB3aXRoUGFja2FnZVJlZ2lzdHJ5KHBhY2thZ2VSZWdpc3RyeTogUGFja2FnZVJlZ2lzdHJ5KTogQmVmb3JlQnVpbGRGbiB7XHJcbiAgcmV0dXJuIGFzeW5jIChfLCB7IGJ1aWxkZXIgfTogSW5pdENvbnRleHQpID0+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgYnVpbGRlci5zZXRfcGFja2FnZV9yZWdpc3RyeShwYWNrYWdlUmVnaXN0cnksIGZ1bmN0aW9uIChzcGVjOiBQYWNrYWdlU3BlYykge1xyXG4gICAgICAgIHJldHVybiBwYWNrYWdlUmVnaXN0cnkucmVzb2x2ZShzcGVjLCB0aGlzKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJlc29sdmUoKTtcclxuICAgIH0pO1xyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiAoY29tcGlsZSBvbmx5KSBzZXQgYWNjZXNzIG1vZGVsXHJcbiAqXHJcbiAqIEBwYXJhbSBhY2Nlc3NNb2RlbDogd2hlbiBjb21waWxpbmcsIHRoZSBhY2Nlc3MgbW9kZWwgaXMgdXNlZCB0byBhY2Nlc3MgdGhlXHJcbiAqIGRhdGEgb2YgZmlsZXNcclxuICogQHJldHVybnMge0JlZm9yZUJ1aWxkRm59XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gd2l0aEFjY2Vzc01vZGVsKGFjY2Vzc01vZGVsOiBGc0FjY2Vzc01vZGVsKTogQmVmb3JlQnVpbGRGbiB7XHJcbiAgcmV0dXJuIGFzeW5jIChfLCBjdHg6IEluaXRDb250ZXh0KSA9PiB7XHJcbiAgICBpZiAoY3R4LmFscmVhZHlTZXRBY2Nlc3NNb2RlbCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICAgYGFscmVhZHkgc2V0IHNvbWUgYXNzZXNzIG1vZGVsIGJlZm9yZTogJHtjdHguYWxyZWFkeVNldEFjY2Vzc01vZGVsLmNvbnN0cnVjdG9yPy5uYW1lfSgke2N0eC5hbHJlYWR5U2V0QWNjZXNzTW9kZWx9KWAsXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBjdHguYWxyZWFkeVNldEFjY2Vzc01vZGVsID0gYWNjZXNzTW9kZWw7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgIGN0eC5idWlsZGVyLnNldF9hY2Nlc3NfbW9kZWwoXHJcbiAgICAgICAgYWNjZXNzTW9kZWwsXHJcbiAgICAgICAgKHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbGFzdE1vZGlmaWVkID0gYWNjZXNzTW9kZWwuZ2V0TVRpbWUocGF0aCk7XHJcbiAgICAgICAgICBpZiAobGFzdE1vZGlmaWVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsYXN0TW9kaWZpZWQuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAocGF0aDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gYWNjZXNzTW9kZWwuaXNGaWxlKHBhdGgpIHx8IGZhbHNlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgKHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIGFjY2Vzc01vZGVsLmdldFJlYWxQYXRoKHBhdGgpIHx8IHBhdGg7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAocGF0aDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gYWNjZXNzTW9kZWwucmVhZEFsbChwYXRoKTtcclxuICAgICAgICB9LFxyXG4gICAgICApO1xyXG4gICAgICByZXNvbHZlKCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuICogQGludGVybmFsIGJ1aWxkZXJcclxuICovXHJcbnR5cGUgQnVpbGRlciA9IHR5cHN0UmVuZGVyZXIuVHlwc3RSZW5kZXJlckJ1aWxkZXIgJiB0eXBzdENvbXBpbGVyLlR5cHN0Q29tcGlsZXJCdWlsZGVyO1xyXG5cclxuLyoqXHJcbiAqIEBpbnRlcm5hbCBidWlsZCBjb250ZXh0XHJcbiAqL1xyXG5pbnRlcmZhY2UgSW5pdENvbnRleHQge1xyXG4gIHJlZjoge1xyXG4gICAgc2V0RmV0Y2hlcihmZXRjaGVyOiB0eXBlb2YgZmV0Y2gpOiB2b2lkO1xyXG4gICAgbG9hZEZvbnRzKGJ1aWxkZXI6IEJ1aWxkZXIsIGZvbnRzOiAoc3RyaW5nIHwgVWludDhBcnJheSlbXSk6IFByb21pc2U8dm9pZD47XHJcbiAgfTtcclxuICBidWlsZGVyOiBCdWlsZGVyO1xyXG4gIGFscmVhZHlTZXRBY2Nlc3NNb2RlbDogYW55O1xyXG59XHJcblxyXG4vLyB0b2RvOiBzZWFyY2ggYnJvd3NlclxyXG4vLyBzZWFyY2hlci5zZWFyY2hfYnJvd3NlcigpLmF3YWl0PztcclxuIl19