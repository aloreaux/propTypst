/** @internal */
export class PageViewport {
    viewBox;
    scale;
    rotation;
    offsetX;
    offsetY;
    transform;
    width;
    height;
    constructor({ viewBox, scale, rotation, offsetX = 0, offsetY = 0, dontFlip = false, }) {
        this.viewBox = viewBox;
        this.scale = scale;
        this.rotation = rotation;
        this.offsetX = offsetX;
        this.offsetY = offsetY;
        const centerX = (viewBox[2] + viewBox[0]) / 2;
        const centerY = (viewBox[3] + viewBox[1]) / 2;
        let rotateA, rotateB, rotateC, rotateD;
        rotation %= 360;
        if (rotation < 0) {
            rotation += 360;
        }
        switch (rotation) {
            case 180:
                rotateA = -1;
                rotateB = 0;
                rotateC = 0;
                rotateD = 1;
                break;
            case 90:
                rotateA = 0;
                rotateB = 1;
                rotateC = 1;
                rotateD = 0;
                break;
            case 270:
                rotateA = 0;
                rotateB = -1;
                rotateC = -1;
                rotateD = 0;
                break;
            case 0:
                rotateA = 1;
                rotateB = 0;
                rotateC = 0;
                rotateD = -1;
                break;
            default:
                throw new Error('PageViewport: Invalid rotation, must be a multiple of 90 degrees.');
        }
        if (dontFlip) {
            rotateC = -rotateC;
            rotateD = -rotateD;
        }
        let offsetCanvasX, offsetCanvasY;
        let width, height;
        if (rotateA === 0) {
            offsetCanvasX = Math.abs(centerY - viewBox[1]) * scale + offsetX;
            offsetCanvasY = Math.abs(centerX - viewBox[0]) * scale + offsetY;
            width = (viewBox[3] - viewBox[1]) * scale;
            height = (viewBox[2] - viewBox[0]) * scale;
        }
        else {
            offsetCanvasX = Math.abs(centerX - viewBox[0]) * scale + offsetX;
            offsetCanvasY = Math.abs(centerY - viewBox[1]) * scale + offsetY;
            width = (viewBox[2] - viewBox[0]) * scale;
            height = (viewBox[3] - viewBox[1]) * scale;
        }
        this.transform = [
            rotateA * scale,
            rotateB * scale,
            rotateC * scale,
            rotateD * scale,
            offsetCanvasX - rotateA * scale * centerX - rotateC * scale * centerY,
            offsetCanvasY - rotateB * scale * centerX - rotateD * scale * centerY,
        ];
        this.width = width;
        this.height = height;
    }
    get rawDims() {
        const { viewBox } = this;
        return {
            // todo: shadow
            pageWidth: viewBox[2] - viewBox[0],
            pageHeight: viewBox[3] - viewBox[1],
            pageX: viewBox[0],
            pageY: viewBox[1],
        };
    }
    clone({ scale = this.scale, rotation = this.rotation, offsetX = this.offsetX, offsetY = this.offsetY, dontFlip = false, } = {}) {
        return new PageViewport({
            viewBox: this.viewBox.slice(),
            scale,
            rotation,
            offsetX,
            offsetY,
            dontFlip,
        });
    }
    static applyTransform(p, m) {
        const xt = p[0] * m[0] + p[1] * m[2] + m[4];
        const yt = p[0] * m[1] + p[1] * m[3] + m[5];
        return [xt, yt];
    }
    static applyInverseTransform(p, m) {
        const d = m[0] * m[3] - m[1] * m[2];
        const xt = (p[0] * m[3] - p[1] * m[2] + m[2] * m[5] - m[4] * m[3]) / d;
        const yt = (-p[0] * m[1] + p[1] * m[0] + m[4] * m[1] - m[5] * m[0]) / d;
        return [xt, yt];
    }
    convertToViewportPoint(x, y) {
        return PageViewport.applyTransform([x, y], this.transform);
    }
    convertToViewportRectangle(rect) {
        const topLeft = PageViewport.applyTransform([rect[0], rect[1]], this.transform);
        const bottomRight = PageViewport.applyTransform([rect[2], rect[3]], this.transform);
        return [topLeft[0], topLeft[1], bottomRight[0], bottomRight[1]];
    }
    convertToPdfPoint(x, y) {
        return PageViewport.applyInverseTransform([x, y], this.transform);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlld3BvcnQubWpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3JlbmRlci9jYW52YXMvdmlld3BvcnQubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWdDQSxnQkFBZ0I7QUFDaEIsTUFBTSxPQUFPLFlBQVk7SUFDdkIsT0FBTyxDQUFXO0lBQ2xCLEtBQUssQ0FBUztJQUNkLFFBQVEsQ0FBUztJQUNqQixPQUFPLENBQVM7SUFDaEIsT0FBTyxDQUFTO0lBQ2hCLFNBQVMsQ0FBVztJQUNwQixLQUFLLENBQVM7SUFDZCxNQUFNLENBQVM7SUFFZixZQUFZLEVBQ1YsT0FBTyxFQUNQLEtBQUssRUFDTCxRQUFRLEVBQ1IsT0FBTyxHQUFHLENBQUMsRUFDWCxPQUFPLEdBQUcsQ0FBQyxFQUNYLFFBQVEsR0FBRyxLQUFLLEdBQ087UUFDdkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFDekIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsTUFBTSxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzlDLE1BQU0sT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUM5QyxJQUFJLE9BQU8sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQztRQUN2QyxRQUFRLElBQUksR0FBRyxDQUFDO1FBQ2hCLElBQUksUUFBUSxHQUFHLENBQUMsRUFBRTtZQUNoQixRQUFRLElBQUksR0FBRyxDQUFDO1NBQ2pCO1FB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QUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM1QyxPQUFPLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ2xCLENBQUM7SUFDRCxNQUFNLENBQUMscUJBQXFCLENBQUMsQ0FBVyxFQUFFLENBQVc7UUFDbkQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN2RSxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN4RSxPQUFPLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ2xCLENBQUM7SUFDRCxzQkFBc0IsQ0FBQyxDQUFTLEVBQUUsQ0FBUztRQUN6QyxPQUFPLFlBQVksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFDRCwwQkFBMEIsQ0FBQyxJQUFjO1FBQ3ZDLE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxjQUFjLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2hGLE1BQU0sV0FBVyxHQUFHLFlBQVksQ0FBQyxjQUFjLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3BGLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsRSxDQUFDO0lBQ0QsaUJBQWlCLENBQUMsQ0FBUyxFQUFFLENBQVM7UUFDcEMsT0FBTyxZQUFZLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbIi8qKiBAaW50ZXJuYWwgKi9cclxuZXhwb3J0IHR5cGUgUGFnZVZpZXdwb3J0UGFyYW1ldGVycyA9IHtcclxuICAvKipcclxuICAgKiAtIFRoZSB4TWluLCB5TWluLCB4TWF4IGFuZFxyXG4gICAqIHlNYXggY29vcmRpbmF0ZXMuXHJcbiAgICovXHJcbiAgdmlld0JveDogQXJyYXk8bnVtYmVyPjtcclxuICAvKipcclxuICAgKiAtIFRoZSBzY2FsZSBvZiB0aGUgdmlld3BvcnQuXHJcbiAgICovXHJcbiAgc2NhbGU6IG51bWJlcjtcclxuICAvKipcclxuICAgKiAtIFRoZSByb3RhdGlvbiwgaW4gZGVncmVlcywgb2YgdGhlIHZpZXdwb3J0LlxyXG4gICAqL1xyXG4gIHJvdGF0aW9uOiBudW1iZXI7XHJcbiAgLyoqXHJcbiAgICogLSBUaGUgaG9yaXpvbnRhbCwgaS5lLiB4LWF4aXMsIG9mZnNldC4gVGhlXHJcbiAgICogZGVmYXVsdCB2YWx1ZSBpcyBgMGAuXHJcbiAgICovXHJcbiAgb2Zmc2V0WD86IG51bWJlciB8IHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiAtIFRoZSB2ZXJ0aWNhbCwgaS5lLiB5LWF4aXMsIG9mZnNldC4gVGhlXHJcbiAgICogZGVmYXVsdCB2YWx1ZSBpcyBgMGAuXHJcbiAgICovXHJcbiAgb2Zmc2V0WT86IG51bWJlciB8IHVuZGVmaW5lZDtcclxuICAvKipcclxuICAgKiAtIElmIHRydWUsIHRoZSB5LWF4aXMgd2lsbCBub3QgYmUgZmxpcHBlZC5cclxuICAgKiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyBgZmFsc2VgLlxyXG4gICAqL1xyXG4gIGRvbnRGbGlwPzogYm9vbGVhbiB8IHVuZGVmaW5lZDtcclxufTtcclxuXHJcbi8qKiBAaW50ZXJuYWwgKi9cclxuZXhwb3J0IGNsYXNzIFBhZ2VWaWV3cG9ydCB7XHJcbiAgdmlld0JveDogbnVtYmVyW107XHJcbiAgc2NhbGU6IG51bWJlcjtcclxuICByb3RhdGlvbjogbnVtYmVyO1xyXG4gIG9mZnNldFg6IG51bWJlcjtcclxuICBvZmZzZXRZOiBudW1iZXI7XHJcbiAgdHJhbnNmb3JtOiBudW1iZXJbXTtcclxuICB3aWR0aDogbnVtYmVyO1xyXG4gIGhlaWdodDogbnVtYmVyO1xyXG5cclxuICBjb25zdHJ1Y3Rvcih7XHJcbiAgICB2aWV3Qm94LFxyXG4gICAgc2NhbGUsXHJcbiAgICByb3RhdGlvbixcclxuICAgIG9mZnNldFggPSAwLFxyXG4gICAgb2Zmc2V0WSA9IDAsXHJcbiAgICBkb250RmxpcCA9IGZhbHNlLFxyXG4gIH06IFBhZ2VWaWV3cG9ydFBhcmFtZXRlcnMpIHtcclxuICAgIHRoaXMudmlld0JveCA9IHZpZXdCb3g7XHJcbiAgICB0aGlzLnNjYWxlID0gc2NhbGU7XHJcbiAgICB0aGlzLnJvdGF0aW9uID0gcm90YXRpb247XHJcbiAgICB0aGlzLm9mZnNldFggPSBvZmZzZXRYO1xyXG4gICAgdGhpcy5vZmZzZXRZID0gb2Zmc2V0WTtcclxuICAgIGNvbnN0IGNlbnRlclggPSAodmlld0JveFsyXSArIHZpZXdCb3hbMF0pIC8gMjtcclxuICAgIGNvbnN0IGNlbnRlclkgPSAodmlld0JveFszXSArIHZpZXdCb3hbMV0pIC8gMjtcclxuICAgIGxldCByb3RhdGVBLCByb3RhdGVCLCByb3RhdGVDLCByb3RhdGVEO1xyXG4gICAgcm90YXRpb24gJT0gMzYwO1xyXG4gICAgaWYgKHJvdGF0aW9uIDwgMCkge1xyXG4gICAgICByb3RhdGlvbiArPSAzNjA7XHJcbiAgICB9XHJcbiAgICBzd2l0Y2ggKHJvdGF0aW9uKSB7XHJcbiAgICAgIGNhc2UgMTgwOlxyXG4gICAgICAgIHJvdGF0ZUEgPSAtMTtcclxuICAgICAgICByb3RhdGVCID0gMDtcclxuICAgICAgICByb3RhdGVDID0gMDtcclxuICAgICAgICByb3RhdGVEID0gMTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSA5MDpcclxuICAgICAgICByb3RhdGVBID0gMDtcclxuICAgICAgICByb3RhdGVCID0gMTtcclxuICAgICAgICByb3RhdGVDID0gMTtcclxuICAgICAgICByb3RhdGVEID0gMDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAyNzA6XHJcbiAgICAgICAgcm90YXRlQSA9IDA7XHJcbiAgICAgICAgcm90YXRlQiA9IC0xO1xyXG4gICAgICAgIHJvdGF0ZUMgPSAtMTtcclxuICAgICAgICByb3RhdGVEID0gMDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAwOlxyXG4gICAgICAgIHJvdGF0ZUEgPSAxO1xyXG4gICAgICAgIHJvdGF0ZUIgPSAwO1xyXG4gICAgICAgIHJvdGF0ZUMgPSAwO1xyXG4gICAgICAgIHJvdGF0ZUQgPSAtMTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhZ2VWaWV3cG9ydDogSW52YWxpZCByb3RhdGlvbiwgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDkwIGRlZ3JlZXMuJyk7XHJcbiAgICB9XHJcbiAgICBpZiAoZG9udEZsaXApIHtcclxuICAgICAgcm90YXRlQyA9IC1yb3RhdGVDO1xyXG4gICAgICByb3RhdGVEID0gLXJvdGF0ZUQ7XHJcbiAgICB9XHJcbiAgICBsZXQgb2Zmc2V0Q2FudmFzWCwgb2Zmc2V0Q2FudmFzWTtcclxuICAgIGxldCB3aWR0aCwgaGVpZ2h0O1xyXG4gICAgaWYgKHJvdGF0ZUEgPT09IDApIHtcclxuICAgICAgb2Zmc2V0Q2FudmFzWCA9IE1hdGguYWJzKGNlbnRlclkgLSB2aWV3Qm94WzFdKSAqIHNjYWxlICsgb2Zmc2V0WDtcclxuICAgICAgb2Zmc2V0Q2FudmFzWSA9IE1hdGguYWJzKGNlbnRlclggLSB2aWV3Qm94WzBdKSAqIHNjYWxlICsgb2Zmc2V0WTtcclxuICAgICAgd2lkdGggPSAodmlld0JveFszXSAtIHZpZXdCb3hbMV0pICogc2NhbGU7XHJcbiAgICAgIGhlaWdodCA9ICh2aWV3Qm94WzJdIC0gdmlld0JveFswXSkgKiBzY2FsZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG9mZnNldENhbnZhc1ggPSBNYXRoLmFicyhjZW50ZXJYIC0gdmlld0JveFswXSkgKiBzY2FsZSArIG9mZnNldFg7XHJcbiAgICAgIG9mZnNldENhbnZhc1kgPSBNYXRoLmFicyhjZW50ZXJZIC0gdmlld0JveFsxXSkgKiBzY2FsZSArIG9mZnNldFk7XHJcbiAgICAgIHdpZHRoID0gKHZpZXdCb3hbMl0gLSB2aWV3Qm94WzBdKSAqIHNjYWxlO1xyXG4gICAgICBoZWlnaHQgPSAodmlld0JveFszXSAtIHZpZXdCb3hbMV0pICogc2NhbGU7XHJcbiAgICB9XHJcbiAgICB0aGlzLnRyYW5zZm9ybSA9IFtcclxuICAgICAgcm90YXRlQSAqIHNjYWxlLFxyXG4gICAgICByb3RhdGVCICogc2NhbGUsXHJcbiAgICAgIHJvdGF0ZUMgKiBzY2FsZSxcclxuICAgICAgcm90YXRlRCAqIHNjYWxlLFxyXG4gICAgICBvZmZzZXRDYW52YXNYIC0gcm90YXRlQSAqIHNjYWxlICogY2VudGVyWCAtIHJvdGF0ZUMgKiBzY2FsZSAqIGNlbnRlclksXHJcbiAgICAgIG9mZnNldENhbnZhc1kgLSByb3RhdGVCICogc2NhbGUgKiBjZW50ZXJYIC0gcm90YXRlRCAqIHNjYWxlICogY2VudGVyWSxcclxuICAgIF07XHJcbiAgICB0aGlzLndpZHRoID0gd2lkdGg7XHJcbiAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcclxuICB9XHJcbiAgZ2V0IHJhd0RpbXMoKSB7XHJcbiAgICBjb25zdCB7IHZpZXdCb3ggfSA9IHRoaXM7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAvLyB0b2RvOiBzaGFkb3dcclxuICAgICAgcGFnZVdpZHRoOiB2aWV3Qm94WzJdIC0gdmlld0JveFswXSxcclxuICAgICAgcGFnZUhlaWdodDogdmlld0JveFszXSAtIHZpZXdCb3hbMV0sXHJcbiAgICAgIHBhZ2VYOiB2aWV3Qm94WzBdLFxyXG4gICAgICBwYWdlWTogdmlld0JveFsxXSxcclxuICAgIH07XHJcbiAgfVxyXG4gIGNsb25lKHtcclxuICAgIHNjYWxlID0gdGhpcy5zY2FsZSxcclxuICAgIHJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbixcclxuICAgIG9mZnNldFggPSB0aGlzLm9mZnNldFgsXHJcbiAgICBvZmZzZXRZID0gdGhpcy5vZmZzZXRZLFxyXG4gICAgZG9udEZsaXAgPSBmYWxzZSxcclxuICB9ID0ge30pIHtcclxuICAgIHJldHVybiBuZXcgUGFnZVZpZXdwb3J0KHtcclxuICAgICAgdmlld0JveDogdGhpcy52aWV3Qm94LnNsaWNlKCksXHJcbiAgICAgIHNjYWxlLFxyXG4gICAgICByb3RhdGlvbixcclxuICAgICAgb2Zmc2V0WCxcclxuICAgICAgb2Zmc2V0WSxcclxuICAgICAgZG9udEZsaXAsXHJcbiAgICB9KTtcclxuICB9XHJcbiAgc3RhdGljIGFwcGx5VHJhbnNmb3JtKHA6IG51bWJlcltdLCBtOiBudW1iZXJbXSkge1xyXG4gICAgY29uc3QgeHQgPSBwWzBdICogbVswXSArIHBbMV0gKiBtWzJdICsgbVs0XTtcclxuICAgIGNvbnN0IHl0ID0gcFswXSAqIG1bMV0gKyBwWzFdICogbVszXSArIG1bNV07XHJcbiAgICByZXR1cm4gW3h0LCB5dF07XHJcbiAgfVxyXG4gIHN0YXRpYyBhcHBseUludmVyc2VUcmFuc2Zvcm0ocDogbnVtYmVyW10sIG06IG51bWJlcltdKSB7XHJcbiAgICBjb25zdCBkID0gbVswXSAqIG1bM10gLSBtWzFdICogbVsyXTtcclxuICAgIGNvbnN0IHh0ID0gKHBbMF0gKiBtWzNdIC0gcFsxXSAqIG1bMl0gKyBtWzJdICogbVs1XSAtIG1bNF0gKiBtWzNdKSAvIGQ7XHJcbiAgICBjb25zdCB5dCA9ICgtcFswXSAqIG1bMV0gKyBwWzFdICogbVswXSArIG1bNF0gKiBtWzFdIC0gbVs1XSAqIG1bMF0pIC8gZDtcclxuICAgIHJldHVybiBbeHQsIHl0XTtcclxuICB9XHJcbiAgY29udmVydFRvVmlld3BvcnRQb2ludCh4OiBudW1iZXIsIHk6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIFBhZ2VWaWV3cG9ydC5hcHBseVRyYW5zZm9ybShbeCwgeV0sIHRoaXMudHJhbnNmb3JtKTtcclxuICB9XHJcbiAgY29udmVydFRvVmlld3BvcnRSZWN0YW5nbGUocmVjdDogbnVtYmVyW10pIHtcclxuICAgIGNvbnN0IHRvcExlZnQgPSBQYWdlVmlld3BvcnQuYXBwbHlUcmFuc2Zvcm0oW3JlY3RbMF0sIHJlY3RbMV1dLCB0aGlzLnRyYW5zZm9ybSk7XHJcbiAgICBjb25zdCBib3R0b21SaWdodCA9IFBhZ2VWaWV3cG9ydC5hcHBseVRyYW5zZm9ybShbcmVjdFsyXSwgcmVjdFszXV0sIHRoaXMudHJhbnNmb3JtKTtcclxuICAgIHJldHVybiBbdG9wTGVmdFswXSwgdG9wTGVmdFsxXSwgYm90dG9tUmlnaHRbMF0sIGJvdHRvbVJpZ2h0WzFdXTtcclxuICB9XHJcbiAgY29udmVydFRvUGRmUG9pbnQoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcclxuICAgIHJldHVybiBQYWdlVmlld3BvcnQuYXBwbHlJbnZlcnNlVHJhbnNmb3JtKFt4LCB5XSwgdGhpcy50cmFuc2Zvcm0pO1xyXG4gIH1cclxufVxyXG4iXX0=