let globalRenderer = undefined;
let globalRendererInitReady;
let isReady = false;
export function getGlobalRenderer() {
    return isReady ? globalRenderer : undefined;
}
export function createGlobalRenderer(creator, initOptions) {
    // todo: determine renderer thread-safety
    // todo: check inconsistent initOptions
    const renderer = globalRenderer || creator();
    if (globalRendererInitReady !== undefined) {
        return globalRendererInitReady;
    }
    return (globalRendererInitReady = (async () => {
        isReady = true;
        await renderer.init(initOptions);
        return (globalRenderer = renderer);
    })());
}
export function withGlobalRenderer(creator, initOptions, resolve, reject) {
    const renderer = getGlobalRenderer();
    if (renderer) {
        resolve(renderer);
        return;
    }
    createGlobalRenderer(creator, initOptions).then(resolve).catch(reject);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xvYmFsLXJlbmRlcmVyLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cmliL2dsb2JhbC1yZW5kZXJlci5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsSUFBSSxjQUFjLEdBQThCLFNBQVMsQ0FBQztBQUMxRCxJQUFJLHVCQUErQyxDQUFDO0FBQ3BELElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQztBQUVwQixNQUFNLFVBQVUsaUJBQWlCO0lBQy9CLE9BQU8sT0FBTyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztBQUM5QyxDQUFDO0FBRUQsTUFBTSxVQUFVLG9CQUFvQixDQUNsQyxPQUE0QixFQUM1QixXQUFrQztJQUVsQyx5Q0FBeUM7SUFDekMsdUNBQXVDO0lBQ3ZDLE1BQU0sUUFBUSxHQUFHLGNBQWMsSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUU3QyxJQUFJLHVCQUF1QixLQUFLLFNBQVMsRUFBRTtRQUN6QyxPQUFPLHVCQUF1QixDQUFDO0tBQ2hDO0lBRUQsT0FBTyxDQUFDLHVCQUF1QixHQUFHLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDNUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUNmLE1BQU0sUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNqQyxPQUFPLENBQUMsY0FBYyxHQUFHLFFBQVEsQ0FBQyxDQUFDO0lBQ3JDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUNSLENBQUM7QUFFRCxNQUFNLFVBQVUsa0JBQWtCLENBQ2hDLE9BQTRCLEVBQzVCLFdBQTZDLEVBQzdDLE9BQTBDLEVBQzFDLE1BQTJCO0lBRTNCLE1BQU0sUUFBUSxHQUFHLGlCQUFpQixFQUFFLENBQUM7SUFDckMsSUFBSSxRQUFRLEVBQUU7UUFDWixPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEIsT0FBTztLQUNSO0lBRUQsb0JBQW9CLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDekUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgSW5pdE9wdGlvbnMgfSBmcm9tICcuLi9vcHRpb25zLmluaXQubWpzJztcclxuaW1wb3J0IHR5cGUgeyBUeXBzdFJlbmRlcmVyIH0gZnJvbSAnLi4vcmVuZGVyZXIubWpzJztcclxuXHJcbmxldCBnbG9iYWxSZW5kZXJlcjogVHlwc3RSZW5kZXJlciB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcclxubGV0IGdsb2JhbFJlbmRlcmVySW5pdFJlYWR5OiBQcm9taXNlPFR5cHN0UmVuZGVyZXI+O1xyXG5sZXQgaXNSZWFkeSA9IGZhbHNlO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEdsb2JhbFJlbmRlcmVyKCk6IFR5cHN0UmVuZGVyZXIgfCB1bmRlZmluZWQge1xyXG4gIHJldHVybiBpc1JlYWR5ID8gZ2xvYmFsUmVuZGVyZXIgOiB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVHbG9iYWxSZW5kZXJlcihcclxuICBjcmVhdG9yOiAoKSA9PiBUeXBzdFJlbmRlcmVyLFxyXG4gIGluaXRPcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4sXHJcbik6IFByb21pc2U8VHlwc3RSZW5kZXJlcj4ge1xyXG4gIC8vIHRvZG86IGRldGVybWluZSByZW5kZXJlciB0aHJlYWQtc2FmZXR5XHJcbiAgLy8gdG9kbzogY2hlY2sgaW5jb25zaXN0ZW50IGluaXRPcHRpb25zXHJcbiAgY29uc3QgcmVuZGVyZXIgPSBnbG9iYWxSZW5kZXJlciB8fCBjcmVhdG9yKCk7XHJcblxyXG4gIGlmIChnbG9iYWxSZW5kZXJlckluaXRSZWFkeSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICByZXR1cm4gZ2xvYmFsUmVuZGVyZXJJbml0UmVhZHk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gKGdsb2JhbFJlbmRlcmVySW5pdFJlYWR5ID0gKGFzeW5jICgpID0+IHtcclxuICAgIGlzUmVhZHkgPSB0cnVlO1xyXG4gICAgYXdhaXQgcmVuZGVyZXIuaW5pdChpbml0T3B0aW9ucyk7XHJcbiAgICByZXR1cm4gKGdsb2JhbFJlbmRlcmVyID0gcmVuZGVyZXIpO1xyXG4gIH0pKCkpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gd2l0aEdsb2JhbFJlbmRlcmVyKFxyXG4gIGNyZWF0b3I6ICgpID0+IFR5cHN0UmVuZGVyZXIsXHJcbiAgaW5pdE9wdGlvbnM6IFBhcnRpYWw8SW5pdE9wdGlvbnM+IHwgdW5kZWZpbmVkLFxyXG4gIHJlc29sdmU6IChyZW5kZXJlcjogVHlwc3RSZW5kZXJlcikgPT4gdm9pZCxcclxuICByZWplY3Q/OiAoZXJyOiBhbnkpID0+IHZvaWQsXHJcbikge1xyXG4gIGNvbnN0IHJlbmRlcmVyID0gZ2V0R2xvYmFsUmVuZGVyZXIoKTtcclxuICBpZiAocmVuZGVyZXIpIHtcclxuICAgIHJlc29sdmUocmVuZGVyZXIpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlR2xvYmFsUmVuZGVyZXIoY3JlYXRvciwgaW5pdE9wdGlvbnMpLnRoZW4ocmVzb2x2ZSkuY2F0Y2gocmVqZWN0KTtcclxufVxyXG4iXX0=