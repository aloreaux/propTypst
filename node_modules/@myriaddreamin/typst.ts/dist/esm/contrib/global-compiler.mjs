let globalCompiler = undefined;
let globalCompilerInitReady;
let isReady = false;
export function getGlobalCompiler() {
    return isReady ? globalCompiler : undefined;
}
export function createGlobalCompiler(creator, initOptions) {
    // todo: determine compiler thread-safety
    // todo: check inconsistent initOptions
    const compiler = globalCompiler || creator();
    if (globalCompilerInitReady !== undefined) {
        return globalCompilerInitReady;
    }
    return (globalCompilerInitReady = (async () => {
        isReady = true;
        await compiler.init(initOptions);
        return (globalCompiler = compiler);
    })());
}
export function withGlobalCompiler(creator, initOptions, resolve, reject) {
    const compiler = getGlobalCompiler();
    if (compiler) {
        resolve(compiler);
        return;
    }
    createGlobalCompiler(creator, initOptions).then(resolve).catch(reject);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xvYmFsLWNvbXBpbGVyLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cmliL2dsb2JhbC1jb21waWxlci5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsSUFBSSxjQUFjLEdBQThCLFNBQVMsQ0FBQztBQUMxRCxJQUFJLHVCQUErQyxDQUFDO0FBQ3BELElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQztBQUVwQixNQUFNLFVBQVUsaUJBQWlCO0lBQy9CLE9BQU8sT0FBTyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztBQUM5QyxDQUFDO0FBRUQsTUFBTSxVQUFVLG9CQUFvQixDQUNsQyxPQUE0QixFQUM1QixXQUFrQztJQUVsQyx5Q0FBeUM7SUFDekMsdUNBQXVDO0lBQ3ZDLE1BQU0sUUFBUSxHQUFHLGNBQWMsSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUU3QyxJQUFJLHVCQUF1QixLQUFLLFNBQVMsRUFBRTtRQUN6QyxPQUFPLHVCQUF1QixDQUFDO0tBQ2hDO0lBRUQsT0FBTyxDQUFDLHVCQUF1QixHQUFHLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDNUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUNmLE1BQU0sUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNqQyxPQUFPLENBQUMsY0FBYyxHQUFHLFFBQVEsQ0FBQyxDQUFDO0lBQ3JDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUNSLENBQUM7QUFFRCxNQUFNLFVBQVUsa0JBQWtCLENBQ2hDLE9BQTRCLEVBQzVCLFdBQTZDLEVBQzdDLE9BQTBDLEVBQzFDLE1BQTJCO0lBRTNCLE1BQU0sUUFBUSxHQUFHLGlCQUFpQixFQUFFLENBQUM7SUFDckMsSUFBSSxRQUFRLEVBQUU7UUFDWixPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEIsT0FBTztLQUNSO0lBRUQsb0JBQW9CLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDekUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgSW5pdE9wdGlvbnMgfSBmcm9tICcuLi9vcHRpb25zLmluaXQubWpzJztcclxuaW1wb3J0IHR5cGUgeyBUeXBzdENvbXBpbGVyIH0gZnJvbSAnLi4vY29tcGlsZXIubWpzJztcclxuXHJcbmxldCBnbG9iYWxDb21waWxlcjogVHlwc3RDb21waWxlciB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcclxubGV0IGdsb2JhbENvbXBpbGVySW5pdFJlYWR5OiBQcm9taXNlPFR5cHN0Q29tcGlsZXI+O1xyXG5sZXQgaXNSZWFkeSA9IGZhbHNlO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEdsb2JhbENvbXBpbGVyKCk6IFR5cHN0Q29tcGlsZXIgfCB1bmRlZmluZWQge1xyXG4gIHJldHVybiBpc1JlYWR5ID8gZ2xvYmFsQ29tcGlsZXIgOiB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVHbG9iYWxDb21waWxlcihcclxuICBjcmVhdG9yOiAoKSA9PiBUeXBzdENvbXBpbGVyLFxyXG4gIGluaXRPcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4sXHJcbik6IFByb21pc2U8VHlwc3RDb21waWxlcj4ge1xyXG4gIC8vIHRvZG86IGRldGVybWluZSBjb21waWxlciB0aHJlYWQtc2FmZXR5XHJcbiAgLy8gdG9kbzogY2hlY2sgaW5jb25zaXN0ZW50IGluaXRPcHRpb25zXHJcbiAgY29uc3QgY29tcGlsZXIgPSBnbG9iYWxDb21waWxlciB8fCBjcmVhdG9yKCk7XHJcblxyXG4gIGlmIChnbG9iYWxDb21waWxlckluaXRSZWFkeSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICByZXR1cm4gZ2xvYmFsQ29tcGlsZXJJbml0UmVhZHk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gKGdsb2JhbENvbXBpbGVySW5pdFJlYWR5ID0gKGFzeW5jICgpID0+IHtcclxuICAgIGlzUmVhZHkgPSB0cnVlO1xyXG4gICAgYXdhaXQgY29tcGlsZXIuaW5pdChpbml0T3B0aW9ucyk7XHJcbiAgICByZXR1cm4gKGdsb2JhbENvbXBpbGVyID0gY29tcGlsZXIpO1xyXG4gIH0pKCkpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gd2l0aEdsb2JhbENvbXBpbGVyKFxyXG4gIGNyZWF0b3I6ICgpID0+IFR5cHN0Q29tcGlsZXIsXHJcbiAgaW5pdE9wdGlvbnM6IFBhcnRpYWw8SW5pdE9wdGlvbnM+IHwgdW5kZWZpbmVkLFxyXG4gIHJlc29sdmU6IChjb21waWxlcjogVHlwc3RDb21waWxlcikgPT4gdm9pZCxcclxuICByZWplY3Q/OiAoZXJyOiBhbnkpID0+IHZvaWQsXHJcbikge1xyXG4gIGNvbnN0IGNvbXBpbGVyID0gZ2V0R2xvYmFsQ29tcGlsZXIoKTtcclxuICBpZiAoY29tcGlsZXIpIHtcclxuICAgIHJlc29sdmUoY29tcGlsZXIpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlR2xvYmFsQ29tcGlsZXIoY3JlYXRvciwgaW5pdE9wdGlvbnMpLnRoZW4ocmVzb2x2ZSkuY2F0Y2gocmVqZWN0KTtcclxufVxyXG4iXX0=