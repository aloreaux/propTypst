import { TypstDefaultParams, kObject } from './internal.types.mjs';
import { RenderView } from './render/canvas/view.mjs';
import { LazyWasmModule } from './wasm.mjs';
import { buildComponent } from './init.mjs';
import { TypstDomDocument } from './dom.mjs';
/**
 * The session of a Typst document.
 * @property {string} backgroundColor - The background color of the Typst
 * document.
 * @property {number} pixelPerPt - The pixel per point scale up the image.
 *
 */
export class RenderSession {
    plugin;
    /**
     * @internal
     */
    [kObject];
    /**
     * @internal
     */
    constructor(
    /**
     * @internal
     */
    plugin, o) {
        this.plugin = plugin;
        this[kObject] = o;
    }
    /**
     * @deprecated set in {@link RenderToCanvasOptions} instead
     *
     * Set the background color of the Typst document.
     * @param {string} t - The background color in format of `^#?[0-9a-f]{6}$`
     *
     * Note: Default to `#ffffff`.
     *
     * Note: Only available in canvas rendering mode.
     */
    set backgroundColor(t) {
        if (t !== undefined) {
            this[kObject].background_color = t;
        }
    }
    /**
     * Get the background color of the Typst document.
     *
     * Note: Default to `#ffffff`.
     *
     * Note: Only available in canvas rendering mode.
     */
    get backgroundColor() {
        return this[kObject].background_color;
    }
    /**
     * Set the pixel per point scale up the canvas panel.
     *
     * Note: Default to `3`.
     *
     * Note: Only available in canvas rendering mode.
     */
    set pixelPerPt(t) {
        if (t !== undefined) {
            this[kObject].pixel_per_pt = t;
        }
    }
    /**
     * @deprecated set in {@link RenderToCanvasOptions} instead
     *
     * Get the pixel per point scale up the canvas panel.
     *
     * Note: Default to `3`.
     *
     * Note: Only available in canvas rendering mode.
     */
    get pixelPerPt() {
        return this[kObject].pixel_per_pt;
    }
    /**
     * Reset state
     */
    reset() {
        this.plugin.resetSession(this);
    }
    /**
     * @deprecated
     * use {@link docWidth} instead
     */
    get doc_width() {
        return this[kObject].doc_width;
    }
    get docWidth() {
        return this[kObject].doc_width;
    }
    /**
     * @deprecated
     * use {@link docHeight} instead
     */
    get doc_height() {
        return this[kObject].doc_height;
    }
    get docHeight() {
        return this[kObject].doc_height;
    }
    retrievePagesInfo() {
        const pages_info = this[kObject].pages_info;
        const pageInfos = [];
        const pageCount = pages_info.page_count;
        for (let i = 0; i < pageCount; i++) {
            const pageAst = pages_info.page(i);
            pageInfos.push({
                pageOffset: pageAst.page_off,
                width: pageAst.width_pt,
                height: pageAst.height_pt,
            });
        }
        return pageInfos;
    }
    getSourceLoc(path) {
        return this[kObject].source_span(path);
    }
    /**
     * See {@link TypstRenderer#renderSvg} for more details.
     */
    renderSvg(options) {
        return this.plugin.renderSvg({
            renderSession: this,
            ...options,
        });
    }
    /**
     * See {@link TypstRenderer#renderToSvg} for more details.
     */
    renderToSvg(options) {
        return this.plugin.renderToSvg({
            renderSession: this,
            ...options,
        });
    }
    /**
     * See {@link TypstRenderer#renderCanvas} for more details.
     */
    renderCanvas(options) {
        return this.plugin.renderCanvas({
            renderSession: this,
            ...options,
        });
    }
    /**
     * See {@link TypstRenderer#manipulateData} for more details.
     */
    manipulateData(opts) {
        this.plugin.manipulateData({
            renderSession: this,
            ...opts,
        });
    }
    /**
     * See {@link TypstRenderer#renderSvgDiff} for more details.
     */
    renderSvgDiff(opts) {
        return this.plugin.renderSvgDiff({
            renderSession: this,
            ...opts,
        });
    }
    /**
     * @deprecated
     * use {@link getSourceLoc} instead
     */
    get_source_loc(path) {
        return this[kObject].source_span(path);
    }
    /**
     * @deprecated
     * use {@link renderSvgDiff} instead
     */
    render_in_window(rect_lo_x, rect_lo_y, rect_hi_x, rect_hi_y) {
        return this[kObject].render_in_window(rect_lo_x, rect_lo_y, rect_hi_x, rect_hi_y);
    }
    /**
     * @deprecated
     * use {@link manipulateData} instead
     */
    merge_delta(data) {
        this.plugin.manipulateData({
            renderSession: this,
            action: 'merge',
            data,
        });
    }
}
/**
 * @internal
 */
var ManageStatus;
(function (ManageStatus) {
    ManageStatus[ManageStatus["Delete"] = 0] = "Delete";
    ManageStatus[ManageStatus["New"] = 1] = "New";
    ManageStatus[ManageStatus["Update"] = 2] = "Update";
})(ManageStatus || (ManageStatus = {}));
export class TypstWorker {
    plugin;
    /**
     * @internal
     */
    [kObject];
    /**
     * @internal
     */
    constructor(
    /**
     * @internal
     */
    plugin, o) {
        this.plugin = plugin;
        this[kObject] = o;
    }
    /**
     * See {@link TypstRenderer#manipulateData} for more details.
     */
    manipulateData(action, data) {
        return this[kObject].manipulate_data(action, data);
    }
    /**
     * @internal
     */
    managedCanvasElemList = new Map();
    /**
     * @internal
     */
    canvasCounter = Math.random();
    /**
     * You must submit all canvas in pages to ensure synchronization with the background worker
     *
     * See {@link TypstRenderer#renderCanvas} for more details.
     */
    renderCanvas(canvasElemList) {
        const m = this.managedCanvasElemList;
        for (const [_, elem] of m) {
            elem[0] = ManageStatus.Delete;
        }
        for (const elem of canvasElemList) {
            const canvas = elem.canvas;
            let elemId = canvas.dataset.manageId;
            let action = ManageStatus.Update;
            if (!elemId) {
                elemId = this.canvasCounter.toFixed(5);
                this.canvasCounter += 1;
                canvas.dataset.manageId = elemId;
                action = ManageStatus.New;
            }
            let prev = m.get(elemId);
            if (prev && prev[0] !== ManageStatus.Delete) {
                throw new Error('cannot update a canvas for two times in batch');
            }
            m.set(elemId, [action, { ...elem }]);
        }
        const entries = Array.from(m.entries());
        const actions = new Uint8Array(entries.length);
        const elements = new Array(entries.length);
        const options = entries.map(([key, [action, elem]], index) => {
            if (!action) {
                m.delete(key);
            }
            actions[index] = action;
            elements[index] = elem.canvas;
            return this.plugin.canvasOptionsToRust(elem);
        });
        return this[kObject].render_canvas(actions, elements, options);
    }
    async retrievePagesInfo() {
        const pages_info = await this[kObject].get_pages_info();
        console.log(pages_info);
        const pageInfos = [];
        const pageCount = pages_info.page_count;
        for (let i = 0; i < pageCount; i++) {
            const pageAst = pages_info.page(i);
            pageInfos.push({
                pageOffset: pageAst.page_off,
                width: pageAst.width_pt,
                height: pageAst.height_pt,
            });
        }
        return pageInfos;
    }
}
const gRendererModule = (module) => new LazyWasmModule(async (bin) => {
    return await module.default(bin);
});
/**
 * create a Typst renderer.
 * @returns {TypstRenderer} - The Typst renderer.
 * @example
 * ```typescript
 * import { createTypstRenderer } from 'typst';
 * const renderer = createTypstRenderer();
 * await renderer.init();
 * await renderer.render({
 *   container: document.getElementById('container'),
 *   artifactContent: '{ ... }',
 * });
 * ```
 */
export function createTypstRenderer() {
    return new TypstRendererDriver();
}
/**
 * @deprecated
 * use {@link createTypstRenderer} instead
 */
export function createTypstSvgRenderer() {
    return new TypstRendererDriver();
}
export async function rendererBuildInfo() {
    const renderModule = await import('@myriaddreamin/typst-ts-renderer/pkg/wasm-pack-shim.mjs');
    return renderModule.renderer_build_info();
}
let warnOnceCanvasSet = true;
/** @internal */
export class TypstRendererDriver {
    renderer;
    rendererJs;
    constructor() { }
    async init(options) {
        this.rendererJs = await (options?.getWrapper?.() ||
            import('@myriaddreamin/typst-ts-renderer/pkg/wasm-pack-shim.mjs'));
        const TypstRendererBuilder = this.rendererJs.TypstRendererBuilder;
        this.renderer = await buildComponent(options, gRendererModule(this.rendererJs), TypstRendererBuilder, {});
    }
    loadGlyphPack(_pack) {
        // this.renderer.load_glyph_pack(pack);
        return Promise.resolve();
    }
    createOptionsToRust(options) {
        const rustOptions = new this.rendererJs.CreateSessionOptions();
        if (options.format !== undefined) {
            rustOptions.format = options.format;
        }
        if (options.artifactContent !== undefined) {
            rustOptions.artifact_content = options.artifactContent;
        }
        return rustOptions;
    }
    canvasOptionsToRust(options) {
        const rustOptions = new this.rendererJs.RenderPageImageOptions();
        if (options.pageOffset === undefined) {
            throw new Error('pageOffset is required in reflexo v0.5.0');
        }
        else {
            rustOptions.page_off = options.pageOffset;
        }
        if (options.cacheKey !== undefined) {
            rustOptions.cache_key = options.cacheKey;
        }
        if (options.backgroundColor !== undefined) {
            rustOptions.background_color = options.backgroundColor;
        }
        if (options.pixelPerPt !== undefined) {
            rustOptions.pixel_per_pt = options.pixelPerPt;
        }
        if (options.dataSelection !== undefined) {
            let encoded = 0;
            if (options.dataSelection.body) {
                encoded |= 1 << 0;
            }
            else if (options.canvas && warnOnceCanvasSet) {
                warnOnceCanvasSet = false;
                console.warn('dataSelection.body is not set but providing canvas for body');
            }
            if (options.dataSelection.text || options.dataSelection.annotation) {
                console.error('dataSelection.text and dataSelection.annotation are deprecated');
            }
            if (options.dataSelection.semantics) {
                encoded |= 1 << 3;
            }
            rustOptions.data_selection = encoded;
        }
        return rustOptions;
    }
    retrievePagesInfoFromSession(session) {
        return session.retrievePagesInfo();
    }
    /**
     * Render a Typst document to canvas.
     */
    renderCanvas(options) {
        return this.withinOptionSession(options, async (sessionRef) => {
            return this.renderer.render_page_to_canvas(sessionRef[kObject], options.canvas || undefined, this.canvasOptionsToRust(options));
        });
    }
    // async renderPdf(artifactContent: string): Promise<Uint8Array> {
    // return this.renderer.render_to_pdf(artifactContent);
    // }
    async inAnimationFrame(fn) {
        return new Promise((resolve, reject) => {
            requestAnimationFrame(() => {
                try {
                    resolve(fn());
                }
                catch (e) {
                    reject(e);
                }
            });
        });
    }
    async renderDisplayLayer(session, canvasList, options) {
        const pages_info = session[kObject].pages_info;
        const page_count = pages_info.page_count;
        const doRender = async (i, page_off) => {
            const canvas = canvasList[i];
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                throw new Error('canvas context is null');
            }
            return await this.renderCanvas({
                ...options,
                canvas: ctx,
                renderSession: session,
                pageOffset: page_off,
            });
        };
        const t = performance.now();
        const textContentList = await (async () => {
            const results = [];
            for (let i = 0; i < page_count; i++) {
                results.push(await this.inAnimationFrame(() => doRender(i, i)));
            }
            return results;
        })();
        const t2 = performance.now();
        console.log(`display layer used: render = ${(t2 - t).toFixed(1)}ms`);
        return textContentList;
    }
    renderTextLayer(layerList, textSourceList) {
        const t2 = performance.now();
        layerList.forEach((layer, i) => {
            layer.innerHTML = textSourceList[i].htmlSemantics[0];
        });
        const t3 = performance.now();
        console.log(`text layer used: render = ${(t3 - t2).toFixed(1)}ms`);
    }
    async render(options) {
        if ('format' in options) {
            if (options.format !== 'vector') {
                const artifactFormats = ['serde_json', 'js', 'ir'];
                if (artifactFormats.includes(options.format)) {
                    // deprecated
                    throw new Error(`deprecated format ${options.format}, please use vector format`);
                }
            }
        }
        return this.renderToCanvas(options);
    }
    async renderDom(options) {
        if ('format' in options) {
            if (options.format !== 'vector') {
                const artifactFormats = ['serde_json', 'js', 'ir'];
                if (artifactFormats.includes(options.format)) {
                    // deprecated
                    throw new Error(`deprecated format ${options.format}, please use vector format`);
                }
            }
        }
        return this.withinOptionSession(options, async (sessionRef) => {
            const t = new TypstDomDocument({
                ...options,
                renderMode: 'dom',
                hookedElem: options.container,
                kModule: sessionRef,
                renderer: this,
            });
            t;
            await t.impl.mountDom(options.pixelPerPt);
            return t;
        });
    }
    async renderToCanvas(options) {
        let session;
        let renderPageResults;
        const mountContainer = options.container;
        mountContainer.style.visibility = 'hidden';
        const doRenderDisplayLayer = async (canvasList, resetLayout) => {
            try {
                renderPageResults = await this.renderDisplayLayer(session, canvasList, options);
                resetLayout();
            }
            finally {
                mountContainer.style.visibility = 'visible';
            }
        };
        return this.withinOptionSession(options, async (sessionRef) => {
            session = sessionRef;
            if (session[kObject].pages_info.page_count === 0) {
                throw new Error(`No page found in session`);
            }
            if (options.pixelPerPt !== undefined && options.pixelPerPt <= 0) {
                throw new Error('Invalid typst.RenderOptions.pixelPerPt, should be a positive number ' +
                    options.pixelPerPt);
            }
            let backgroundColor = options.backgroundColor;
            if (backgroundColor !== undefined) {
                if (!/^#[0-9a-f]{6}$/.test(backgroundColor)) {
                    throw new Error('Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ ' + backgroundColor);
                }
            }
            session.pixelPerPt = options.pixelPerPt ?? TypstDefaultParams.PIXEL_PER_PT;
            session.backgroundColor = backgroundColor ?? '#ffffff';
            const t = performance.now();
            const pageView = new RenderView(this.retrievePagesInfoFromSession(session), mountContainer, options);
            const t2 = performance.now();
            console.log(`layer used: retieve = ${(t2 - t).toFixed(1)}ms`);
            await doRenderDisplayLayer(pageView.canvasList, () => pageView.resetLayout());
            this.renderTextLayer(pageView.textLayerList, renderPageResults);
            return;
        });
    }
    createModule(b) {
        return Promise.resolve(new RenderSession(this, this.renderer.create_session(b &&
            this.createOptionsToRust({
                format: 'vector',
                artifactContent: b,
            }))));
    }
    async createWorkerV0(worker) {
        return new TypstWorker(this, await this.renderer.create_worker(worker));
    }
    workerBridge() {
        return this.renderer.create_worker_bridge();
    }
    renderSvg(options, container) {
        if (options instanceof RenderSession || container) {
            throw new Error('removed api, please use renderToSvg({ renderSession, container }) instead');
        }
        return this.withinOptionSession(options, async (sessionRef) => {
            let parts = undefined;
            if (options.data_selection) {
                parts = 0;
                if (options.data_selection.body) {
                    parts |= 1 << 0;
                }
                if (options.data_selection.defs) {
                    parts |= 1 << 1;
                }
                if (options.data_selection.css) {
                    parts |= 1 << 2;
                }
                if (options.data_selection.js) {
                    parts |= 1 << 3;
                }
            }
            return Promise.resolve(this.renderer.svg_data(sessionRef[kObject], parts));
        });
    }
    renderSvgDiff(options) {
        if (!options.window) {
            return this.renderer.render_svg_diff(options.renderSession[kObject], 0, 0, 1e33, 1e33);
        }
        return this.renderer.render_svg_diff(options.renderSession[kObject], options.window.lo.x, options.window.lo.y, options.window.hi.x, options.window.hi.y);
    }
    renderToSvg(options) {
        return this.withinOptionSession(options, async (sessionRef) => {
            return Promise.resolve(this.renderer.render_svg(sessionRef[kObject], options.container));
        });
    }
    getCustomV1(options) {
        return Promise.resolve(this.renderer.get_customs(options.renderSession[kObject]));
    }
    resetSession(session) {
        return this.renderer.reset(session[kObject]);
    }
    manipulateData(opts) {
        return this.renderer.manipulate_data(opts.renderSession[kObject], opts.action ?? 'reset', opts.data);
    }
    withinOptionSession(options, fn) {
        function isRenderByContentOption(options) {
            return 'artifactContent' in options;
        }
        if ('renderSession' in options) {
            return fn(options.renderSession);
        }
        if (isRenderByContentOption(options)) {
            // todo: remove any
            return this.runWithSession(options, fn);
        }
        throw new Error('Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions');
    }
    async runWithSession(arg1, arg2) {
        let options = arg1;
        let fn = arg2;
        if (!arg2) {
            options = undefined;
            fn = arg1;
        }
        const session = this.renderer.create_session(
        /* moved */ options && this.createOptionsToRust(options));
        try {
            const res = await fn(new RenderSession(this, session));
            session.free();
            return res;
        }
        catch (e) {
            session.free();
            throw e;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyZXIubWpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3JlbmRlcmVyLm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFJQSxPQUFPLEVBQWdDLGtCQUFrQixFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBYWpHLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDNUMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBZTdDOzs7Ozs7R0FNRztBQUNILE1BQU0sT0FBTyxhQUFhO0lBYWQ7SUFaVjs7T0FFRztJQUNJLENBQUMsT0FBTyxDQUFDLENBQXNCO0lBRXRDOztPQUVHO0lBQ0g7SUFDRTs7T0FFRztJQUNLLE1BQXFCLEVBQzdCLENBQXNCO1FBRGQsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUc3QixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7SUFFRDs7Ozs7Ozs7O09BU0c7SUFDSCxJQUFJLGVBQWUsQ0FBQyxDQUFxQjtRQUN2QyxJQUFJLENBQUMsS0FBSyxTQUFTLEVBQUU7WUFDbkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGdCQUFnQixHQUFHLENBQUMsQ0FBQztTQUNwQztJQUNILENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSCxJQUFJLGVBQWU7UUFDakIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsZ0JBQWdCLENBQUM7SUFDeEMsQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNILElBQUksVUFBVSxDQUFDLENBQXFCO1FBQ2xDLElBQUksQ0FBQyxLQUFLLFNBQVMsRUFBRTtZQUNuQixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztTQUNo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UUFDOUQsSUFBSSxFQUFFLEdBQTJDLElBQUksQ0FBQztRQUV0RCxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1QsT0FBTyxHQUFHLFNBQVMsQ0FBQztZQUNwQixFQUFFLEdBQUcsSUFBSSxDQUFDO1NBQ1g7UUFFRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWM7UUFDMUMsV0FBVyxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLENBQ3pELENBQUM7UUFDRixJQUFJO1lBQ0YsTUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFFLENBQUMsSUFBSSxhQUFhLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDdkQsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2YsT0FBTyxHQUFHLENBQUM7U0FDWjtRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2YsTUFBTSxDQUFDLENBQUM7U0FDVDtJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbIi8vIEB0cy1pZ25vcmVcclxuaW1wb3J0IHR5cGUgKiBhcyB0eXBzdCBmcm9tICdAbXlyaWFkZHJlYW1pbi90eXBzdC10cy1yZW5kZXJlci9wa2cvd2FzbS1wYWNrLXNoaW0ubWpzJztcclxuXHJcbmltcG9ydCB0eXBlIHsgSW5pdE9wdGlvbnMgfSBmcm9tICcuL29wdGlvbnMuaW5pdC5tanMnO1xyXG5pbXBvcnQgeyBQYWdlSW5mbywgUmVuZGVyQ2FudmFzUmVzdWx0LCBUeXBzdERlZmF1bHRQYXJhbXMsIGtPYmplY3QgfSBmcm9tICcuL2ludGVybmFsLnR5cGVzLm1qcyc7XHJcbmltcG9ydCB7XHJcbiAgQ3JlYXRlU2Vzc2lvbk9wdGlvbnMsXHJcbiAgUmVuZGVyVG9DYW52YXNPcHRpb25zLFxyXG4gIFJlbmRlck9wdGlvbnMsXHJcbiAgUmVuZGVyQ2FudmFzT3B0aW9ucyxcclxuICBSZW5kZXJUb1N2Z09wdGlvbnMsXHJcbiAgTWFuaXB1bGF0ZURhdGFPcHRpb25zLFxyXG4gIFJlbmRlclN2Z09wdGlvbnMsXHJcbiAgUmVuZGVySW5TZXNzaW9uT3B0aW9ucyxcclxuICBNb3VudERvbU9wdGlvbnMsXHJcbiAgT2Zmc2NyZWVuUmVuZGVyQ2FudmFzT3B0aW9ucyxcclxufSBmcm9tICcuL29wdGlvbnMucmVuZGVyLm1qcyc7XHJcbmltcG9ydCB7IFJlbmRlclZpZXcgfSBmcm9tICcuL3JlbmRlci9jYW52YXMvdmlldy5tanMnO1xyXG5pbXBvcnQgeyBMYXp5V2FzbU1vZHVsZSB9IGZyb20gJy4vd2FzbS5tanMnO1xyXG5pbXBvcnQgeyBidWlsZENvbXBvbmVudCB9IGZyb20gJy4vaW5pdC5tanMnO1xyXG5pbXBvcnQgeyBUeXBzdERvbURvY3VtZW50IH0gZnJvbSAnLi9kb20ubWpzJztcclxuXHJcbi8qKlxyXG4gKiBUaGUgcmVzdWx0IG9mIHJlbmRlcmluZyBhIFR5cHN0IGRvY3VtZW50LlxyXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBSZW5kZXJSZXN1bHRcclxuICogQHByb3BlcnR5IHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSByZW5kZXJlZCBUeXBzdCBkb2N1bWVudCAoc2luZ2xlIHBhZ2UpLlxyXG4gKiBAcHJvcGVydHkge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgcmVuZGVyZWQgVHlwc3QgZG9jdW1lbnQgKHNpbmdsZSBwYWdlKS5cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgUmVuZGVyUmVzdWx0IHtcclxuICB3aWR0aDogbnVtYmVyO1xyXG4gIGhlaWdodDogbnVtYmVyO1xyXG59XHJcblxyXG50eXBlIENvbnRleHRlZFJlbmRlck9wdGlvbnM8VD4gPSBUIHwgUmVuZGVyT3B0aW9uczxUPjtcclxuXHJcbi8qKlxyXG4gKiBUaGUgc2Vzc2lvbiBvZiBhIFR5cHN0IGRvY3VtZW50LlxyXG4gKiBAcHJvcGVydHkge3N0cmluZ30gYmFja2dyb3VuZENvbG9yIC0gVGhlIGJhY2tncm91bmQgY29sb3Igb2YgdGhlIFR5cHN0XHJcbiAqIGRvY3VtZW50LlxyXG4gKiBAcHJvcGVydHkge251bWJlcn0gcGl4ZWxQZXJQdCAtIFRoZSBwaXhlbCBwZXIgcG9pbnQgc2NhbGUgdXAgdGhlIGltYWdlLlxyXG4gKlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFJlbmRlclNlc3Npb24ge1xyXG4gIC8qKlxyXG4gICAqIEBpbnRlcm5hbFxyXG4gICAqL1xyXG4gIHB1YmxpYyBba09iamVjdF06IHR5cHN0LlJlbmRlclNlc3Npb247XHJcblxyXG4gIC8qKlxyXG4gICAqIEBpbnRlcm5hbFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgLyoqXHJcbiAgICAgKiBAaW50ZXJuYWxcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBwbHVnaW46IFR5cHN0UmVuZGVyZXIsXHJcbiAgICBvOiB0eXBzdC5SZW5kZXJTZXNzaW9uLFxyXG4gICkge1xyXG4gICAgdGhpc1trT2JqZWN0XSA9IG87XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVwcmVjYXRlZCBzZXQgaW4ge0BsaW5rIFJlbmRlclRvQ2FudmFzT3B0aW9uc30gaW5zdGVhZFxyXG4gICAqXHJcbiAgICogU2V0IHRoZSBiYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBUeXBzdCBkb2N1bWVudC5cclxuICAgKiBAcGFyYW0ge3N0cmluZ30gdCAtIFRoZSBiYWNrZ3JvdW5kIGNvbG9yIGluIGZvcm1hdCBvZiBgXiM/WzAtOWEtZl17Nn0kYFxyXG4gICAqXHJcbiAgICogTm90ZTogRGVmYXVsdCB0byBgI2ZmZmZmZmAuXHJcbiAgICpcclxuICAgKiBOb3RlOiBPbmx5IGF2YWlsYWJsZSBpbiBjYW52YXMgcmVuZGVyaW5nIG1vZGUuXHJcbiAgICovXHJcbiAgc2V0IGJhY2tncm91bmRDb2xvcih0OiBzdHJpbmcgfCB1bmRlZmluZWQpIHtcclxuICAgIGlmICh0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhpc1trT2JqZWN0XS5iYWNrZ3JvdW5kX2NvbG9yID0gdDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgYmFja2dyb3VuZCBjb2xvciBvZiB0aGUgVHlwc3QgZG9jdW1lbnQuXHJcbiAgICpcclxuICAgKiBOb3RlOiBEZWZhdWx0IHRvIGAjZmZmZmZmYC5cclxuICAgKlxyXG4gICAqIE5vdGU6IE9ubHkgYXZhaWxhYmxlIGluIGNhbnZhcyByZW5kZXJpbmcgbW9kZS5cclxuICAgKi9cclxuICBnZXQgYmFja2dyb3VuZENvbG9yKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5iYWNrZ3JvdW5kX2NvbG9yO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHRoZSBwaXhlbCBwZXIgcG9pbnQgc2NhbGUgdXAgdGhlIGNhbnZhcyBwYW5lbC5cclxuICAgKlxyXG4gICAqIE5vdGU6IERlZmF1bHQgdG8gYDNgLlxyXG4gICAqXHJcbiAgICogTm90ZTogT25seSBhdmFpbGFibGUgaW4gY2FudmFzIHJlbmRlcmluZyBtb2RlLlxyXG4gICAqL1xyXG4gIHNldCBwaXhlbFBlclB0KHQ6IG51bWJlciB8IHVuZGVmaW5lZCkge1xyXG4gICAgaWYgKHQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB0aGlzW2tPYmplY3RdLnBpeGVsX3Blcl9wdCA9IHQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVwcmVjYXRlZCBzZXQgaW4ge0BsaW5rIFJlbmRlclRvQ2FudmFzT3B0aW9uc30gaW5zdGVhZFxyXG4gICAqXHJcbiAgICogR2V0IHRoZSBwaXhlbCBwZXIgcG9pbnQgc2NhbGUgdXAgdGhlIGNhbnZhcyBwYW5lbC5cclxuICAgKlxyXG4gICAqIE5vdGU6IERlZmF1bHQgdG8gYDNgLlxyXG4gICAqXHJcbiAgICogTm90ZTogT25seSBhdmFpbGFibGUgaW4gY2FudmFzIHJlbmRlcmluZyBtb2RlLlxyXG4gICAqL1xyXG4gIGdldCBwaXhlbFBlclB0KCk6IG51bWJlciB8IHVuZGVmaW5lZCB7XHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5waXhlbF9wZXJfcHQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNldCBzdGF0ZVxyXG4gICAqL1xyXG4gIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5wbHVnaW4ucmVzZXRTZXNzaW9uKHRoaXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKiB1c2Uge0BsaW5rIGRvY1dpZHRofSBpbnN0ZWFkXHJcbiAgICovXHJcbiAgZ2V0IGRvY193aWR0aCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uZG9jX3dpZHRoO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGRvY1dpZHRoKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5kb2Nfd2lkdGg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqIHVzZSB7QGxpbmsgZG9jSGVpZ2h0fSBpbnN0ZWFkXHJcbiAgICovXHJcbiAgZ2V0IGRvY19oZWlnaHQoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLmRvY19oZWlnaHQ7XHJcbiAgfVxyXG5cclxuICBnZXQgZG9jSGVpZ2h0KCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5kb2NfaGVpZ2h0O1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVQYWdlc0luZm8oKTogUGFnZUluZm9bXSB7XHJcbiAgICBjb25zdCBwYWdlc19pbmZvID0gdGhpc1trT2JqZWN0XS5wYWdlc19pbmZvO1xyXG4gICAgY29uc3QgcGFnZUluZm9zOiBQYWdlSW5mb1tdID0gW107XHJcbiAgICBjb25zdCBwYWdlQ291bnQgPSBwYWdlc19pbmZvLnBhZ2VfY291bnQ7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhZ2VDb3VudDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHBhZ2VBc3QgPSBwYWdlc19pbmZvLnBhZ2UoaSk7XHJcbiAgICAgIHBhZ2VJbmZvcy5wdXNoKHtcclxuICAgICAgICBwYWdlT2Zmc2V0OiBwYWdlQXN0LnBhZ2Vfb2ZmLFxyXG4gICAgICAgIHdpZHRoOiBwYWdlQXN0LndpZHRoX3B0LFxyXG4gICAgICAgIGhlaWdodDogcGFnZUFzdC5oZWlnaHRfcHQsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBwYWdlSW5mb3M7XHJcbiAgfVxyXG5cclxuICBnZXRTb3VyY2VMb2MocGF0aDogVWludDMyQXJyYXkpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuICh0aGlzW2tPYmplY3RdIGFzIHR5cHN0LlJlbmRlclNlc3Npb24pLnNvdXJjZV9zcGFuKHBhdGgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI3JlbmRlclN2Z30gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICByZW5kZXJTdmcob3B0aW9uczogQ29udGV4dGVkUmVuZGVyT3B0aW9uczxSZW5kZXJTdmdPcHRpb25zPik6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5wbHVnaW4ucmVuZGVyU3ZnKHtcclxuICAgICAgcmVuZGVyU2Vzc2lvbjogdGhpcyxcclxuICAgICAgLi4ub3B0aW9ucyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI3JlbmRlclRvU3ZnfSBmb3IgbW9yZSBkZXRhaWxzLlxyXG4gICAqL1xyXG4gIHJlbmRlclRvU3ZnKG9wdGlvbnM6IENvbnRleHRlZFJlbmRlck9wdGlvbnM8UmVuZGVyVG9TdmdPcHRpb25zPik6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLnJlbmRlclRvU3ZnKHtcclxuICAgICAgcmVuZGVyU2Vzc2lvbjogdGhpcyxcclxuICAgICAgLi4ub3B0aW9ucyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI3JlbmRlckNhbnZhc30gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICByZW5kZXJDYW52YXMob3B0aW9uczogQ29udGV4dGVkUmVuZGVyT3B0aW9uczxSZW5kZXJDYW52YXNPcHRpb25zPik6IFByb21pc2U8UmVuZGVyQ2FudmFzUmVzdWx0PiB7XHJcbiAgICByZXR1cm4gdGhpcy5wbHVnaW4ucmVuZGVyQ2FudmFzKHtcclxuICAgICAgcmVuZGVyU2Vzc2lvbjogdGhpcyxcclxuICAgICAgLi4ub3B0aW9ucyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI21hbmlwdWxhdGVEYXRhfSBmb3IgbW9yZSBkZXRhaWxzLlxyXG4gICAqL1xyXG4gIG1hbmlwdWxhdGVEYXRhKG9wdHM6IE1hbmlwdWxhdGVEYXRhT3B0aW9ucykge1xyXG4gICAgdGhpcy5wbHVnaW4ubWFuaXB1bGF0ZURhdGEoe1xyXG4gICAgICByZW5kZXJTZXNzaW9uOiB0aGlzLFxyXG4gICAgICAuLi5vcHRzLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZWUge0BsaW5rIFR5cHN0UmVuZGVyZXIjcmVuZGVyU3ZnRGlmZn0gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICByZW5kZXJTdmdEaWZmKG9wdHM6IFJlbmRlclN2Z09wdGlvbnMpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLnJlbmRlclN2Z0RpZmYoe1xyXG4gICAgICByZW5kZXJTZXNzaW9uOiB0aGlzLFxyXG4gICAgICAuLi5vcHRzLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqIHVzZSB7QGxpbmsgZ2V0U291cmNlTG9jfSBpbnN0ZWFkXHJcbiAgICovXHJcbiAgZ2V0X3NvdXJjZV9sb2MocGF0aDogVWludDMyQXJyYXkpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuICh0aGlzW2tPYmplY3RdIGFzIHR5cHN0LlJlbmRlclNlc3Npb24pLnNvdXJjZV9zcGFuKHBhdGgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKiB1c2Uge0BsaW5rIHJlbmRlclN2Z0RpZmZ9IGluc3RlYWRcclxuICAgKi9cclxuICByZW5kZXJfaW5fd2luZG93KHJlY3RfbG9feDogbnVtYmVyLCByZWN0X2xvX3k6IG51bWJlciwgcmVjdF9oaV94OiBudW1iZXIsIHJlY3RfaGlfeTogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5yZW5kZXJfaW5fd2luZG93KHJlY3RfbG9feCwgcmVjdF9sb195LCByZWN0X2hpX3gsIHJlY3RfaGlfeSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqIHVzZSB7QGxpbmsgbWFuaXB1bGF0ZURhdGF9IGluc3RlYWRcclxuICAgKi9cclxuICBtZXJnZV9kZWx0YShkYXRhOiBVaW50OEFycmF5KSB7XHJcbiAgICB0aGlzLnBsdWdpbi5tYW5pcHVsYXRlRGF0YSh7XHJcbiAgICAgIHJlbmRlclNlc3Npb246IHRoaXMsXHJcbiAgICAgIGFjdGlvbjogJ21lcmdlJyxcclxuICAgICAgZGF0YSxcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuY29uc3QgZW51bSBNYW5hZ2VTdGF0dXMge1xyXG4gIERlbGV0ZSxcclxuICBOZXcsXHJcbiAgVXBkYXRlLFxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVHlwc3RXb3JrZXIge1xyXG4gIC8qKlxyXG4gICAqIEBpbnRlcm5hbFxyXG4gICAqL1xyXG4gIHB1YmxpYyBba09iamVjdF06IHR5cHN0LlR5cHN0V29ya2VyO1xyXG5cclxuICAvKipcclxuICAgKiBAaW50ZXJuYWxcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIC8qKlxyXG4gICAgICogQGludGVybmFsXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgcGx1Z2luOiBUeXBzdFJlbmRlcmVyRHJpdmVyLFxyXG4gICAgbzogdHlwc3QuVHlwc3RXb3JrZXIsXHJcbiAgKSB7XHJcbiAgICB0aGlzW2tPYmplY3RdID0gbztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RSZW5kZXJlciNtYW5pcHVsYXRlRGF0YX0gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICBtYW5pcHVsYXRlRGF0YShhY3Rpb246IHN0cmluZywgZGF0YTogVWludDhBcnJheSk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0ubWFuaXB1bGF0ZV9kYXRhKGFjdGlvbiwgZGF0YSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAaW50ZXJuYWxcclxuICAgKi9cclxuICBtYW5hZ2VkQ2FudmFzRWxlbUxpc3QgPSBuZXcgTWFwPHN0cmluZywgW01hbmFnZVN0YXR1cywgT2Zmc2NyZWVuUmVuZGVyQ2FudmFzT3B0aW9uc10+KCk7XHJcbiAgLyoqXHJcbiAgICogQGludGVybmFsXHJcbiAgICovXHJcbiAgY2FudmFzQ291bnRlciA9IE1hdGgucmFuZG9tKCk7XHJcbiAgLyoqXHJcbiAgICogWW91IG11c3Qgc3VibWl0IGFsbCBjYW52YXMgaW4gcGFnZXMgdG8gZW5zdXJlIHN5bmNocm9uaXphdGlvbiB3aXRoIHRoZSBiYWNrZ3JvdW5kIHdvcmtlclxyXG4gICAqXHJcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI3JlbmRlckNhbnZhc30gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICByZW5kZXJDYW52YXMoY2FudmFzRWxlbUxpc3Q6IE9mZnNjcmVlblJlbmRlckNhbnZhc09wdGlvbnNbXSk6IFByb21pc2U8UmVuZGVyQ2FudmFzUmVzdWx0W10+IHtcclxuICAgIGNvbnN0IG0gPSB0aGlzLm1hbmFnZWRDYW52YXNFbGVtTGlzdDtcclxuICAgIGZvciAoY29uc3QgW18sIGVsZW1dIG9mIG0pIHtcclxuICAgICAgZWxlbVswXSA9IE1hbmFnZVN0YXR1cy5EZWxldGU7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChjb25zdCBlbGVtIG9mIGNhbnZhc0VsZW1MaXN0KSB7XHJcbiAgICAgIGNvbnN0IGNhbnZhcyA9IGVsZW0uY2FudmFzO1xyXG4gICAgICBsZXQgZWxlbUlkID0gY2FudmFzLmRhdGFzZXQubWFuYWdlSWQ7XHJcbiAgICAgIGxldCBhY3Rpb24gPSBNYW5hZ2VTdGF0dXMuVXBkYXRlO1xyXG4gICAgICBpZiAoIWVsZW1JZCkge1xyXG4gICAgICAgIGVsZW1JZCA9IHRoaXMuY2FudmFzQ291bnRlci50b0ZpeGVkKDUpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzQ291bnRlciArPSAxO1xyXG4gICAgICAgIGNhbnZhcy5kYXRhc2V0Lm1hbmFnZUlkID0gZWxlbUlkO1xyXG4gICAgICAgIGFjdGlvbiA9IE1hbmFnZVN0YXR1cy5OZXc7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCBwcmV2ID0gbS5nZXQoZWxlbUlkKTtcclxuICAgICAgaWYgKHByZXYgJiYgcHJldlswXSAhPT0gTWFuYWdlU3RhdHVzLkRlbGV0ZSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignY2Fubm90IHVwZGF0ZSBhIGNhbnZhcyBmb3IgdHdvIHRpbWVzIGluIGJhdGNoJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIG0uc2V0KGVsZW1JZCwgW2FjdGlvbiwgeyAuLi5lbGVtIH1dKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBlbnRyaWVzID0gQXJyYXkuZnJvbShtLmVudHJpZXMoKSk7XHJcbiAgICBjb25zdCBhY3Rpb25zID0gbmV3IFVpbnQ4QXJyYXkoZW50cmllcy5sZW5ndGgpO1xyXG4gICAgY29uc3QgZWxlbWVudHMgPSBuZXcgQXJyYXkoZW50cmllcy5sZW5ndGgpO1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IGVudHJpZXMubWFwKChba2V5LCBbYWN0aW9uLCBlbGVtXV0sIGluZGV4KSA9PiB7XHJcbiAgICAgIGlmICghYWN0aW9uKSB7XHJcbiAgICAgICAgbS5kZWxldGUoa2V5KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgYWN0aW9uc1tpbmRleF0gPSBhY3Rpb247XHJcbiAgICAgIGVsZW1lbnRzW2luZGV4XSA9IGVsZW0uY2FudmFzO1xyXG4gICAgICByZXR1cm4gdGhpcy5wbHVnaW4uY2FudmFzT3B0aW9uc1RvUnVzdChlbGVtKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLnJlbmRlcl9jYW52YXMoYWN0aW9ucywgZWxlbWVudHMsIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcmV0cmlldmVQYWdlc0luZm8oKTogUHJvbWlzZTxQYWdlSW5mb1tdPiB7XHJcbiAgICBjb25zdCBwYWdlc19pbmZvID0gYXdhaXQgdGhpc1trT2JqZWN0XS5nZXRfcGFnZXNfaW5mbygpO1xyXG4gICAgY29uc29sZS5sb2cocGFnZXNfaW5mbyk7XHJcbiAgICBjb25zdCBwYWdlSW5mb3M6IFBhZ2VJbmZvW10gPSBbXTtcclxuICAgIGNvbnN0IHBhZ2VDb3VudCA9IHBhZ2VzX2luZm8ucGFnZV9jb3VudDtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFnZUNvdW50OyBpKyspIHtcclxuICAgICAgY29uc3QgcGFnZUFzdCA9IHBhZ2VzX2luZm8ucGFnZShpKTtcclxuICAgICAgcGFnZUluZm9zLnB1c2goe1xyXG4gICAgICAgIHBhZ2VPZmZzZXQ6IHBhZ2VBc3QucGFnZV9vZmYsXHJcbiAgICAgICAgd2lkdGg6IHBhZ2VBc3Qud2lkdGhfcHQsXHJcbiAgICAgICAgaGVpZ2h0OiBwYWdlQXN0LmhlaWdodF9wdCxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHBhZ2VJbmZvcztcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUaGUgaW50ZXJmYWNlIG9mIFR5cHN0IHJlbmRlcmVyLlxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBUeXBzdFJlbmRlcmVyIGV4dGVuZHMgVHlwc3RTdmdSZW5kZXJlciB7XHJcbiAgLyoqXHJcbiAgICogSW5pdGlhbGl6ZSB0aGUgdHlwc3QgcmVuZGVyZXIuXHJcbiAgICogQHBhcmFtIHtQYXJ0aWFsPEluaXRPcHRpb25zPn0gb3B0aW9ucyAtIFRoZSBvcHRpb25zIGZvciBpbml0aWFsaXppbmcgdGhlXHJcbiAgICogdHlwc3QgcmVuZGVyZXIuXHJcbiAgICovXHJcbiAgaW5pdChvcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+O1xyXG5cclxuICAvKipcclxuICAgKiBMb2FkIGEgZ2x5cGggcGFjayBmb3IgYWxsIG9mIHRoZSBUeXBzdCBkb2N1bWVudHMgdG8gcmVuZGVyLlxyXG4gICAqIE5vdGU6IHRoaXMgZnVuY3Rpb24gaXMgc3RpbGwgdW5kZXIgZGV2ZWxvcG1lbnQuXHJcbiAgICogQHBhcmFtIHBhY2tcclxuICAgKi9cclxuICBsb2FkR2x5cGhQYWNrKHBhY2s6IHVua25vd24pOiBQcm9taXNlPHZvaWQ+O1xyXG5cclxuICAvKipcclxuICAgKiBSZXNldCBzdGF0ZVxyXG4gICAqL1xyXG4gIHJlc2V0U2Vzc2lvbihzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKTogdm9pZDtcclxuXHJcbiAgLyoqXHJcbiAgICogUmV0cmVpdmUgcGFnZSBpbmZvcm1hdGlvbiBvZiBjdXJyZW50IHNlbGVjdGVkIGRvY3VtZW50XHJcbiAgICovXHJcbiAgcmV0cmlldmVQYWdlc0luZm9Gcm9tU2Vzc2lvbihzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKTogUGFnZUluZm9bXTtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVyIGEgVHlwc3QgZG9jdW1lbnQgdG8gY2FudmFzLlxyXG4gICAqL1xyXG4gIHJlbmRlckNhbnZhcyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlckNhbnZhc09wdGlvbnM+KTogUHJvbWlzZTxSZW5kZXJDYW52YXNSZXN1bHQ+O1xyXG5cclxuICAvKipcclxuICAgKiBSZW5kZXIgYSBUeXBzdCBkb2N1bWVudCB0byBjYW52YXMuXHJcbiAgICogQHBhcmFtIHtSZW5kZXJPcHRpb25zPFJlbmRlclRvQ2FudmFzT3B0aW9ucz59IG9wdGlvbnMgLSBUaGUgb3B0aW9ucyBmb3JcclxuICAgKiByZW5kZXJpbmcgYSBUeXBzdCBkb2N1bWVudCB0byBzcGVjaWZpZWQgY29udGFpbmVyLlxyXG4gICAqIEByZXR1cm5zIHt2b2lkfSAtIFRoZSByZXN1bHQgb2YgcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQuXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogbGV0IGZldGNoRG9jID0gKHBhdGgpID0+IGZldGNoKHBhdGgpLnRoZW4oXHJcbiAgICogICByZXNwb25zZSA9PiBuZXcgVWludDhBcnJheShyZXNwb25zZS5hcnJheUJ1ZmZlcigpKSlcclxuICAgKiByZW5kZXJlci5yZW5kZXJUb0NhbnZhcyh7XHJcbiAgICogICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKSxcclxuICAgKiAgIHBpeGVsUGVyUHQ6IDMsXHJcbiAgICogICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmZmZmJyxcclxuICAgKiAgIGFydGlmYWN0Q29udGVudDogYXdhaXQgZmV0Y2hEb2MoJ3R5cHN0LW1haW4uc2lyLmluJyksXHJcbiAgICogfSk7XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgcmVuZGVyVG9DYW52YXMob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJUb0NhbnZhc09wdGlvbnM+KTogUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVyIGEgVHlwc3QgZG9jdW1lbnQgdG8gKG5vbi1pbmNyZW1lbnRhbCkgc3ZnIHN0cmluZy5cclxuICAgKiBAcGFyYW0ge1JlbmRlck9wdGlvbnM8UmVuZGVyU3ZnT3B0aW9ucz59IG9wdGlvbnMgLSBUaGUgb3B0aW9ucyBmb3JcclxuICAgKiByZW5kZXJpbmcgYSBUeXBzdCBkb2N1bWVudCB0byBzcGVjaWZpZWQgY29udGFpbmVyLlxyXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IC0gVGhlIHJlbmRlcmVkIGNvbnRlbnQuXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogbGV0IGZldGNoRG9jID0gKHBhdGgpID0+IGZldGNoKHBhdGgpLnRoZW4oXHJcbiAgICogICByZXNwb25zZSA9PiBuZXcgVWludDhBcnJheShyZXNwb25zZS5hcnJheUJ1ZmZlcigpKSlcclxuICAgKiBjb25zdCBzdmcgPSByZW5kZXJlci5yZW5kZXJTdmcoe1xyXG4gICAqICAgYXJ0aWZhY3RDb250ZW50OiBhd2FpdCBmZXRjaERvYygndHlwc3QtbWFpbi5zaXIuaW4nKSxcclxuICAgKiB9KTtcclxuICAgKiBgYGBcclxuICAgKi9cclxuICByZW5kZXJTdmcob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJTdmdPcHRpb25zPik6IFByb21pc2U8c3RyaW5nPjtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVyIGEgVHlwc3QgZG9jdW1lbnQgdG8gc3ZnLlxyXG4gICAqIEBwYXJhbSB7UmVuZGVyT3B0aW9uczxSZW5kZXJUb1N2Z09wdGlvbnM+fSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yXHJcbiAgICogcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQgdG8gc3BlY2lmaWVkIGNvbnRhaW5lci5cclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIGBgYHR5cGVzY3JpcHRcclxuICAgKiBsZXQgZmV0Y2hEb2MgPSAocGF0aCkgPT4gZmV0Y2gocGF0aCkudGhlbihcclxuICAgKiAgIHJlc3BvbnNlID0+IG5ldyBVaW50OEFycmF5KHJlc3BvbnNlLmFycmF5QnVmZmVyKCkpKVxyXG4gICAqIHJlbmRlcmVyLnJlbmRlclRvU3ZnKHtcclxuICAgKiAgIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhaW5lcicpLFxyXG4gICAqICAgYXJ0aWZhY3RDb250ZW50OiBhd2FpdCBmZXRjaERvYygndHlwc3QtbWFpbi5zaXIuaW4nKSxcclxuICAgKiB9KTtcclxuICAgKiBgYGBcclxuICAgKi9cclxuICByZW5kZXJUb1N2ZyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclRvU3ZnT3B0aW9ucz4pOiBQcm9taXNlPGJvb2xlYW4+O1xyXG5cclxuICAvKipcclxuICAgKiBSZXR1cm4gc2VsZWN0ZWQgY3VycmVudCBzdmdcclxuICAgKi9cclxuICBnZXRDdXN0b21WMShvcHRpb25zOiBSZW5kZXJJblNlc3Npb25PcHRpb25zPHt9Pik6IFByb21pc2U8YW55PjtcclxuXHJcbiAgLyoqXHJcbiAgICogZXhwZXJpbWVudGFsXHJcbiAgICovXHJcbiAgcmVuZGVyU3ZnRGlmZihvcHRpb25zOiBSZW5kZXJJblNlc3Npb25PcHRpb25zPFJlbmRlclN2Z09wdGlvbnM+KTogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiBNYW5pcHVsYXRlIHRoZSBUeXBzdCBkb2N1bWVudCBpbiB0aGUgc2Vzc2lvbi5cclxuICAgKiBTZWUge0BsaW5rIE1hbmlwdWxhdGVEYXRhT3B0aW9uc30gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKiBAcGFyYW0ge1JlbmRlclNlc3Npb259IHNlc3Npb24gLSBUaGUgVHlwc3QgZG9jdW1lbnQgc2Vzc2lvbiB0aGF0IGhhcyBiZWVuXHJcbiAgICogY3JlYXRlZCBieSBUeXBzdFJlbmRlcmVyLlxyXG4gICAqIEBwYXJhbSB7TWFuaXB1bGF0ZURhdGFPcHRpb25zfSBvcHRzIC0gVGhlIG9wdGlvbnMgZm9yIG1hbmlwdWxhdGluZyB0aGVcclxuICAgKiBUeXBzdCBkb2N1bWVudCBpbiB0aGUgc2Vzc2lvbi5cclxuICAgKlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogcmVzZXQgdGhlIGRhdGEgdG8gdGhlIGluaXRpYWwgc3RhdGUuXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGNvbnN0IHNlc3Npb24gPSBhd2FpdCByZW5kZXJlci5jcmVhdGVTZXNzaW9uKC4uLik7XHJcbiAgICogYXdhaXQgcmVuZGVyZXIubWFuaXB1bGF0ZURhdGEoc2Vzc2lvbiwge1xyXG4gICAqICAgYWN0aW9uOiAncmVzZXQnLFxyXG4gICAqICAgZGF0YTogbmV3IFVpbnQ4QXJyYXkoLi4uKSxcclxuICAgKiB9KTtcclxuICAgKiBgYGBcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIG1lcmdlIHRoZSBkYXRhIHRvIHRoZSBjdXJyZW50IHN0YXRlLlxyXG4gICAqIGBgYHR5cGVzY3JpcHRcclxuICAgKiBjb25zdCBzZXNzaW9uID0gYXdhaXQgcmVuZGVyZXIuY3JlYXRlU2Vzc2lvbiguLi4pO1xyXG4gICAqIC8vLyByZXNldCB0aGUgZGF0YSB0byB0aGUgaW5pdGlhbCBzdGF0ZVxyXG4gICAqIGF3YWl0IHJlbmRlcmVyLm1hbmlwdWxhdGVEYXRhKHNlc3Npb24sIGRhdGEoJ3Jlc2V0JykpO1xyXG4gICAqIC8vLyBtZXJnZSB0aGUgZGF0YSB0byB0aGUgY3VycmVudCBzdGF0ZVxyXG4gICAqIGF3YWl0IHJlbmRlcmVyLm1hbmlwdWxhdGVEYXRhKHNlc3Npb24sIGRhdGEoJ21lcmdlJykpO1xyXG4gICAqIC8vLyBpbmNyZW1lbnRhbGx5IG1lcmdlIHRoZSBkYXRhIGFnYWluXHJcbiAgICogYXdhaXQgcmVuZGVyZXIubWFuaXB1bGF0ZURhdGEoc2Vzc2lvbiwgZGF0YSgnbWVyZ2UnKSk7XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgbWFuaXB1bGF0ZURhdGEob3B0czogUmVuZGVySW5TZXNzaW9uT3B0aW9uczxNYW5pcHVsYXRlRGF0YU9wdGlvbnM+KTogdm9pZDtcclxuXHJcbiAgLyoqXHJcbiAgICogUnVuIGEgZnVuY3Rpb24gd2l0aCBhIHNlc3Npb24sIGFuZCB0aGUgc2Vzc3Npb24gaXMgb25seSBhdmFpbGFibGUgZHVyaW5nXHJcbiAgICogdGhlIGZ1bmN0aW9uIGNhbGwuXHJcbiAgICpcclxuICAgKiB0aGUgbGlmZXRpbWUgb2Ygc2Vzc2lvbiBpcyBxdWl0ZSBidWctcHJvbmUsIHNvIHdlIGN1cnJlbnQgZG9lcyBub3QgbWFrZSBpdFxyXG4gICAqIGxvbmdlciBsaXZlIHRoYW4gdGhlIGZ1bmN0aW9uIGNhbGwuXHJcbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gZm4gLSBUaGUgZnVuY3Rpb24gdG8gcnVuIHdpdGggYSBzZXNzaW9uLlxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFQ+fSAtIFRoZSByZXN1bHQgb2YgdGhlIGZ1bmN0aW9uLlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogcnVuIGEgZnVuY3Rpb24gd2l0aCBhbiBzZXNzaW9uIHdpdGggZW1wdHkgc3RhdGUuXHJcbiAgICpcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogY29uc3QgcmVzID0gYXdhaXQgcmVuZGVyZXIucnVuV2l0aFNlc3Npb24oYXN5bmMgc2Vzc2lvbiA9PiB7XHJcbiAgICogICBhd2FpdCByZW5kZXJlci5tYW5pcHVsYXRlRGF0YShzZXNzaW9uLCBkYXRhKCdyZXNldCcpKTtcclxuICAgKiAgIHJldHVybiBhd2FpdCByZW5kZXJlci5yZW5kZXJUb0NhbnZhcyh7XHJcbiAgICogICAgIHJlbmRlclNlc3Npb246IHNlc3Npb24sXHJcbiAgICogICAgIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhaW5lcicpLFxyXG4gICAqICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmZmZmJyxcclxuICAgKiAgIH0pO1xyXG4gICAqIH0pO1xyXG4gICAqIGBgYFxyXG4gICAqXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBydW4gYSBmdW5jdGlvbiB3aXRoIGFuIHNlc3Npb24gd2l0aCBpbml0aWFsIHN0YXRlLlxyXG4gICAqXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGNvbnN0IHJlcyA9IGF3YWl0IHJlbmRlcmVyLnJ1bldpdGhTZXNzaW9uKHtcclxuICAgKiAgIGZvcm1hdDogJ3ZlY3RvcicsXHJcbiAgICogICBhcnRpZmFjdENvbnRlbnQ6IG5ldyBVaW50OEFycmF5KC4uLiksXHJcbiAgICogfSwgd29ya1dpdGhTZXNzaW9uKHNlc3Npb24pKTtcclxuICAgKiBgYGBcclxuICAgKlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogbGVhayB0aGUgbGlmZSBzcGFuIG9mIHNlc3Npb24gKG5lZWQgdHlwZXNjcmlwdCA+PSB2NS4yKVxyXG4gICAqXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGNsYXNzIFN0YWNrZWRTZXNzaW9uIHtcclxuICAgKiAgIHNlc3Npb246IFJlbmRlclNlc3Npb247XHJcbiAgICogICBwcml2YXRlIHJlc29sdmU6IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiB2b2lkO1xyXG4gICAqICAgW1N5bWJvbC5kaXNwb3NlXSgpIHtcclxuICAgKiAgICAgdGhpcy5yZXNvbHZlKCk7XHJcbiAgICogICB9XHJcbiAgICogICBzdGF0aWMgYXN5bmMgY3JlYXRlKCkge1xyXG4gICAqICAgICByZXR1cm4gbmV3IFByb21pc2U8U3RhY2tlZFNlc3Npb24+KHJlc29sdmUgPT4ge1xyXG4gICAqICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCByZW5kZXJlci5ydW5XaXRoU2Vzc2lvbihzZXNzaW9uID0+IHtcclxuICAgKiAgICAgICBjb25zdCBzdGFja2VkU2Vzc2lvbiA9IG5ldyBTdGFja2VkU2Vzc2lvbigpO1xyXG4gICAqICAgICAgIHN0YWNrZWRTZXNzaW9uLnNlc3Npb24gPSBzZXNzaW9uO1xyXG4gICAqICAgICAgIHN0YWNrZWRTZXNzaW9uLnJlc29sdmUgPSByZXNvbHZlO1xyXG4gICAqICAgICAgIHJldHVybiBzdGFja2VkU2Vzc2lvbjtcclxuICAgKiAgICAgfSk7XHJcbiAgICogICB9XHJcbiAgICogfVxyXG4gICAqXHJcbiAgICoge1xyXG4gICAqICAgYXdhaXQgdXNpbmcgc2Vzc2lvbiA9IFN0YWNrZWRTZXNzaW9uLmNyZWF0ZSgpO1xyXG4gICAqICAgLy8vIGRvIHNvbWV0aGluZyB3aXRoIHNlc3Npb25cclxuICAgKiB9XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgcnVuV2l0aFNlc3Npb248VD4oZm46IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPjtcclxuICBydW5XaXRoU2Vzc2lvbjxUPihcclxuICAgIG9wdGlvbnM6IENyZWF0ZVNlc3Npb25PcHRpb25zLFxyXG4gICAgZm46IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiBQcm9taXNlPFQ+LFxyXG4gICk6IFByb21pc2U8VD47XHJcblxyXG4gIGNyZWF0ZVdvcmtlclYwKHdvcmtlcjogV29ya2VyKTogUHJvbWlzZTxUeXBzdFdvcmtlcj47XHJcblxyXG4gIHJlbmRlckRvbShvcHRpb25zOiBSZW5kZXJJblNlc3Npb25PcHRpb25zPE1vdW50RG9tT3B0aW9ucz4pOiBQcm9taXNlPFR5cHN0RG9tRG9jdW1lbnQ+O1xyXG5cclxuICAvKipcclxuICAgKiBhbGlhcyB0byB7QGxpbmsgVHlwc3RSZW5kZXJlciNyZW5kZXJUb0NhbnZhc30sIHdpbGwgcmVtb3ZlIGluIHYwLjUuMFxyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICogdXNlIHtAbGluayByZW5kZXJUb0NhbnZhc30gaW5zdGVhZFxyXG4gICAqL1xyXG4gIHJlbmRlcihvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclRvQ2FudmFzT3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+O1xyXG59XHJcblxyXG5jb25zdCBnUmVuZGVyZXJNb2R1bGUgPSAobW9kdWxlOiB0eXBlb2YgdHlwc3QpID0+XHJcbiAgbmV3IExhenlXYXNtTW9kdWxlKGFzeW5jIChiaW4/OiBhbnkpID0+IHtcclxuICAgIHJldHVybiBhd2FpdCBtb2R1bGUuZGVmYXVsdChiaW4pO1xyXG4gIH0pO1xyXG5cclxuLyoqXHJcbiAqIGNyZWF0ZSBhIFR5cHN0IHJlbmRlcmVyLlxyXG4gKiBAcmV0dXJucyB7VHlwc3RSZW5kZXJlcn0gLSBUaGUgVHlwc3QgcmVuZGVyZXIuXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYHR5cGVzY3JpcHRcclxuICogaW1wb3J0IHsgY3JlYXRlVHlwc3RSZW5kZXJlciB9IGZyb20gJ3R5cHN0JztcclxuICogY29uc3QgcmVuZGVyZXIgPSBjcmVhdGVUeXBzdFJlbmRlcmVyKCk7XHJcbiAqIGF3YWl0IHJlbmRlcmVyLmluaXQoKTtcclxuICogYXdhaXQgcmVuZGVyZXIucmVuZGVyKHtcclxuICogICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKSxcclxuICogICBhcnRpZmFjdENvbnRlbnQ6ICd7IC4uLiB9JyxcclxuICogfSk7XHJcbiAqIGBgYFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVR5cHN0UmVuZGVyZXIoKTogVHlwc3RSZW5kZXJlciB7XHJcbiAgcmV0dXJuIG5ldyBUeXBzdFJlbmRlcmVyRHJpdmVyKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHlwc3RTdmdSZW5kZXJlciB7XHJcbiAgaW5pdChvcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+O1xyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGUgYSBzdmcgc2Vzc2lvbi5cclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqIHVzZSB7QGxpbmsgVHlwc3RSZW5kZXJlclsncnVuV2l0aFNlc3Npb24nXX0gaW5zdGVhZFxyXG4gICAqL1xyXG4gIGNyZWF0ZU1vZHVsZShiOiBVaW50OEFycmF5KTogUHJvbWlzZTxSZW5kZXJTZXNzaW9uPjtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVyIGEgVHlwc3QgZG9jdW1lbnQgdG8gc3ZnLlxyXG4gICAqIEBwYXJhbSB7UmVuZGVyT3B0aW9uczxSZW5kZXJUb1N2Z09wdGlvbnM+fSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yXHJcbiAgICogcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQgdG8gc3BlY2lmaWVkIGNvbnRhaW5lci5cclxuICAgKiBAcmV0dXJucyB7dm9pZH0gLSBUaGUgcmVzdWx0IG9mIHJlbmRlcmluZyBhIFR5cHN0IGRvY3VtZW50LlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGxldCBmZXRjaERvYyA9IChwYXRoKSA9PiBmZXRjaChwYXRoKS50aGVuKFxyXG4gICAqICAgcmVzcG9uc2UgPT4gbmV3IFVpbnQ4QXJyYXkocmVzcG9uc2UuYXJyYXlCdWZmZXIoKSkpXHJcbiAgICogcmVuZGVyZXIucmVuZGVyVG9Tdmcoe1xyXG4gICAqICAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFpbmVyJyksXHJcbiAgICogICBhcnRpZmFjdENvbnRlbnQ6IGF3YWl0IGZldGNoRG9jKCd0eXBzdC1tYWluLnNpci5pbicpLFxyXG4gICAqIH0pO1xyXG4gICAqIGBgYFxyXG4gICAqL1xyXG4gIHJlbmRlclRvU3ZnKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyVG9TdmdPcHRpb25zPik6IFByb21pc2U8Ym9vbGVhbj47XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAZGVwcmVjYXRlZFxyXG4gKiB1c2Uge0BsaW5rIGNyZWF0ZVR5cHN0UmVuZGVyZXJ9IGluc3RlYWRcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUeXBzdFN2Z1JlbmRlcmVyKCk6IFR5cHN0U3ZnUmVuZGVyZXIge1xyXG4gIHJldHVybiBuZXcgVHlwc3RSZW5kZXJlckRyaXZlcigpO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVuZGVyZXJCdWlsZEluZm8oKTogUHJvbWlzZTxhbnk+IHtcclxuICBjb25zdCByZW5kZXJNb2R1bGUgPSBhd2FpdCBpbXBvcnQoJ0BteXJpYWRkcmVhbWluL3R5cHN0LXRzLXJlbmRlcmVyL3BrZy93YXNtLXBhY2stc2hpbS5tanMnKTtcclxuICByZXR1cm4gcmVuZGVyTW9kdWxlLnJlbmRlcmVyX2J1aWxkX2luZm8oKTtcclxufVxyXG5cclxubGV0IHdhcm5PbmNlQ2FudmFzU2V0ID0gdHJ1ZTtcclxuXHJcbi8qKiBAaW50ZXJuYWwgKi9cclxuZXhwb3J0IGNsYXNzIFR5cHN0UmVuZGVyZXJEcml2ZXIge1xyXG4gIHJlbmRlcmVyOiB0eXBzdC5UeXBzdFJlbmRlcmVyO1xyXG4gIHJlbmRlcmVySnM6IHR5cGVvZiB0eXBzdDtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7fVxyXG5cclxuICBhc3luYyBpbml0KG9wdGlvbnM/OiBQYXJ0aWFsPEluaXRPcHRpb25zPik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdGhpcy5yZW5kZXJlckpzID0gYXdhaXQgKG9wdGlvbnM/LmdldFdyYXBwZXI/LigpIHx8XHJcbiAgICAgIGltcG9ydCgnQG15cmlhZGRyZWFtaW4vdHlwc3QtdHMtcmVuZGVyZXIvcGtnL3dhc20tcGFjay1zaGltLm1qcycpKTtcclxuICAgIGNvbnN0IFR5cHN0UmVuZGVyZXJCdWlsZGVyID0gdGhpcy5yZW5kZXJlckpzLlR5cHN0UmVuZGVyZXJCdWlsZGVyO1xyXG4gICAgdGhpcy5yZW5kZXJlciA9IGF3YWl0IGJ1aWxkQ29tcG9uZW50KFxyXG4gICAgICBvcHRpb25zLFxyXG4gICAgICBnUmVuZGVyZXJNb2R1bGUodGhpcy5yZW5kZXJlckpzKSxcclxuICAgICAgVHlwc3RSZW5kZXJlckJ1aWxkZXIsXHJcbiAgICAgIHt9LFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGxvYWRHbHlwaFBhY2soX3BhY2s6IHVua25vd24pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIC8vIHRoaXMucmVuZGVyZXIubG9hZF9nbHlwaF9wYWNrKHBhY2spO1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVPcHRpb25zVG9SdXN0KG9wdGlvbnM6IFBhcnRpYWw8Q3JlYXRlU2Vzc2lvbk9wdGlvbnM+KTogdHlwc3QuQ3JlYXRlU2Vzc2lvbk9wdGlvbnMge1xyXG4gICAgY29uc3QgcnVzdE9wdGlvbnMgPSBuZXcgdGhpcy5yZW5kZXJlckpzLkNyZWF0ZVNlc3Npb25PcHRpb25zKCk7XHJcblxyXG4gICAgaWYgKG9wdGlvbnMuZm9ybWF0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgcnVzdE9wdGlvbnMuZm9ybWF0ID0gb3B0aW9ucy5mb3JtYXQ7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG9wdGlvbnMuYXJ0aWZhY3RDb250ZW50ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgcnVzdE9wdGlvbnMuYXJ0aWZhY3RfY29udGVudCA9IG9wdGlvbnMuYXJ0aWZhY3RDb250ZW50O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBydXN0T3B0aW9ucztcclxuICB9XHJcblxyXG4gIGNhbnZhc09wdGlvbnNUb1J1c3Qob3B0aW9uczogUmVuZGVyQ2FudmFzT3B0aW9ucyk6IHR5cHN0LlJlbmRlclBhZ2VJbWFnZU9wdGlvbnMge1xyXG4gICAgY29uc3QgcnVzdE9wdGlvbnMgPSBuZXcgdGhpcy5yZW5kZXJlckpzLlJlbmRlclBhZ2VJbWFnZU9wdGlvbnMoKTtcclxuICAgIGlmIChvcHRpb25zLnBhZ2VPZmZzZXQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3BhZ2VPZmZzZXQgaXMgcmVxdWlyZWQgaW4gcmVmbGV4byB2MC41LjAnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJ1c3RPcHRpb25zLnBhZ2Vfb2ZmID0gb3B0aW9ucy5wYWdlT2Zmc2V0O1xyXG4gICAgfVxyXG4gICAgaWYgKG9wdGlvbnMuY2FjaGVLZXkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBydXN0T3B0aW9ucy5jYWNoZV9rZXkgPSBvcHRpb25zLmNhY2hlS2V5O1xyXG4gICAgfVxyXG4gICAgaWYgKG9wdGlvbnMuYmFja2dyb3VuZENvbG9yICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgcnVzdE9wdGlvbnMuYmFja2dyb3VuZF9jb2xvciA9IG9wdGlvbnMuYmFja2dyb3VuZENvbG9yO1xyXG4gICAgfVxyXG4gICAgaWYgKG9wdGlvbnMucGl4ZWxQZXJQdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHJ1c3RPcHRpb25zLnBpeGVsX3Blcl9wdCA9IG9wdGlvbnMucGl4ZWxQZXJQdDtcclxuICAgIH1cclxuICAgIGlmIChvcHRpb25zLmRhdGFTZWxlY3Rpb24gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBsZXQgZW5jb2RlZCA9IDA7XHJcbiAgICAgIGlmIChvcHRpb25zLmRhdGFTZWxlY3Rpb24uYm9keSkge1xyXG4gICAgICAgIGVuY29kZWQgfD0gMSA8PCAwO1xyXG4gICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuY2FudmFzICYmIHdhcm5PbmNlQ2FudmFzU2V0KSB7XHJcbiAgICAgICAgd2Fybk9uY2VDYW52YXNTZXQgPSBmYWxzZTtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ2RhdGFTZWxlY3Rpb24uYm9keSBpcyBub3Qgc2V0IGJ1dCBwcm92aWRpbmcgY2FudmFzIGZvciBib2R5Jyk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9wdGlvbnMuZGF0YVNlbGVjdGlvbi50ZXh0IHx8IG9wdGlvbnMuZGF0YVNlbGVjdGlvbi5hbm5vdGF0aW9uKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignZGF0YVNlbGVjdGlvbi50ZXh0IGFuZCBkYXRhU2VsZWN0aW9uLmFubm90YXRpb24gYXJlIGRlcHJlY2F0ZWQnKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob3B0aW9ucy5kYXRhU2VsZWN0aW9uLnNlbWFudGljcykge1xyXG4gICAgICAgIGVuY29kZWQgfD0gMSA8PCAzO1xyXG4gICAgICB9XHJcbiAgICAgIHJ1c3RPcHRpb25zLmRhdGFfc2VsZWN0aW9uID0gZW5jb2RlZDtcclxuICAgIH1cclxuICAgIHJldHVybiBydXN0T3B0aW9ucztcclxuICB9XHJcblxyXG4gIHJldHJpZXZlUGFnZXNJbmZvRnJvbVNlc3Npb24oc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbik6IFBhZ2VJbmZvW10ge1xyXG4gICAgcmV0dXJuIHNlc3Npb24ucmV0cmlldmVQYWdlc0luZm8oKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbmRlciBhIFR5cHN0IGRvY3VtZW50IHRvIGNhbnZhcy5cclxuICAgKi9cclxuICByZW5kZXJDYW52YXMob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJDYW52YXNPcHRpb25zPik6IFByb21pc2U8UmVuZGVyQ2FudmFzUmVzdWx0PiB7XHJcbiAgICByZXR1cm4gdGhpcy53aXRoaW5PcHRpb25TZXNzaW9uKG9wdGlvbnMsIGFzeW5jIHNlc3Npb25SZWYgPT4ge1xyXG4gICAgICByZXR1cm4gdGhpcy5yZW5kZXJlci5yZW5kZXJfcGFnZV90b19jYW52YXMoXHJcbiAgICAgICAgc2Vzc2lvblJlZltrT2JqZWN0XSxcclxuICAgICAgICBvcHRpb25zLmNhbnZhcyB8fCB1bmRlZmluZWQsXHJcbiAgICAgICAgdGhpcy5jYW52YXNPcHRpb25zVG9SdXN0KG9wdGlvbnMpLFxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBhc3luYyByZW5kZXJQZGYoYXJ0aWZhY3RDb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPFVpbnQ4QXJyYXk+IHtcclxuICAvLyByZXR1cm4gdGhpcy5yZW5kZXJlci5yZW5kZXJfdG9fcGRmKGFydGlmYWN0Q29udGVudCk7XHJcbiAgLy8gfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGluQW5pbWF0aW9uRnJhbWU8VD4oZm46ICgpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIHJlc29sdmUoZm4oKSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgcmVuZGVyRGlzcGxheUxheWVyKFxyXG4gICAgc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbixcclxuICAgIGNhbnZhc0xpc3Q6IEhUTUxDYW52YXNFbGVtZW50W10sXHJcbiAgICBvcHRpb25zOiBSZW5kZXJUb0NhbnZhc09wdGlvbnMsXHJcbiAgKTogUHJvbWlzZTxSZW5kZXJDYW52YXNSZXN1bHRbXT4ge1xyXG4gICAgY29uc3QgcGFnZXNfaW5mbyA9IHNlc3Npb25ba09iamVjdF0ucGFnZXNfaW5mbztcclxuICAgIGNvbnN0IHBhZ2VfY291bnQgPSBwYWdlc19pbmZvLnBhZ2VfY291bnQ7XHJcblxyXG4gICAgY29uc3QgZG9SZW5kZXIgPSBhc3luYyAoaTogbnVtYmVyLCBwYWdlX29mZjogbnVtYmVyKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNhbnZhcyA9IGNhbnZhc0xpc3RbaV07XHJcbiAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgICBpZiAoIWN0eCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignY2FudmFzIGNvbnRleHQgaXMgbnVsbCcpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnJlbmRlckNhbnZhcyh7XHJcbiAgICAgICAgLi4ub3B0aW9ucyxcclxuICAgICAgICBjYW52YXM6IGN0eCxcclxuICAgICAgICByZW5kZXJTZXNzaW9uOiBzZXNzaW9uLFxyXG4gICAgICAgIHBhZ2VPZmZzZXQ6IHBhZ2Vfb2ZmLFxyXG4gICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgdCA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gICAgY29uc3QgdGV4dENvbnRlbnRMaXN0ID0gYXdhaXQgKGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0czogUmVuZGVyQ2FudmFzUmVzdWx0W10gPSBbXTtcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWdlX2NvdW50OyBpKyspIHtcclxuICAgICAgICByZXN1bHRzLnB1c2goYXdhaXQgdGhpcy5pbkFuaW1hdGlvbkZyYW1lKCgpID0+IGRvUmVuZGVyKGksIGkpKSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiByZXN1bHRzO1xyXG4gICAgfSkoKTtcclxuICAgIGNvbnN0IHQyID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcblxyXG4gICAgY29uc29sZS5sb2coYGRpc3BsYXkgbGF5ZXIgdXNlZDogcmVuZGVyID0gJHsodDIgLSB0KS50b0ZpeGVkKDEpfW1zYCk7XHJcblxyXG4gICAgcmV0dXJuIHRleHRDb250ZW50TGlzdDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVuZGVyVGV4dExheWVyKGxheWVyTGlzdDogSFRNTERpdkVsZW1lbnRbXSwgdGV4dFNvdXJjZUxpc3Q6IFJlbmRlckNhbnZhc1Jlc3VsdFtdKSB7XHJcbiAgICBjb25zdCB0MiA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gICAgbGF5ZXJMaXN0LmZvckVhY2goKGxheWVyLCBpKSA9PiB7XHJcbiAgICAgIGxheWVyLmlubmVySFRNTCA9IHRleHRTb3VyY2VMaXN0W2ldLmh0bWxTZW1hbnRpY3NbMF07XHJcbiAgICB9KTtcclxuICAgIGNvbnN0IHQzID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICBjb25zb2xlLmxvZyhgdGV4dCBsYXllciB1c2VkOiByZW5kZXIgPSAkeyh0MyAtIHQyKS50b0ZpeGVkKDEpfW1zYCk7XHJcbiAgfVxyXG5cclxuICBhc3luYyByZW5kZXIob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJUb0NhbnZhc09wdGlvbnM+KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBpZiAoJ2Zvcm1hdCcgaW4gb3B0aW9ucykge1xyXG4gICAgICBpZiAob3B0aW9ucy5mb3JtYXQgIT09ICd2ZWN0b3InKSB7XHJcbiAgICAgICAgY29uc3QgYXJ0aWZhY3RGb3JtYXRzID0gWydzZXJkZV9qc29uJywgJ2pzJywgJ2lyJ10gYXMgY29uc3Q7XHJcbiAgICAgICAgaWYgKGFydGlmYWN0Rm9ybWF0cy5pbmNsdWRlcyhvcHRpb25zLmZvcm1hdCBhcyBhbnkpKSB7XHJcbiAgICAgICAgICAvLyBkZXByZWNhdGVkXHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGRlcHJlY2F0ZWQgZm9ybWF0ICR7b3B0aW9ucy5mb3JtYXR9LCBwbGVhc2UgdXNlIHZlY3RvciBmb3JtYXRgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJUb0NhbnZhcyhvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHJlbmRlckRvbShvcHRpb25zOiBSZW5kZXJJblNlc3Npb25PcHRpb25zPE1vdW50RG9tT3B0aW9ucz4pOiBQcm9taXNlPFR5cHN0RG9tRG9jdW1lbnQ+IHtcclxuICAgIGlmICgnZm9ybWF0JyBpbiBvcHRpb25zKSB7XHJcbiAgICAgIGlmIChvcHRpb25zLmZvcm1hdCAhPT0gJ3ZlY3RvcicpIHtcclxuICAgICAgICBjb25zdCBhcnRpZmFjdEZvcm1hdHMgPSBbJ3NlcmRlX2pzb24nLCAnanMnLCAnaXInXSBhcyBjb25zdDtcclxuICAgICAgICBpZiAoYXJ0aWZhY3RGb3JtYXRzLmluY2x1ZGVzKG9wdGlvbnMuZm9ybWF0IGFzIGFueSkpIHtcclxuICAgICAgICAgIC8vIGRlcHJlY2F0ZWRcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgZGVwcmVjYXRlZCBmb3JtYXQgJHtvcHRpb25zLmZvcm1hdH0sIHBsZWFzZSB1c2UgdmVjdG9yIGZvcm1hdGApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLndpdGhpbk9wdGlvblNlc3Npb24ob3B0aW9ucywgYXN5bmMgc2Vzc2lvblJlZiA9PiB7XHJcbiAgICAgIGNvbnN0IHQgPSBuZXcgVHlwc3REb21Eb2N1bWVudCh7XHJcbiAgICAgICAgLi4ub3B0aW9ucyxcclxuICAgICAgICByZW5kZXJNb2RlOiAnZG9tJyxcclxuICAgICAgICBob29rZWRFbGVtOiBvcHRpb25zLmNvbnRhaW5lcixcclxuICAgICAgICBrTW9kdWxlOiBzZXNzaW9uUmVmLFxyXG4gICAgICAgIHJlbmRlcmVyOiB0aGlzLFxyXG4gICAgICB9KTtcclxuICAgICAgdDtcclxuICAgICAgYXdhaXQgdC5pbXBsLm1vdW50RG9tKG9wdGlvbnMucGl4ZWxQZXJQdCk7XHJcbiAgICAgIHJldHVybiB0O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyByZW5kZXJUb0NhbnZhcyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclRvQ2FudmFzT3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGxldCBzZXNzaW9uOiBSZW5kZXJTZXNzaW9uO1xyXG4gICAgbGV0IHJlbmRlclBhZ2VSZXN1bHRzOiBSZW5kZXJDYW52YXNSZXN1bHRbXTtcclxuICAgIGNvbnN0IG1vdW50Q29udGFpbmVyID0gb3B0aW9ucy5jb250YWluZXI7XHJcbiAgICBtb3VudENvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XHJcblxyXG4gICAgY29uc3QgZG9SZW5kZXJEaXNwbGF5TGF5ZXIgPSBhc3luYyAoXHJcbiAgICAgIGNhbnZhc0xpc3Q6IEhUTUxDYW52YXNFbGVtZW50W10sXHJcbiAgICAgIHJlc2V0TGF5b3V0OiAoKSA9PiB2b2lkLFxyXG4gICAgKSA9PiB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgcmVuZGVyUGFnZVJlc3VsdHMgPSBhd2FpdCB0aGlzLnJlbmRlckRpc3BsYXlMYXllcihzZXNzaW9uLCBjYW52YXNMaXN0LCBvcHRpb25zKTtcclxuICAgICAgICByZXNldExheW91dCgpO1xyXG4gICAgICB9IGZpbmFsbHkge1xyXG4gICAgICAgIG1vdW50Q29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHRoaXMud2l0aGluT3B0aW9uU2Vzc2lvbihvcHRpb25zLCBhc3luYyBzZXNzaW9uUmVmID0+IHtcclxuICAgICAgc2Vzc2lvbiA9IHNlc3Npb25SZWY7XHJcbiAgICAgIGlmIChzZXNzaW9uW2tPYmplY3RdLnBhZ2VzX2luZm8ucGFnZV9jb3VudCA9PT0gMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gcGFnZSBmb3VuZCBpbiBzZXNzaW9uYCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChvcHRpb25zLnBpeGVsUGVyUHQgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLnBpeGVsUGVyUHQgPD0gMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcclxuICAgICAgICAgICdJbnZhbGlkIHR5cHN0LlJlbmRlck9wdGlvbnMucGl4ZWxQZXJQdCwgc2hvdWxkIGJlIGEgcG9zaXRpdmUgbnVtYmVyICcgK1xyXG4gICAgICAgICAgICBvcHRpb25zLnBpeGVsUGVyUHQsXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgbGV0IGJhY2tncm91bmRDb2xvciA9IG9wdGlvbnMuYmFja2dyb3VuZENvbG9yO1xyXG4gICAgICBpZiAoYmFja2dyb3VuZENvbG9yICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBpZiAoIS9eI1swLTlhLWZdezZ9JC8udGVzdChiYWNrZ3JvdW5kQ29sb3IpKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICAgICAgICdJbnZhbGlkIHR5cHN0LmJhY2tncm91bmRDb2xvciBjb2xvciBmb3IgbWF0Y2hpbmcgXiM/WzAtOWEtZl17Nn0kICcgKyBiYWNrZ3JvdW5kQ29sb3IsXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgc2Vzc2lvbi5waXhlbFBlclB0ID0gb3B0aW9ucy5waXhlbFBlclB0ID8/IFR5cHN0RGVmYXVsdFBhcmFtcy5QSVhFTF9QRVJfUFQ7XHJcbiAgICAgIHNlc3Npb24uYmFja2dyb3VuZENvbG9yID0gYmFja2dyb3VuZENvbG9yID8/ICcjZmZmZmZmJztcclxuXHJcbiAgICAgIGNvbnN0IHQgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuXHJcbiAgICAgIGNvbnN0IHBhZ2VWaWV3ID0gbmV3IFJlbmRlclZpZXcoXHJcbiAgICAgICAgdGhpcy5yZXRyaWV2ZVBhZ2VzSW5mb0Zyb21TZXNzaW9uKHNlc3Npb24pLFxyXG4gICAgICAgIG1vdW50Q29udGFpbmVyLFxyXG4gICAgICAgIG9wdGlvbnMsXHJcbiAgICAgICk7XHJcbiAgICAgIGNvbnN0IHQyID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcblxyXG4gICAgICBjb25zb2xlLmxvZyhgbGF5ZXIgdXNlZDogcmV0aWV2ZSA9ICR7KHQyIC0gdCkudG9GaXhlZCgxKX1tc2ApO1xyXG5cclxuICAgICAgYXdhaXQgZG9SZW5kZXJEaXNwbGF5TGF5ZXIocGFnZVZpZXcuY2FudmFzTGlzdCwgKCkgPT4gcGFnZVZpZXcucmVzZXRMYXlvdXQoKSk7XHJcbiAgICAgIHRoaXMucmVuZGVyVGV4dExheWVyKHBhZ2VWaWV3LnRleHRMYXllckxpc3QsIHJlbmRlclBhZ2VSZXN1bHRzKTtcclxuXHJcbiAgICAgIHJldHVybjtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlTW9kdWxlKGI/OiBVaW50OEFycmF5KTogUHJvbWlzZTxSZW5kZXJTZXNzaW9uPiB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFxyXG4gICAgICBuZXcgUmVuZGVyU2Vzc2lvbihcclxuICAgICAgICB0aGlzLFxyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuY3JlYXRlX3Nlc3Npb24oXHJcbiAgICAgICAgICBiICYmXHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlT3B0aW9uc1RvUnVzdCh7XHJcbiAgICAgICAgICAgICAgZm9ybWF0OiAndmVjdG9yJyxcclxuICAgICAgICAgICAgICBhcnRpZmFjdENvbnRlbnQ6IGIsXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICksXHJcbiAgICAgICksXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgY3JlYXRlV29ya2VyVjAod29ya2VyOiBXb3JrZXIpIHtcclxuICAgIHJldHVybiBuZXcgVHlwc3RXb3JrZXIodGhpcywgYXdhaXQgdGhpcy5yZW5kZXJlci5jcmVhdGVfd29ya2VyKHdvcmtlcikpO1xyXG4gIH1cclxuXHJcbiAgd29ya2VyQnJpZGdlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucmVuZGVyZXIuY3JlYXRlX3dvcmtlcl9icmlkZ2UoKTtcclxuICB9XHJcblxyXG4gIHJlbmRlclN2ZyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclN2Z09wdGlvbnM+LCBjb250YWluZXI/OiBhbnkpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgaWYgKG9wdGlvbnMgaW5zdGFuY2VvZiBSZW5kZXJTZXNzaW9uIHx8IGNvbnRhaW5lcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlbW92ZWQgYXBpLCBwbGVhc2UgdXNlIHJlbmRlclRvU3ZnKHsgcmVuZGVyU2Vzc2lvbiwgY29udGFpbmVyIH0pIGluc3RlYWQnKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy53aXRoaW5PcHRpb25TZXNzaW9uKG9wdGlvbnMsIGFzeW5jIHNlc3Npb25SZWYgPT4ge1xyXG4gICAgICBsZXQgcGFydHM6IG51bWJlciB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcclxuICAgICAgaWYgKG9wdGlvbnMuZGF0YV9zZWxlY3Rpb24pIHtcclxuICAgICAgICBwYXJ0cyA9IDA7XHJcbiAgICAgICAgaWYgKG9wdGlvbnMuZGF0YV9zZWxlY3Rpb24uYm9keSkge1xyXG4gICAgICAgICAgcGFydHMgfD0gMSA8PCAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob3B0aW9ucy5kYXRhX3NlbGVjdGlvbi5kZWZzKSB7XHJcbiAgICAgICAgICBwYXJ0cyB8PSAxIDw8IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvcHRpb25zLmRhdGFfc2VsZWN0aW9uLmNzcykge1xyXG4gICAgICAgICAgcGFydHMgfD0gMSA8PCAyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob3B0aW9ucy5kYXRhX3NlbGVjdGlvbi5qcykge1xyXG4gICAgICAgICAgcGFydHMgfD0gMSA8PCAzO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLnJlbmRlcmVyLnN2Z19kYXRhKHNlc3Npb25SZWZba09iamVjdF0sIHBhcnRzKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlbmRlclN2Z0RpZmYob3B0aW9uczogUmVuZGVySW5TZXNzaW9uT3B0aW9uczxSZW5kZXJTdmdPcHRpb25zPik6IHN0cmluZyB7XHJcbiAgICBpZiAoIW9wdGlvbnMud2luZG93KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnJlbmRlcmVyLnJlbmRlcl9zdmdfZGlmZihcclxuICAgICAgICAob3B0aW9ucy5yZW5kZXJTZXNzaW9uIGFzIGFueSlba09iamVjdF0sXHJcbiAgICAgICAgMCxcclxuICAgICAgICAwLFxyXG4gICAgICAgIDFlMzMsXHJcbiAgICAgICAgMWUzMyxcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJlci5yZW5kZXJfc3ZnX2RpZmYoXHJcbiAgICAgIChvcHRpb25zLnJlbmRlclNlc3Npb24gYXMgYW55KVtrT2JqZWN0XSxcclxuICAgICAgb3B0aW9ucy53aW5kb3cubG8ueCxcclxuICAgICAgb3B0aW9ucy53aW5kb3cubG8ueSxcclxuICAgICAgb3B0aW9ucy53aW5kb3cuaGkueCxcclxuICAgICAgb3B0aW9ucy53aW5kb3cuaGkueSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJUb1N2ZyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclRvU3ZnT3B0aW9ucz4pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHJldHVybiB0aGlzLndpdGhpbk9wdGlvblNlc3Npb24ob3B0aW9ucywgYXN5bmMgc2Vzc2lvblJlZiA9PiB7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5yZW5kZXJlci5yZW5kZXJfc3ZnKHNlc3Npb25SZWZba09iamVjdF0sIG9wdGlvbnMuY29udGFpbmVyKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldEN1c3RvbVYxKG9wdGlvbnM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8e30+KTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5yZW5kZXJlci5nZXRfY3VzdG9tcyhvcHRpb25zLnJlbmRlclNlc3Npb25ba09iamVjdF0pKTtcclxuICB9XHJcblxyXG4gIHJlc2V0U2Vzc2lvbihzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKTogdm9pZCB7XHJcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJlci5yZXNldChzZXNzaW9uW2tPYmplY3RdKTtcclxuICB9XHJcblxyXG4gIG1hbmlwdWxhdGVEYXRhKG9wdHM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8TWFuaXB1bGF0ZURhdGFPcHRpb25zPik6IHZvaWQge1xyXG4gICAgcmV0dXJuIHRoaXMucmVuZGVyZXIubWFuaXB1bGF0ZV9kYXRhKFxyXG4gICAgICAob3B0cy5yZW5kZXJTZXNzaW9uIGFzIGFueSlba09iamVjdF0gYXMgdHlwc3QuUmVuZGVyU2Vzc2lvbixcclxuICAgICAgb3B0cy5hY3Rpb24gPz8gJ3Jlc2V0JyxcclxuICAgICAgb3B0cy5kYXRhLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgd2l0aGluT3B0aW9uU2Vzc2lvbjxUPihcclxuICAgIG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8YW55PixcclxuICAgIGZuOiAoc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gUHJvbWlzZTxUPixcclxuICApOiBQcm9taXNlPFQ+IHtcclxuICAgIGZ1bmN0aW9uIGlzUmVuZGVyQnlDb250ZW50T3B0aW9uKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8YW55Pik6IG9wdGlvbnMgaXMgQ3JlYXRlU2Vzc2lvbk9wdGlvbnMge1xyXG4gICAgICByZXR1cm4gJ2FydGlmYWN0Q29udGVudCcgaW4gb3B0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICBpZiAoJ3JlbmRlclNlc3Npb24nIGluIG9wdGlvbnMpIHtcclxuICAgICAgcmV0dXJuIGZuKG9wdGlvbnMucmVuZGVyU2Vzc2lvbiBhcyBSZW5kZXJTZXNzaW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoaXNSZW5kZXJCeUNvbnRlbnRPcHRpb24ob3B0aW9ucykpIHtcclxuICAgICAgLy8gdG9kbzogcmVtb3ZlIGFueVxyXG4gICAgICByZXR1cm4gdGhpcy5ydW5XaXRoU2Vzc2lvbihvcHRpb25zIGFzIGFueSwgZm4gYXMgYW55KTtcclxuICAgIH1cclxuXHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICdJbnZhbGlkIHJlbmRlciBvcHRpb25zLCBzaG91bGQgYmUgb25lIG9mIFJlbmRlckJ5Q29udGVudE9wdGlvbnN8UmVuZGVyQnlTZXNzaW9uT3B0aW9ucycsXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcnVuV2l0aFNlc3Npb248VD4oZm46IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPjtcclxuICBydW5XaXRoU2Vzc2lvbjxUPihcclxuICAgIG9wdGlvbnM6IENyZWF0ZVNlc3Npb25PcHRpb25zLFxyXG4gICAgZm46IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiBQcm9taXNlPFQ+LFxyXG4gICk6IFByb21pc2U8VD47XHJcbiAgYXN5bmMgcnVuV2l0aFNlc3Npb248VD4oYXJnMTogYW55LCBhcmcyPzogYW55KTogUHJvbWlzZTxUPiB7XHJcbiAgICBsZXQgb3B0aW9uczogUGFydGlhbDxDcmVhdGVTZXNzaW9uT3B0aW9ucz4gfCB1bmRlZmluZWQgPSBhcmcxO1xyXG4gICAgbGV0IGZuOiAoc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gUHJvbWlzZTxUPiA9IGFyZzI7XHJcblxyXG4gICAgaWYgKCFhcmcyKSB7XHJcbiAgICAgIG9wdGlvbnMgPSB1bmRlZmluZWQ7XHJcbiAgICAgIGZuID0gYXJnMTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5yZW5kZXJlci5jcmVhdGVfc2Vzc2lvbihcclxuICAgICAgLyogbW92ZWQgKi8gb3B0aW9ucyAmJiB0aGlzLmNyZWF0ZU9wdGlvbnNUb1J1c3Qob3B0aW9ucyksXHJcbiAgICApO1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgZm4obmV3IFJlbmRlclNlc3Npb24odGhpcywgc2Vzc2lvbikpO1xyXG4gICAgICBzZXNzaW9uLmZyZWUoKTtcclxuICAgICAgcmV0dXJuIHJlcztcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgc2Vzc2lvbi5mcmVlKCk7XHJcbiAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==